import{k as ne,r as u,c as se,o as ke,J as r,I as n,M as t,H as je,N as l,K as x,F as L,Q as R,G as $,j as N,l as c,a6 as oe,Z as f,L as Se,a7 as ae,T as Ce,V as Ee,O as le,W as Te}from"./vue-vendor-CMZ7xYHN.js";import{u as $e,g as Pe}from"./index-Byhz0bWx.js";const Ue="/api",h=`${Ue}/llm-config`,_=()=>({"Content-Type":"application/json",Authorization:`Bearer ${$e().token}`}),Me=async()=>{const i=await fetch(`${h}/nodes`,{method:"GET",headers:_()});if(!i.ok)throw new Error("获取节点绑定失败");return i.json()},Ne=async(i,d)=>{const m=await fetch(`${h}/nodes/${encodeURIComponent(i)}`,{method:"PUT",headers:_(),body:JSON.stringify({provider_name:d})});if(!m.ok)throw new Error("设置节点绑定失败");return m.json()},Ve=async()=>{const i=await fetch(`${h}/providers/details`,{method:"GET",headers:_()});if(!i.ok)throw new Error("获取 Provider 详情失败");return(await i.json()).providers||[]},Oe=async i=>{const d=await fetch(`${h}/providers`,{method:"POST",headers:_(),body:JSON.stringify(i)});if(!d.ok){const m=await d.json().catch(()=>({}));throw new Error(m.detail||"创建 Provider 失败")}return d.json()},Ie=async(i,d)=>{const m=await fetch(`${h}/providers/${encodeURIComponent(i)}`,{method:"PUT",headers:_(),body:JSON.stringify(d)});if(!m.ok){const v=await m.json().catch(()=>({}));throw new Error(v.detail||"更新 Provider 失败")}return m.json()},Je=async i=>{const d=await fetch(`${h}/providers/${encodeURIComponent(i)}`,{method:"DELETE",headers:_()});if(!d.ok){const m=await d.json().catch(()=>({}));throw new Error(m.detail||"删除 Provider 失败")}},Be=async i=>{const d=await fetch(`${h}/providers/${encodeURIComponent(i)}/test`,{method:"POST",headers:_()});if(!d.ok){const m=await d.json().catch(()=>({}));throw new Error(m.detail||"测试连接失败")}return d.json()},Ae=async i=>{const d=await fetch(`${h}/providers/${encodeURIComponent(i)}/test-json`,{method:"POST",headers:_()});if(!d.ok){const m=await d.json().catch(()=>({}));throw new Error(m.detail||"JSON 模式测试失败")}return d.json()},Fe=async()=>{const i=await fetch(`${h}/writing-models`,{method:"GET",headers:_()});if(!i.ok)throw new Error("获取写作模型配置失败");return(await i.json()).models||[]},Le=async i=>{const d=await fetch(`${h}/writing-models`,{method:"PUT",headers:_(),body:JSON.stringify({models:i})});if(!d.ok){const v=await d.json().catch(()=>({}));throw new Error(v.detail||"保存写作模型配置失败")}return(await d.json()).models||[]},Re=async()=>{const i=await fetch(`${h}/score-thresholds`,{method:"GET",headers:_()});if(!i.ok)throw new Error("获取分数阈值配置失败");return i.json()},Ge=async i=>{const d=await fetch(`${h}/score-thresholds`,{method:"PUT",headers:_(),body:JSON.stringify(i)});if(!d.ok){const m=await d.json().catch(()=>({}));throw new Error(m.detail||"保存分数阈值配置失败")}return d.json()},We={class:"bg-white/70 backdrop-blur-xl rounded-2xl shadow-lg p-8"},De={key:0,class:"text-sm text-gray-500"},ze={key:1,class:"text-sm text-amber-700"},He={key:2,class:"grid gap-4 md:grid-cols-2"},Ke={class:"flex items-start justify-between gap-3"},Qe={class:"text-sm font-semibold text-gray-800"},Xe={class:"text-xs text-gray-500 mt-1"},Ze={class:"text-xs text-gray-500 mt-1 break-all"},qe={class:"mt-3 text-xs text-gray-500"},Ye={class:"text-xs text-gray-600 mt-1"},et={key:0,class:"text-xs text-gray-600 mt-1 break-all"},tt={key:1,class:"text-xs text-amber-700 mt-1 break-all"},st={class:"text-xs text-gray-600 mt-1"},ot={key:0,class:"text-xs text-gray-600 mt-1 break-all"},at={key:1,class:"text-xs text-amber-700 mt-1 break-all"},lt={class:"mt-4 flex justify-end gap-2"},nt=["disabled","onClick"],rt=["disabled","onClick"],dt=["onClick"],it=["disabled","onClick"],ut={key:0,class:"text-sm text-gray-500"},mt={class:"border-t border-gray-200 mt-8 pt-6"},pt={key:0,class:"text-sm text-gray-500"},ct={key:1,class:"overflow-hidden rounded-lg border border-gray-200"},xt={class:"min-w-full text-sm"},vt={class:"divide-y divide-gray-100 bg-white"},yt={class:"px-4 py-2"},gt={class:"max-w-[220px]"},bt=["title"],ft=["title"],ht={class:"px-4 py-2"},_t=["onUpdate:modelValue","onChange","title"],wt=["value","title"],kt={key:0,class:"px-4 py-2 text-xs text-amber-700"},jt={class:"border-t border-gray-200 mt-8 pt-6"},St={class:"flex items-center justify-between mb-4"},Ct=["disabled"],Et={key:0,class:"text-sm text-gray-500"},Tt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},$t={class:"flex items-center gap-3 p-3 cursor-pointer"},Pt=["checked","onChange"],Ut={class:"flex-1 min-w-0"},Mt={class:"text-sm font-medium text-gray-800 truncate"},Nt={class:"text-xs text-gray-500 truncate"},Vt={key:0,class:"px-3 pb-3 pt-1 border-t border-indigo-200 space-y-2"},Ot={class:"flex items-center gap-2"},It=["value","onInput"],Jt={class:"text-xs text-indigo-600 w-10 text-right"},Bt=["onClick"],At={class:"flex items-center gap-2"},Ft=["value","onInput"],Lt={class:"text-xs text-amber-600 w-10 text-right"},Rt=["onClick"],Gt={key:2,class:"text-xs text-amber-700 mt-2"},Wt={key:3,class:"text-xs text-indigo-600 mt-3"},Dt={class:"border-t border-gray-200 mt-8 pt-6"},zt={class:"flex items-center justify-between mb-4"},Ht=["disabled"],Kt={key:0,class:"text-sm text-gray-500"},Qt={key:1,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Xt={class:"border border-gray-200 rounded-lg p-4 bg-white"},Zt={class:"border border-gray-200 rounded-lg p-4 bg-white"},qt={class:"border border-gray-200 rounded-lg p-4 bg-white"},Yt={key:2,class:"text-xs text-amber-700 mt-2"},es={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4"},ts={class:"w-full max-w-2xl bg-white rounded-2xl shadow-xl p-6 max-h-[90vh] overflow-y-auto"},ss={class:"flex items-center justify-between mb-4"},os={class:"text-lg font-semibold text-gray-800"},as=["disabled"],ls={class:"md:col-span-2"},ns={class:"flex items-center gap-3"},rs={class:"flex items-center gap-3"},ds={class:"md:col-span-2"},is={key:0},us={class:"md:col-span-2 flex justify-end gap-2 pt-2"},ms=["disabled"],ps={key:0,class:"text-xs text-amber-700 mt-3"},cs=ne({__name:"ProviderManagement",setup(i){const d=[{key:"concept",label:"概念对话"},{key:"blueprint",label:"蓝图生成"},{key:"evaluation",label:"章节评估"},{key:"outline",label:"章节大纲"},{key:"summary",label:"摘要生成"},{key:"embedding",label:"向量嵌入"}],m=()=>({name:"",model:"",provider:"",base_url:"",api_key:"",temperature:"",max_tokens:"",timeout:"",support_json_mode:!0,support_stream:!0,proxy:"",embed_api_type:"openai"}),v=u([]),re=se(()=>v.value.map(o=>o.name)),G=u(!1),S=u(null),de=se(()=>a.value.model.toLowerCase().includes("embedding")),V=u(null),O=u(null),I=u(null),y=u({}),b=u({}),j=u({}),W=u(!1),C=u(null),g=u([]),D=u(!1),E=u(null),J=u(!1),w=u({score_threshold_early:95,score_threshold_normal:90,max_rewrite_attempts:3}),z=u(!1),T=u(null),B=u(!1),H=o=>g.value.some(e=>e.name===o),ie=o=>{const e=g.value.findIndex(s=>s.name===o);e>=0?g.value.splice(e,1):g.value.push({name:o,temperature:null,revision_temperature:.3})},Q=o=>g.value.find(s=>s.name===o)?.temperature??null,X=(o,e)=>{const s=g.value.find(p=>p.name===o);s&&(s.temperature=e)},Z=o=>g.value.find(s=>s.name===o)?.revision_temperature??.3,q=(o,e)=>{const s=g.value.find(p=>p.name===o);s&&(s.revision_temperature=e)},Y=o=>o===null?"默认":o.toFixed(1),P=u(!1),U=u(!1),A=u(null),M=u(!1),k=u(null),a=u(m()),ee=async()=>{G.value=!0,S.value=null;try{v.value=await Ve()}catch(o){S.value=o?.message||"加载失败"}finally{G.value=!1}},ue=async()=>{W.value=!0,C.value=null;try{const e={...await Me()};d.forEach(s=>{s.key in e||(e[s.key]="")}),j.value=e}catch(o){C.value=o?.message||"节点绑定加载失败"}finally{W.value=!1}},me=async()=>{D.value=!0,E.value=null;try{g.value=await Fe()}catch(o){E.value=o?.message||"写作模型配置加载失败"}finally{D.value=!1}},pe=async()=>{J.value=!0,E.value=null;try{await Le(g.value)}catch(o){E.value=o?.message||"保存写作模型配置失败"}finally{J.value=!1}},ce=async()=>{z.value=!0,T.value=null;try{w.value=await Re()}catch(o){T.value=o?.message||"分数阈值配置加载失败"}finally{z.value=!1}},xe=async()=>{B.value=!0,T.value=null;try{await Ge(w.value)}catch(o){T.value=o?.message||"保存分数阈值配置失败"}finally{B.value=!1}};ke(async()=>{await Promise.all([ee(),ue(),me(),ce()])});const ve=()=>{U.value=!1,A.value=null,a.value=m(),k.value=null,P.value=!0},ye=o=>{U.value=!0,A.value=o.name,a.value={name:o.name,model:o.model||"",provider:o.provider||"",base_url:o.base_url||"",api_key:"",temperature:o.temperature?.toString()??"",max_tokens:o.max_tokens?.toString()??"",timeout:o.timeout?.toString()??"",support_json_mode:o.support_json_mode??!0,support_stream:o.support_stream??!0,proxy:o.proxy||"",embed_api_type:o.embed_api_type||"openai"},k.value=null,P.value=!0},te=()=>{P.value=!1,k.value=null},F=o=>o==null?null:String(o).trim(),K=(o,e=!1)=>{if(o==null||o==="")return null;const s=e?parseInt(String(o),10):Number(o);return Number.isFinite(s)?s:null},ge=()=>{const o=a.value.name.trim(),e=a.value.model.trim();return!o||!e?(k.value="名称和模型为必填项",null):{name:o,model:e,provider:F(a.value.provider),base_url:F(a.value.base_url),api_key:F(a.value.api_key),temperature:K(a.value.temperature),max_tokens:K(a.value.max_tokens,!0),timeout:K(a.value.timeout,!0),support_json_mode:a.value.support_json_mode,support_stream:a.value.support_stream,proxy:F(a.value.proxy),embed_api_type:a.value.embed_api_type||"openai"}},be=async()=>{if(M.value)return;k.value=null;const o=ge();if(o){M.value=!0;try{U.value&&A.value?await Ie(A.value,o):await Oe(o),P.value=!1,await ee()}catch(e){k.value=e?.message||"保存失败"}finally{M.value=!1}}},fe=async o=>{if(await Pe.showConfirm(`确定删除配置 "${o.name}" 吗？`,"删除确认")){V.value=o.name,S.value=null;try{await Je(o.name),v.value=v.value.filter(s=>s.name!==o.name),delete y.value[o.name]}catch(s){S.value=s?.message||"删除失败"}finally{V.value=null}}},he=async o=>{O.value=o.name,delete y.value[o.name];try{const e=await Be(o.name);y.value[o.name]=e}catch(e){y.value[o.name]={ok:!1,latency_ms:0,model:o.model,base_url:o.base_url,response_preview:null,error:e?.message||"测试失败"}}finally{O.value=null}},_e=async o=>{I.value=o.name,delete b.value[o.name];try{const e=await Ae(o.name);b.value[o.name]=e}catch(e){b.value[o.name]={ok:!1,latency_ms:0,model:o.model,base_url:o.base_url,response_preview:null,json_valid:!1,error:e?.message||"JSON 测试失败"}}finally{I.value=null}},we=async o=>{const e=j.value[o];if(e){C.value=null;try{const s=await Ne(o,e);j.value={...j.value,...s}}catch(s){C.value=s?.message||"节点绑定保存失败"}}};return(o,e)=>(n(),r("div",We,[t("div",{class:"flex items-center justify-between mb-6"},[e[15]||(e[15]=t("h2",{class:"text-2xl font-bold text-gray-800"},"模型配置",-1)),t("button",{type:"button",class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",onClick:ve}," 新增配置 ")]),G.value?(n(),r("div",De,"加载中...")):S.value?(n(),r("div",ze,l(S.value),1)):(n(),r("div",He,[(n(!0),r(L,null,R(v.value,s=>(n(),r("div",{key:s.name,class:"border border-gray-200 rounded-xl p-4 bg-white shadow-sm"},[t("div",Ke,[t("div",null,[t("p",Qe,l(s.name),1),t("p",Xe,"模型: "+l(s.model||"-"),1),t("p",Ze,"接口地址: "+l(s.base_url||"-"),1)]),t("span",{class:$(["text-[11px] px-2 py-1 rounded-full",s.has_api_key?"bg-emerald-100 text-emerald-700":"bg-gray-100 text-gray-600"])},l(s.has_api_key?"已配置密钥":"未配置密钥"),3)]),t("div",qe,[N(" 类型: "+l(s.provider||"-")+" ",1),e[16]||(e[16]=t("span",{class:"mx-2"},"·",-1)),N(" 温度: "+l(s.temperature??"-")+" ",1),e[17]||(e[17]=t("span",{class:"mx-2"},"·",-1)),N(" 最大令牌: "+l(s.max_tokens??"-")+" ",1),e[18]||(e[18]=t("span",{class:"mx-2"},"·",-1)),N(" 超时: "+l(s.timeout??"-")+"s ",1)]),y.value[s.name]?(n(),r("div",{key:0,class:$(["mt-3 rounded-lg border px-3 py-2",y.value[s.name].ok?"border-emerald-200 bg-emerald-50":"border-amber-200 bg-amber-50"])},[t("p",{class:$(["text-xs font-medium",y.value[s.name].ok?"text-emerald-700":"text-amber-700"])},l(y.value[s.name].ok?"连接成功":"连接失败"),3),t("p",Ye," 耗时 "+l(y.value[s.name].latency_ms)+"ms ",1),y.value[s.name].response_preview?(n(),r("p",et," 响应预览: "+l(y.value[s.name].response_preview),1)):x("",!0),y.value[s.name].error?(n(),r("p",tt,l(y.value[s.name].error),1)):x("",!0)],2)):x("",!0),b.value[s.name]?(n(),r("div",{key:1,class:$(["mt-3 rounded-lg border px-3 py-2",b.value[s.name].json_valid?"border-emerald-200 bg-emerald-50":"border-amber-200 bg-amber-50"])},[t("p",{class:$(["text-xs font-medium",b.value[s.name].json_valid?"text-emerald-700":"text-amber-700"])},l(b.value[s.name].json_valid?"JSON 模式正常":"JSON 模式异常"),3),t("p",st," 耗时 "+l(b.value[s.name].latency_ms)+"ms ",1),b.value[s.name].response_preview?(n(),r("p",ot," 响应: "+l(b.value[s.name].response_preview),1)):x("",!0),b.value[s.name].error?(n(),r("p",at,l(b.value[s.name].error),1)):x("",!0)],2)):x("",!0),t("div",lt,[t("button",{type:"button",class:"px-3 py-1.5 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 text-xs disabled:opacity-60",disabled:O.value===s.name,onClick:p=>he(s)},l(O.value===s.name?"测试中...":"测试连接"),9,nt),t("button",{type:"button",class:"px-3 py-1.5 text-amber-600 border border-amber-600 rounded-lg hover:bg-amber-50 text-xs disabled:opacity-60",disabled:I.value===s.name,onClick:p=>_e(s)},l(I.value===s.name?"测试中...":"JSON测试"),9,rt),t("button",{type:"button",class:"px-3 py-1.5 text-indigo-600 border border-indigo-600 rounded-lg hover:bg-indigo-50 text-xs",onClick:p=>ye(s)}," 编辑 ",8,dt),t("button",{type:"button",class:"px-3 py-1.5 text-white bg-red-600 rounded-lg hover:bg-red-700 text-xs disabled:opacity-60",disabled:V.value===s.name,onClick:p=>fe(s)},l(V.value===s.name?"删除中...":"删除"),9,it)])]))),128)),v.value.length?x("",!0):(n(),r("div",ut,'暂无配置，请点击"新增配置"添加。'))])),t("div",mt,[e[21]||(e[21]=t("div",{class:"flex items-center justify-between mb-4"},[t("h3",{class:"text-lg font-semibold text-gray-800"},"节点绑定"),t("span",{class:"text-xs text-gray-500"},"修改后立即生效")],-1)),e[22]||(e[22]=t("p",{class:"text-xs text-gray-500 mb-4"}," 节点用于区分业务阶段（概念、蓝图、写作等），可绑定到不同的模型配置。 ",-1)),W.value?(n(),r("div",pt,"加载节点配置中...")):(n(),r("div",ct,[t("table",xt,[e[20]||(e[20]=t("thead",{class:"bg-gray-50 text-gray-600"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left font-medium"},"节点"),t("th",{class:"px-4 py-2 text-left font-medium"},"绑定模型")])],-1)),t("tbody",vt,[(n(),r(L,null,R(d,s=>t("tr",{key:s.key},[t("td",yt,[t("div",gt,[t("p",{class:"text-sm font-medium text-gray-700 truncate",title:s.label},l(s.label),9,bt),t("p",{class:"text-xs text-gray-500 truncate",title:s.key},l(s.key),9,ft)])]),t("td",ht,[c(t("select",{"onUpdate:modelValue":p=>j.value[s.key]=p,onChange:p=>we(s.key),class:"w-full min-w-[320px] px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",title:j.value[s.key]||"未绑定"},[e[19]||(e[19]=t("option",{value:"",disabled:""},"未绑定",-1)),(n(!0),r(L,null,R(re.value,p=>(n(),r("option",{key:p,value:p,title:p},l(p),9,wt))),128))],40,_t),[[oe,j.value[s.key]]])])])),64))])]),C.value?(n(),r("p",kt,l(C.value),1)):x("",!0)]))]),t("div",jt,[t("div",St,[e[23]||(e[23]=t("h3",{class:"text-lg font-semibold text-gray-800"},"写作模型 (多选)",-1)),t("button",{type:"button",class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm disabled:opacity-60",disabled:J.value,onClick:pe},l(J.value?"保存中...":"保存配置"),9,Ct)]),e[26]||(e[26]=t("p",{class:"text-xs text-gray-500 mb-4"},' 选择多个模型用于并行生成章节版本，每个模型可单独配置温度。温度为"默认"时使用模型配置中的温度。 ',-1)),D.value?(n(),r("div",Et,"加载写作模型配置中...")):(n(),r("div",Tt,[(n(!0),r(L,null,R(v.value,s=>(n(),r("div",{key:s.name,class:$(["border rounded-lg transition-colors",H(s.name)?"border-indigo-400 bg-indigo-50":"border-gray-200 hover:bg-gray-50"])},[t("label",$t,[t("input",{type:"checkbox",checked:H(s.name),onChange:p=>ie(s.name),class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,40,Pt),t("div",Ut,[t("p",Mt,l(s.name),1),t("p",Nt,l(s.model||"-"),1)])]),H(s.name)?(n(),r("div",Vt,[t("div",Ot,[e[24]||(e[24]=t("span",{class:"text-xs text-gray-600 whitespace-nowrap"},"创作温度:",-1)),t("input",{type:"range",min:"0",max:"2",step:"0.1",value:Q(s.name)??.7,onInput:p=>X(s.name,parseFloat(p.target.value)),class:"flex-1 h-1 accent-indigo-600"},null,40,It),t("span",Jt,l(Y(Q(s.name))),1),t("button",{type:"button",class:"text-xs text-gray-500 hover:text-indigo-600",onClick:p=>X(s.name,null),title:"使用模型默认温度"}," 重置 ",8,Bt)]),t("div",At,[e[25]||(e[25]=t("span",{class:"text-xs text-gray-600 whitespace-nowrap"},"修订温度:",-1)),t("input",{type:"range",min:"0",max:"1",step:"0.1",value:Z(s.name)??.3,onInput:p=>q(s.name,parseFloat(p.target.value)),class:"flex-1 h-1 accent-amber-600"},null,40,Ft),t("span",Lt,l(Y(Z(s.name))),1),t("button",{type:"button",class:"text-xs text-gray-500 hover:text-amber-600",onClick:p=>q(s.name,.3),title:"重置为默认修订温度0.3"}," 重置 ",8,Rt)])])):x("",!0)],2))),128))])),E.value?(n(),r("p",Gt,l(E.value),1)):x("",!0),g.value.length>0?(n(),r("p",Wt," 已选择 "+l(g.value.length)+" 个模型，生成章节时将并行产出 "+l(g.value.length)+" 个版本 ",1)):x("",!0)]),t("div",Dt,[t("div",zt,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold text-gray-800"},"连续创作质量控制",-1)),t("button",{type:"button",class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm disabled:opacity-60",disabled:B.value,onClick:xe},l(B.value?"保存中...":"保存配置"),9,Ht)]),e[34]||(e[34]=t("p",{class:"text-xs text-gray-500 mb-4"}," 连续创作时，章节评分低于阈值将触发重写。超过最大重写次数后停止连续创作。 ",-1)),z.value?(n(),r("div",Kt,"加载分数阈值配置中...")):(n(),r("div",Qt,[t("div",Xt,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"前三章分数阈值",-1)),c(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>w.value.score_threshold_early=s),type:"number",min:"0",max:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[f,w.value.score_threshold_early,void 0,{number:!0}]]),e[29]||(e[29]=t("p",{class:"mt-1 text-xs text-gray-500"},"第1-3章需要达到的最低分数（0-100）",-1))]),t("div",Zt,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"后续章节分数阈值",-1)),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>w.value.score_threshold_normal=s),type:"number",min:"0",max:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[f,w.value.score_threshold_normal,void 0,{number:!0}]]),e[31]||(e[31]=t("p",{class:"mt-1 text-xs text-gray-500"},"第4章及以后需要达到的最低分数（0-100）",-1))]),t("div",qt,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"最大重写次数",-1)),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>w.value.max_rewrite_attempts=s),type:"number",min:"1",max:"10",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[f,w.value.max_rewrite_attempts,void 0,{number:!0}]]),e[33]||(e[33]=t("p",{class:"mt-1 text-xs text-gray-500"},"每章最多重写次数，超过后停止连续创作",-1))])])),T.value?(n(),r("p",Yt,l(T.value),1)):x("",!0)]),(n(),je(Ce,{to:"body"},[P.value?(n(),r("div",es,[t("div",ts,[t("div",ss,[t("h3",os,l(U.value?"编辑配置":"新增配置"),1),t("button",{class:"text-gray-400 hover:text-gray-600",type:"button",onClick:te},"✕")]),t("form",{class:"grid grid-cols-1 gap-4 md:grid-cols-2",onSubmit:Se(be,["prevent"])},[t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700"},"名称 *",-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.name=s),disabled:U.value,class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm",placeholder:"配置名称（唯一标识）"},null,8,as),[[f,a.value.name]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700"},"模型 *",-1)),c(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.model=s),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm",placeholder:"如 gpt-4o、claude-3-5-sonnet"},null,512),[[f,a.value.model]])]),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium text-gray-700"},"类型",-1)),c(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.provider=s),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm",placeholder:"openai_compat"},null,512),[[f,a.value.provider]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700"},"接口地址",-1)),c(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>a.value.base_url=s),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm",placeholder:"https://api.example.com/v1"},null,512),[[f,a.value.base_url]])]),t("div",ls,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700"},"API 密钥",-1)),c(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>a.value.api_key=s),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm",placeholder:"留空则不修改/不设置"},null,512),[[f,a.value.api_key]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-gray-700"},"温度",-1)),c(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.value.temperature=s),type:"number",step:"0.1",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm",placeholder:"0.0 - 2.0"},null,512),[[f,a.value.temperature]]),e[41]||(e[41]=t("p",{class:"mt-1 text-xs text-gray-500"}," 控制输出随机性：低温(0-0.3)更稳定精确，高温(0.7-1.0)更有创意。推荐写作用0.7-0.9 ",-1))]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium text-gray-700"},"最大令牌数",-1)),c(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>a.value.max_tokens=s),type:"number",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm",placeholder:"如 4096"},null,512),[[f,a.value.max_tokens]])]),t("div",null,[e[43]||(e[43]=t("label",{class:"block text-sm font-medium text-gray-700"},"超时时间 (秒)",-1)),c(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>a.value.timeout=s),type:"number",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm",placeholder:"如 300"},null,512),[[f,a.value.timeout]])]),t("div",ns,[c(t("input",{id:"support_json_mode","onUpdate:modelValue":e[11]||(e[11]=s=>a.value.support_json_mode=s),type:"checkbox",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[ae,a.value.support_json_mode]]),e[44]||(e[44]=t("label",{for:"support_json_mode",class:"text-sm font-medium text-gray-700"},"支持 JSON 模式",-1)),e[45]||(e[45]=t("span",{class:"text-xs text-gray-500"},"（部分站点不支持，可关闭）",-1))]),t("div",rs,[c(t("input",{id:"support_stream","onUpdate:modelValue":e[12]||(e[12]=s=>a.value.support_stream=s),type:"checkbox",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[ae,a.value.support_stream]]),e[46]||(e[46]=t("label",{for:"support_stream",class:"text-sm font-medium text-gray-700"},"支持流式输出",-1)),e[47]||(e[47]=t("span",{class:"text-xs text-gray-500"},"（关闭后自动降级为非流式）",-1))]),t("div",ds,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium text-gray-700"},"代理地址",-1)),c(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>a.value.proxy=s),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm",placeholder:"如 socks5://127.0.0.1:1080"},null,512),[[f,a.value.proxy]]),e[49]||(e[49]=t("p",{class:"mt-1 text-xs text-gray-500"}," 支持 SOCKS5 代理，用于 Embedding 请求。格式: socks5://host:port ",-1))]),de.value?(n(),r("div",is,[e[51]||(e[51]=t("label",{class:"block text-sm font-medium text-gray-700"},"Embedding API 类型",-1)),c(t("select",{"onUpdate:modelValue":e[14]||(e[14]=s=>a.value.embed_api_type=s),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm"},[...e[50]||(e[50]=[t("option",{value:"openai"},"OpenAI 兼容",-1),t("option",{value:"gemini"},"Google Gemini",-1)])],512),[[oe,a.value.embed_api_type]]),e[52]||(e[52]=t("p",{class:"mt-1 text-xs text-gray-500"}," 选择 Embedding 接口格式。Gemini 使用 Google 原生 API 格式 ",-1))])):x("",!0),t("div",us,[t("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-lg text-sm",onClick:te},"取消"),t("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm disabled:opacity-60",disabled:M.value},l(M.value?"保存中...":"保存"),9,ms)])],32),k.value?(n(),r("p",ps,l(k.value),1)):x("",!0)])])):x("",!0)]))]))}}),xs={class:"min-h-screen p-4 relative"},vs={class:"absolute top-4 left-4"},ys={class:"max-w-6xl mx-auto mt-16"},fs=ne({__name:"SettingsView",setup(i){return(d,m)=>{const v=Ee("router-link");return n(),r("div",xs,[t("div",vs,[le(v,{to:"/",class:"px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-2"},{default:Te(()=>[...m[0]||(m[0]=[N(" ← 返回 ",-1)])]),_:1})]),t("div",ys,[le(cs)])])}}});export{fs as default};
