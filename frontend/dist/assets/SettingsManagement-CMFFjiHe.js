import{b as H,A as c,a as J}from"./index-Byhz0bWx.js";import{j as A,g as K,f as h,p as q,q as b,u as O,d as N,B as d,l as G,m as M,s as Q,r as X}from"./naive-ui-DOxxWvKY.js";import{k as Y,r as o,e as Z,c as ee,o as ae,J as le,I as E,O as t,W as s,P as l,H as z,K as B,j as f,N as D,M as x,F as te,m as S}from"./vue-vendor-CMZ7xYHN.js";const se={class:"card-header"},re={class:"card-header"},ie=Y({__name:"SettingsManagement",setup(oe){const{showAlert:n}=H(),v=o(null),k=o(!1),L=o(!1),p=o(null),u=o([]),C=o(!1),w=o(!1),y=o(null),m=o(!1),g=o(!0),r=Z({key:"",value:"",description:""}),V=a=>a.key,j=ee(()=>g.value?"新增配置项":"编辑配置项"),_=async()=>{k.value=!0,p.value=null;try{const a=await c.getDailyRequestLimit();v.value=a.limit}catch(a){p.value=a instanceof Error?a.message:"加载每日限制失败"}finally{k.value=!1}},F=async()=>{if(v.value===null||v.value<0){n("请设置有效的每日额度","error");return}L.value=!0;try{await c.setDailyRequestLimit(v.value),n("每日额度已更新","success")}catch(a){n(a instanceof Error?a.message:"保存失败","error")}finally{L.value=!1}},P=async()=>{C.value=!0,y.value=null;try{u.value=await c.listSystemConfigs()}catch(a){y.value=a instanceof Error?a.message:"加载配置失败"}finally{C.value=!1}},U=()=>{g.value=!0,r.key="",r.value="",r.description="",m.value=!0},T=a=>{g.value=!1,r.key=a.key,r.value=a.value,r.description=a.description||"",m.value=!0},I=()=>{m.value=!1,w.value=!1},R=async()=>{if(!r.key.trim()||!r.value.trim()){n("Key 与 Value 均为必填项","error");return}w.value=!0;try{let a;if(g.value)a=await c.upsertSystemConfig(r.key.trim(),{value:r.value,description:r.description||void 0}),u.value.unshift(a);else{a=await c.patchSystemConfig(r.key,{value:r.value,description:r.description||void 0});const e=u.value.findIndex(i=>i.key===a.key);e!==-1&&u.value.splice(e,1,a)}n("配置已保存","success"),I()}catch(a){n(a instanceof Error?a.message:"保存失败","error")}finally{w.value=!1}},W=async a=>{try{await c.deleteSystemConfig(a),u.value=u.value.filter(e=>e.key!==a),n("配置已删除","success")}catch(e){n(e instanceof Error?e.message:"删除失败","error")}},$=[{title:"Key",key:"key",width:220,ellipsis:{tooltip:!0}},{title:"值",key:"value",ellipsis:{tooltip:!0}},{title:"描述",key:"description",ellipsis:{tooltip:!0},render(a){return a.description||"—"}},{title:"操作",key:"actions",align:"center",width:160,render(a){return S(N,{justify:"center",size:"small"},{default:()=>[S(d,{size:"small",type:"primary",tertiary:!0,onClick:()=>T(a)},{default:()=>"编辑"}),S(X,{"positive-text":"删除","negative-text":"取消",type:"error",placement:"left",onPositiveClick:()=>W(a.key)},{default:()=>"确认删除该配置项？",trigger:()=>S(d,{size:"small",type:"error",quaternary:!0},{default:()=>"删除"})})]})}}];return ae(()=>{_(),P()}),(a,e)=>(E(),le(te,null,[t(l(N),{vertical:"",size:"large",class:"admin-settings"},{default:s(()=>[t(l(A),{bordered:!1},{header:s(()=>[x("div",se,[e[8]||(e[8]=x("span",{class:"card-title"},"每日请求额度",-1)),t(l(d),{quaternary:"",size:"small",onClick:_,loading:k.value},{default:s(()=>[...e[7]||(e[7]=[f(" 刷新 ",-1)])]),_:1},8,["loading"])])]),default:s(()=>[t(l(K),{show:k.value},{default:s(()=>[p.value?(E(),z(l(h),{key:0,type:"error",closable:"",onClose:e[0]||(e[0]=i=>p.value=null)},{default:s(()=>[f(D(p.value),1)]),_:1})):B("",!0),t(l(q),{"label-placement":"top",class:"limit-form"},{default:s(()=>[t(l(b),{label:"未配置 API Key 的用户每日可用请求次数"},{default:s(()=>[t(l(O),{value:v.value,"onUpdate:value":e[1]||(e[1]=i=>v.value=i),min:0,step:10,placeholder:"请输入每日请求上限"},null,8,["value"])]),_:1}),t(l(N),{justify:"end"},{default:s(()=>[t(l(d),{type:"primary",loading:L.value,onClick:F},{default:s(()=>[...e[9]||(e[9]=[f(" 保存设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["show"])]),_:1}),t(l(A),{bordered:!1},{header:s(()=>[x("div",re,[e[11]||(e[11]=x("span",{class:"card-title"},"系统配置",-1)),t(l(d),{type:"primary",size:"small",onClick:U},{default:s(()=>[...e[10]||(e[10]=[f(" 新增配置 ",-1)])]),_:1})])]),default:s(()=>[t(l(K),{show:C.value},{default:s(()=>[y.value?(E(),z(l(h),{key:0,type:"error",closable:"",onClose:e[2]||(e[2]=i=>y.value=null)},{default:s(()=>[f(D(y.value),1)]),_:1})):B("",!0),t(l(G),{columns:$,data:u.value,loading:C.value,bordered:!1,"row-key":V,class:"config-table"},null,8,["data","loading"])]),_:1},8,["show"])]),_:1})]),_:1}),t(l(Q),{show:m.value,"onUpdate:show":e[6]||(e[6]=i=>m.value=i),preset:"card",title:j.value,class:"config-modal",style:{width:"520px",maxWidth:"92vw"}},{footer:s(()=>[t(l(N),{justify:"end"},{default:s(()=>[t(l(d),{quaternary:"",onClick:I},{default:s(()=>[...e[12]||(e[12]=[f("取消",-1)])]),_:1}),t(l(d),{type:"primary",loading:w.value,onClick:R},{default:s(()=>[...e[13]||(e[13]=[f(" 保存 ",-1)])]),_:1},8,["loading"])]),_:1})]),default:s(()=>[t(l(q),{"label-placement":"top",model:r},{default:s(()=>[t(l(b),{label:"Key"},{default:s(()=>[t(l(M),{value:r.key,"onUpdate:value":e[3]||(e[3]=i=>r.key=i),disabled:!g.value,placeholder:"请输入唯一 Key"},null,8,["value","disabled"])]),_:1}),t(l(b),{label:"值"},{default:s(()=>[t(l(M),{value:r.value,"onUpdate:value":e[4]||(e[4]=i=>r.value=i),placeholder:"配置的具体值"},null,8,["value"])]),_:1}),t(l(b),{label:"描述"},{default:s(()=>[t(l(M),{value:r.description,"onUpdate:value":e[5]||(e[5]=i=>r.description=i),placeholder:"配置项的用途说明，可选"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])],64))}}),fe=J(ie,[["__scopeId","data-v-c6dc6930"]]);export{fe as default};
