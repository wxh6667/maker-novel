import{b as H,A as N,a as J}from"./index-Byhz0bWx.js";import{d as k,f as K,g as O,S,o as q,B as p,p as V,q as y,m as g,r as Q,j as T,s as X}from"./naive-ui-DOxxWvKY.js";import{k as Y,r as d,e as j,o as Z,b as ee,J as x,I as m,O as a,W as l,P as t,H as P,K as L,j as c,N as R,M as f,G as te,F as h,Q as ae}from"./vue-vendor-CMZ7xYHN.js";const le={class:"card-header"},oe={class:"prompt-sidebar"},ne={class:"prompt-item"},se={class:"prompt-name"},re={class:"prompt-editor"},ie={key:0,class:"empty-editor"},ue={key:1,class:"editor-content"},de=Y({__name:"PromptManagement",setup(me){const{showAlert:v}=H(),u=d([]),i=d(null),b=d(!1),z=d(!1),M=d(!1),E=d(!1),w=d(null),s=j({name:"",title:"",content:""}),C=d(!1),r=j({name:"",title:"",content:""}),U=d(!1),B=()=>{U.value=window.innerWidth<920},A=async()=>{b.value=!0,w.value=null;try{if(u.value=await N.listPrompts(),i.value){const o=u.value.find(e=>e.id===i.value?.id);o?_(o):F()}else u.value.length&&_(u.value[0])}catch(o){w.value=o instanceof Error?o.message:"获取提示词列表失败"}finally{b.value=!1}},F=()=>{i.value=null,s.name="",s.title="",s.content=""},_=o=>{i.value=o,s.name=o.name,s.title=o.title||"",s.content=o.content},W=async()=>{if(i.value){if(!s.content.trim()){v("提示词内容不能为空","error");return}z.value=!0;try{const o=await N.updatePrompt(i.value.id,{title:s.title||void 0,content:s.content});_(o);const e=u.value.findIndex(n=>n.id===o.id);e!==-1&&u.value.splice(e,1,o),v("保存成功","success")}catch(o){v(o instanceof Error?o.message:"保存失败","error")}finally{z.value=!1}}},$=async()=>{if(i.value){M.value=!0;try{await N.deletePrompt(i.value.id),v("删除成功","success"),u.value=u.value.filter(o=>o.id!==i.value?.id),F()}catch(o){v(o instanceof Error?o.message:"删除失败","error")}finally{M.value=!1}}},D=()=>{C.value=!0},I=()=>{C.value=!1,r.name="",r.title="",r.content=""},G=async()=>{if(!r.name.trim()||!r.content.trim()){v("名称与内容均为必填项","error");return}E.value=!0;try{const o=await N.createPrompt({name:r.name.trim(),title:r.title?.trim()||void 0,content:r.content});u.value.unshift(o),_(o),v("创建成功","success"),I()}catch(o){v(o instanceof Error?o.message:"创建失败","error")}finally{E.value=!1}};return Z(()=>{B(),window.addEventListener("resize",B),A()}),ee(()=>{window.removeEventListener("resize",B)}),(o,e)=>(m(),x(h,null,[a(t(T),{bordered:!1,class:"admin-card"},{header:l(()=>[f("div",le,[e[10]||(e[10]=f("span",{class:"card-title"},"提示词管理",-1)),a(t(k),{size:12},{default:l(()=>[a(t(p),{quaternary:"",size:"small",onClick:A,loading:b.value},{default:l(()=>[...e[8]||(e[8]=[c(" 刷新 ",-1)])]),_:1},8,["loading"]),a(t(p),{type:"primary",size:"small",onClick:D},{default:l(()=>[...e[9]||(e[9]=[c(" 新建 Prompt ",-1)])]),_:1})]),_:1})])]),default:l(()=>[a(t(k),{vertical:"",size:"large"},{default:l(()=>[w.value?(m(),P(t(K),{key:0,type:"error",closable:"",onClose:e[0]||(e[0]=n=>w.value=null)},{default:l(()=>[c(R(w.value),1)]),_:1})):L("",!0),a(t(O),{show:b.value},{default:l(()=>[f("div",{class:te(["prompt-layout",{mobile:U.value}])},[f("div",oe,[a(t(S),{class:"prompt-scroll"},{default:l(()=>[!u.value.length&&!b.value?(m(),P(t(q),{key:0,description:"暂无提示词"})):(m(),P(t(k),{key:1,vertical:"",size:"small"},{default:l(()=>[(m(!0),x(h,null,ae(u.value,n=>(m(),P(t(p),{key:n.id,type:"primary",ghost:i.value?.id!==n.id,quaternary:"",block:"",onClick:ve=>_(n)},{default:l(()=>[f("div",ne,[f("span",se,R(n.title||n.name),1)])]),_:2},1032,["ghost","onClick"]))),128))]),_:1}))]),_:1})]),f("div",re,[i.value?(m(),x("div",ue,[a(t(S),{class:"editor-form-scroll"},{default:l(()=>[a(t(V),{"label-placement":"top",model:s},{default:l(()=>[a(t(y),{label:"唯一标识"},{default:l(()=>[a(t(g),{value:s.name,"onUpdate:value":e[1]||(e[1]=n=>s.name=n),disabled:""},null,8,["value"])]),_:1}),a(t(y),{label:"标题"},{default:l(()=>[a(t(g),{value:s.title,"onUpdate:value":e[2]||(e[2]=n=>s.title=n),placeholder:"用于后台识别的标题，可为空"},null,8,["value"])]),_:1}),a(t(y),{label:"提示词内容"},{default:l(()=>[a(t(g),{value:s.content,"onUpdate:value":e[3]||(e[3]=n=>s.content=n),type:"textarea",autosize:{minRows:U.value?8:16,maxRows:40},placeholder:"请输入完整的提示词内容...",class:"prompt-textarea"},null,8,["value","autosize"])]),_:1})]),_:1},8,["model"])]),_:1}),a(t(k),{justify:"end",class:"editor-actions"},{default:l(()=>[i.value?(m(),P(t(Q),{key:0,placement:"bottom","positive-text":"删除","negative-text":"取消",type:"error",onPositiveClick:$},{trigger:l(()=>[a(t(p),{type:"error",quaternary:"",loading:M.value},{default:l(()=>[...e[11]||(e[11]=[c(" 删除 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[e[12]||(e[12]=c(" 确认删除该 Prompt？ ",-1))]),_:1})):L("",!0),a(t(p),{type:"primary",loading:z.value,onClick:W},{default:l(()=>[...e[13]||(e[13]=[c(" 保存修改 ",-1)])]),_:1},8,["loading"])]),_:1})])):(m(),x("div",ie,[a(t(q),{description:"请选择一个提示词以编辑"})]))])],2)]),_:1},8,["show"])]),_:1})]),_:1}),a(t(X),{show:C.value,"onUpdate:show":e[7]||(e[7]=n=>C.value=n),preset:"card",title:"新建 Prompt",class:"prompt-modal"},{footer:l(()=>[a(t(k),{justify:"end"},{default:l(()=>[a(t(p),{quaternary:"",onClick:I},{default:l(()=>[...e[14]||(e[14]=[c("取消",-1)])]),_:1}),a(t(p),{type:"primary",loading:E.value,onClick:G},{default:l(()=>[...e[15]||(e[15]=[c("创建",-1)])]),_:1},8,["loading"])]),_:1})]),default:l(()=>[a(t(V),{"label-placement":"top",model:r},{default:l(()=>[a(t(y),{label:"唯一标识（必填）"},{default:l(()=>[a(t(g),{value:r.name,"onUpdate:value":e[4]||(e[4]=n=>r.name=n),placeholder:"例如 concept / outline"},null,8,["value"])]),_:1}),a(t(y),{label:"标题"},{default:l(()=>[a(t(g),{value:r.title,"onUpdate:value":e[5]||(e[5]=n=>r.title=n),placeholder:"可选，用于后台展示"},null,8,["value"])]),_:1}),a(t(y),{label:"内容"},{default:l(()=>[a(t(g),{value:r.content,"onUpdate:value":e[6]||(e[6]=n=>r.content=n),type:"textarea",autosize:{minRows:10,maxRows:30},placeholder:"输入提示词内容..."},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])],64))}}),ye=J(de,[["__scopeId","data-v-47f133cb"]]);export{ye as default};
