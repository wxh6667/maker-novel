import{k as h,e as A,r as v,c as C,H as w,I as i,W as o,O as r,P as e,K as P,j as p,N as S,L as x,M as y}from"./vue-vendor-CMZ7xYHN.js";import{u as B,b as I,A as M,a as U}from"./index-Byhz0bWx.js";import{j as V,f as g,g as j,p as F,q as m,m as c,d as b,B as q}from"./naive-ui-DOxxWvKY.js";const z=h({__name:"PasswordManagement",setup(D){const n=B(),{showAlert:N}=I(),s=A({oldPassword:"",newPassword:"",confirmPassword:""}),d=v(!1),t=v(null),_=C(()=>n.mustChangePassword&&n.user?.is_admin),k=()=>{s.oldPassword="",s.newPassword="",s.confirmPassword=""},f=async()=>{if(t.value=null,!s.oldPassword.trim()||!s.newPassword.trim()){t.value="请填写完整的密码信息";return}if(s.newPassword.length<8){t.value="新密码长度需至少 8 位";return}if(s.newPassword===s.oldPassword){t.value="新密码不能与当前密码相同";return}if(s.newPassword!==s.confirmPassword){t.value="两次输入的新密码不一致";return}d.value=!0;try{await M.changePassword(s.oldPassword,s.newPassword),await n.fetchUser(),k(),await N("密码已更新，请使用新密码继续操作","success")}catch(u){t.value=u instanceof Error?u.message:"密码更新失败"}finally{d.value=!1}};return(u,a)=>(i(),w(e(b),{vertical:"",size:"large",class:"password-container"},{default:o(()=>[r(e(V),{bordered:!1,class:"password-card"},{header:o(()=>[...a[4]||(a[4]=[y("div",{class:"card-header"},[y("span",{class:"card-title"},"管理员密码修改")],-1)])]),default:o(()=>[_.value?(i(),w(e(g),{key:0,type:"warning",class:"mb-4"},{default:o(()=>[...a[5]||(a[5]=[p(" 为保障安全，请先更新默认密码后再继续使用管理后台。 ",-1)])]),_:1})):P("",!0),t.value?(i(),w(e(g),{key:1,type:"error",closable:"",onClose:a[0]||(a[0]=l=>t.value=null),class:"mb-4"},{default:o(()=>[p(S(t.value),1)]),_:1})):P("",!0),r(e(j),{show:d.value},{default:o(()=>[r(e(F),{class:"password-form","label-placement":"top",onSubmit:x(f,["prevent"])},{default:o(()=>[r(e(m),{label:"当前密码"},{default:o(()=>[r(e(c),{value:s.oldPassword,"onUpdate:value":a[1]||(a[1]=l=>s.oldPassword=l),type:"password","show-password-on":"click",placeholder:"请输入当前管理员密码",autocomplete:"current-password"},null,8,["value"])]),_:1}),r(e(m),{label:"新密码"},{default:o(()=>[r(e(c),{value:s.newPassword,"onUpdate:value":a[2]||(a[2]=l=>s.newPassword=l),type:"password","show-password-on":"click",placeholder:"请输入至少 8 位新密码",autocomplete:"new-password"},null,8,["value"])]),_:1}),r(e(m),{label:"确认新密码"},{default:o(()=>[r(e(c),{value:s.confirmPassword,"onUpdate:value":a[3]||(a[3]=l=>s.confirmPassword=l),type:"password","show-password-on":"click",placeholder:"请再次输入新密码",autocomplete:"new-password"},null,8,["value"])]),_:1}),r(e(b),{justify:"end"},{default:o(()=>[r(e(q),{type:"primary",loading:d.value,onClick:f},{default:o(()=>[...a[6]||(a[6]=[p(" 保存新密码 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})]),_:1}))}}),L=U(z,[["__scopeId","data-v-24198e3a"]]);export{L as default};
