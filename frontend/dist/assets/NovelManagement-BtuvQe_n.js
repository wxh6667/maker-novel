import{k as E,r as v,U as L,o as M,b as $,H as d,I as o,W as a,O as m,P as l,K as A,j as _,N as n,J as h,F as P,Q as T,M as s,m as i}from"./vue-vendor-CMZ7xYHN.js";import{A as V,a as I}from"./index-Byhz0bWx.js";import{d as w,f as j,g as F,o as U,j as z,B as C,n as b,l as W}from"./naive-ui-DOxxWvKY.js";const H={class:"card-header"},J={key:1},K={class:"mobile-card-header"},O={class:"mobile-card-title"},Q={class:"mobile-meta"},R={class:"mobile-value"},q={class:"mobile-meta"},G={class:"mobile-value"},X={class:"mobile-meta"},Y={class:"mobile-value"},Z={class:"mobile-meta"},ee={class:"mobile-value"},te=E({__name:"NovelManagement",setup(se){const u=v([]),p=v(!0),c=v(null),y=v(!1),B=L(),S={pageSize:8,showSizePicker:!1},f=()=>{y.value=window.innerWidth<768},g=e=>{if(!e)return"未记录";const t=new Date(e);return Number.isNaN(t.getTime())?"未记录":t.toLocaleString()},k=e=>{const t=e.total_chapters||0;return`${e.completed_chapters||0} / ${t}`},N=e=>{B.push(`/admin/novel/${e}`)},x=[{title:"项目",key:"title",ellipsis:{tooltip:!0},render(e){return i("div",{class:"table-title-cell"},[i("div",{class:"table-title"},e.title),i("div",{class:"table-subtitle"},e.id)])}},{title:"类型",key:"genre",render(e){return i(b,{type:"info",size:"small",round:!0,bordered:!1},{default:()=>e.genre||"未分类"})}},{title:"创作者",key:"owner_username",render(e){return i("span",{class:"table-owner"},e.owner_username)}},{title:"进度",key:"progress",render(e){return i("span",{class:"table-progress"},k(e))}},{title:"最近更新",key:"last_edited",render(e){return i("span",{class:"table-date"},g(e.last_edited))}},{title:"操作",key:"actions",align:"center",render(e){return i(C,{size:"small",type:"primary",tertiary:!0,onClick:()=>N(e.id)},{default:()=>"详情"})}}],D=async()=>{p.value=!0,c.value=null;try{u.value=await V.listNovels()}catch(e){c.value=e instanceof Error?e.message:"获取小说数据失败"}finally{p.value=!1}};return M(()=>{f(),window.addEventListener("resize",f),D()}),$(()=>{window.removeEventListener("resize",f)}),(e,t)=>(o(),d(l(z),{class:"novel-management-card",size:"large",bordered:!1},{header:a(()=>[s("div",H,[t[1]||(t[1]=s("span",{class:"card-title"},"小说管理",-1)),m(l(b),{size:"small",type:"primary",round:""},{default:a(()=>[_("共 "+n(u.value.length)+" 项",1)]),_:1})])]),default:a(()=>[m(l(w),{vertical:"",size:"large"},{default:a(()=>[c.value?(o(),d(l(j),{key:0,type:"error",closable:"",onClose:t[0]||(t[0]=r=>c.value=null)},{default:a(()=>[_(n(c.value),1)]),_:1})):A("",!0),m(l(F),{show:p.value},{default:a(()=>[!u.value.length&&!p.value?(o(),d(l(U),{key:0,description:"暂无小说项目",class:"empty-state"})):(o(),h("div",J,[y.value?(o(),d(l(w),{key:0,vertical:"",size:"large"},{default:a(()=>[(o(!0),h(P,null,T(u.value,r=>(o(),d(l(z),{key:r.id,size:"small",embedded:"",class:"novel-card"},{header:a(()=>[s("div",K,[s("span",O,n(r.title),1),m(l(b),{size:"small",type:"info",round:""},{default:a(()=>[_(n(r.genre||"未分类"),1)]),_:2},1024)])]),footer:a(()=>[m(l(C),{type:"primary",size:"small",block:"",onClick:ae=>N(r.id)},{default:a(()=>[...t[6]||(t[6]=[_(" 查看详情 ",-1)])]),_:1},8,["onClick"])]),default:a(()=>[s("div",Q,[t[2]||(t[2]=s("span",{class:"mobile-label"},"编号",-1)),s("span",R,n(r.id),1)]),s("div",q,[t[3]||(t[3]=s("span",{class:"mobile-label"},"创作者",-1)),s("span",G,n(r.owner_username),1)]),s("div",X,[t[4]||(t[4]=s("span",{class:"mobile-label"},"进度",-1)),s("span",Y,n(k(r)),1)]),s("div",Z,[t[5]||(t[5]=s("span",{class:"mobile-label"},"最近更新",-1)),s("span",ee,n(g(r.last_edited)),1)])]),_:2},1024))),128))]),_:1})):(o(),d(l(W),{key:1,columns:x,data:u.value,pagination:S,bordered:!1,size:"small",class:"novel-table"},null,8,["data"]))]))]),_:1},8,["show"])]),_:1})]),_:1}))}}),ne=I(te,[["__scopeId","data-v-867a5eea"]]);export{ne as default};
