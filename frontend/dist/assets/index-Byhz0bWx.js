const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminView-ulMQGjif.js","assets/vue-vendor-CMZ7xYHN.js","assets/naive-ui-DOxxWvKY.js","assets/AdminView-BhSLKFcm.css","assets/AdminNovelDetail-DplJptjy.js","assets/SettingsView-CjQnEflb.js"])))=>i.map(i=>d[i]);
var uo=Object.defineProperty;var co=(n,e,s)=>e in n?uo(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var ye=(n,e,s)=>co(n,typeof e!="symbol"?e+"":e,s);import{k as W,c as L,H as je,I as c,T as wn,J as p,K as T,L as Ne,M as t,G as Q,N as w,r as S,O as xe,P as we,R as po,F as re,Q as ge,S as yr,U as Et,o as Ee,V as Rs,W as Re,j as Y,X as Ht,Y as mt,w as Se,l as de,Z as ce,n as tt,E as st,_ as _n,z as cs,q as fo,s as wr,$ as rn,a0 as ho,i as nt,y as dt,B as go,m as ne,p as vt,x as mo,e as ls,g as vo,v as Fs,b as bo,a1 as xo,a2 as yo,a3 as wo,a4 as _o}from"./vue-vendor-CMZ7xYHN.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}})();const ko={key:0,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},$o={key:1,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},Co={key:2,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},So={key:3,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},Eo={key:4,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},To={class:"text-lg font-semibold text-gray-800"},Ao={class:"px-6 pb-4"},Mo={class:"text-gray-600 leading-relaxed"},Lo={class:"flex justify-end gap-3 p-6 pt-4 bg-gray-50 rounded-b-2xl"},jo=W({__name:"CustomAlert",props:{visible:{type:Boolean},type:{default:"info"},title:{default:""},message:{},showCancel:{type:Boolean,default:!1},confirmText:{default:"确定"},cancelText:{default:"取消"}},emits:["confirm","cancel","close"],setup(n,{emit:e}){const s=n,r=e,o=L(()=>{if(s.title)return s.title;switch(s.type){case"success":return"操作成功";case"error":return"出现错误";case"warning":return"警告提示";case"confirmation":return"请确认";default:return"提示信息"}}),l=L(()=>{switch(s.type){case"success":return"";case"error":return"";case"warning":return"";default:return""}}),i=L(()=>{switch(s.type){case"success":return"bg-green-500";case"error":return"bg-red-500";case"warning":return"bg-amber-500";case"confirmation":return"bg-gray-500";default:return"bg-blue-500"}}),a=L(()=>{switch(s.type){case"success":return"bg-green-500 hover:bg-green-600 text-white shadow-lg hover:shadow-green-200";case"error":return"bg-red-500 hover:bg-red-600 text-white shadow-lg hover:shadow-red-200";case"warning":return"bg-amber-500 hover:bg-amber-600 text-white shadow-lg hover:shadow-amber-200";case"confirmation":return"bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg hover:shadow-indigo-200";default:return"bg-blue-500 hover:bg-blue-600 text-white shadow-lg hover:shadow-blue-200"}}),u=()=>{r("confirm"),r("close")},d=()=>{r("cancel"),r("close")},f=()=>{r("close")};return(g,m)=>(c(),je(wn,{to:"body"},[n.visible?(c(),p("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:Ne(f,["self"])},[t("div",{class:Q(["bg-white rounded-2xl shadow-2xl max-w-md w-full transform transition-all duration-300 ease-out",n.visible?"scale-100 opacity-100":"scale-95 opacity-0"])},[t("div",{class:Q(["flex items-center p-6 pb-4",l.value])},[t("div",{class:Q(["w-12 h-12 rounded-full flex items-center justify-center mr-4",i.value])},[n.type==="error"?(c(),p("svg",ko,[...m[0]||(m[0]=[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"},null,-1)])])):n.type==="success"?(c(),p("svg",$o,[...m[1]||(m[1]=[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):n.type==="warning"?(c(),p("svg",Co,[...m[2]||(m[2]=[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)])])):n.type==="confirmation"?(c(),p("svg",So,[...m[3]||(m[3]=[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"},null,-1)])])):(c(),p("svg",Eo,[...m[4]||(m[4]=[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"},null,-1)])]))],2),t("div",null,[t("h3",To,w(o.value),1)])],2),t("div",Ao,[t("p",Mo,w(n.message),1)]),t("div",Lo,[n.showCancel?(c(),p("button",{key:0,onClick:d,class:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors duration-200"},w(n.cancelText),1)):T("",!0),t("button",{onClick:u,class:Q(["px-6 py-2 rounded-lg font-medium transition-all duration-200 transform hover:scale-105",a.value])},w(n.confirmText),3)])],2)])):T("",!0)]))}}),Pt=(n,e)=>{const s=n.__vccOpts||n;for(const[r,o]of e)s[r]=o;return s},Oo=Pt(jo,[["__scopeId","data-v-f2cb6798"]]),us=S([]);let zo=0;const _r=(n,e)=>{const s=us.value.findIndex(r=>r.id===n);s!==-1&&(us.value[s].onConfirm(e),us.value.splice(s,1))},Ut=(n,e="info",s="",r={})=>new Promise(o=>{const l=zo++,i={id:l,visible:!0,type:e,title:s||(e==="success"?"成功":e==="error"?"错误":"提示"),message:n,showCancel:r.showCancel||!1,confirmText:r.confirmText||"确定",cancelText:r.cancelText||"取消",onConfirm:o};us.value.push(i),(e==="success"||e==="info")&&!i.showCancel&&setTimeout(()=>{_r(l,!1)},3e3)}),Ro=(n,e="成功")=>Ut(n,"success",e),Po=(n,e="错误")=>Ut(n,"error",e),No=(n,e="提示")=>Ut(n,"info",e),Vo=(n,e="警告")=>Ut(n,"warning",e),Bo=(n,e="请确认")=>Ut(n,"confirmation",e,{showCancel:!0}),X={alerts:us,showAlert:Ut,closeAlert:_r,showSuccess:Ro,showError:Po,showInfo:No,showWarning:Vo,showConfirm:Bo};function Yv(){return{showAlert:X.showAlert}}const Io=W({__name:"App",setup(n){return(e,s)=>(c(),p("div",null,[xe(we(po)),(c(!0),p(re,null,ge(we(X).alerts.value,r=>(c(),je(Oo,{key:r.id,visible:r.visible,type:r.type,title:r.title,message:r.message,"show-cancel":r.showCancel,"confirm-text":r.confirmText,"cancel-text":r.cancelText,onConfirm:o=>we(X).closeAlert(r.id,!0),onCancel:o=>we(X).closeAlert(r.id,!1),onClose:o=>we(X).closeAlert(r.id,!1)},null,8,["visible","type","title","message","show-cancel","confirm-text","cancel-text","onConfirm","onCancel","onClose"]))),128))]))}}),Do="modulepreload",Ho=function(n){return"/"+n},Xn={},qs=function(e,s,r){let o=Promise.resolve();if(s&&s.length>0){let u=function(d){return Promise.all(d.map(f=>Promise.resolve(f).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=i?.nonce||i?.getAttribute("nonce");o=u(s.map(d=>{if(d=Ho(d),d in Xn)return;Xn[d]=!0;const f=d.endsWith(".css"),g=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const m=document.createElement("link");if(m.rel=f?"stylesheet":Do,f||(m.as="script"),m.crossOrigin="",m.href=d,a&&m.setAttribute("nonce",a),document.head.appendChild(m),f)return new Promise((y,x)=>{m.addEventListener("load",y),m.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${d}`)))})}))}function l(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return o.then(i=>{for(const a of i||[])a.status==="rejected"&&l(a.reason);return e().catch(l)})};function kn(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Nt=kn();function kr(n){Nt=n}var ds={exec:()=>null};function me(n,e=""){let s=typeof n=="string"?n:n.source,r={replace:(o,l)=>{let i=typeof l=="string"?l:l.source;return i=i.replace(De.caret,"$1"),s=s.replace(o,i),r},getRegex:()=>new RegExp(s,e)};return r}var De={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:n=>new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}#`),htmlBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}<(?:[a-z].*>|!--)`,"i")},Uo=/^(?:[ \t]*(?:\n|$))+/,Fo=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,qo=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,ps=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Wo=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,$n=/(?:[*+-]|\d{1,9}[.)])/,$r=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Cr=me($r).replace(/bull/g,$n).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Go=me($r).replace(/bull/g,$n).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Cn=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Jo=/^[^\n]+/,Sn=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Zo=me(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Sn).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Yo=me(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,$n).getRegex(),Ps="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",En=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Xo=me("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",En).replace("tag",Ps).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Sr=me(Cn).replace("hr",ps).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ps).getRegex(),Ko=me(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Sr).getRegex(),Tn={blockquote:Ko,code:Fo,def:Zo,fences:qo,heading:Wo,hr:ps,html:Xo,lheading:Cr,list:Yo,newline:Uo,paragraph:Sr,table:ds,text:Jo},Kn=me("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",ps).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ps).getRegex(),Qo={...Tn,lheading:Go,table:Kn,paragraph:me(Cn).replace("hr",ps).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Kn).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ps).getRegex()},el={...Tn,html:me(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",En).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ds,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:me(Cn).replace("hr",ps).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Cr).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},tl=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,sl=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Er=/^( {2,}|\\)\n(?!\s*$)/,nl=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ns=/[\p{P}\p{S}]/u,An=/[\s\p{P}\p{S}]/u,Tr=/[^\s\p{P}\p{S}]/u,rl=me(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,An).getRegex(),Ar=/(?!~)[\p{P}\p{S}]/u,ol=/(?!~)[\s\p{P}\p{S}]/u,ll=/(?:[^\s\p{P}\p{S}]|~)/u,al=/\[(?:[^\[\]`]|`[^`]*?`)*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)|`[^`]*?`|<(?! )[^<>]*?>/g,Mr=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,il=me(Mr,"u").replace(/punct/g,Ns).getRegex(),ul=me(Mr,"u").replace(/punct/g,Ar).getRegex(),Lr="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",dl=me(Lr,"gu").replace(/notPunctSpace/g,Tr).replace(/punctSpace/g,An).replace(/punct/g,Ns).getRegex(),cl=me(Lr,"gu").replace(/notPunctSpace/g,ll).replace(/punctSpace/g,ol).replace(/punct/g,Ar).getRegex(),pl=me("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Tr).replace(/punctSpace/g,An).replace(/punct/g,Ns).getRegex(),fl=me(/\\(punct)/,"gu").replace(/punct/g,Ns).getRegex(),hl=me(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),gl=me(En).replace("(?:-->|$)","-->").getRegex(),ml=me("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",gl).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Ms=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,vl=me(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Ms).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),jr=me(/^!?\[(label)\]\[(ref)\]/).replace("label",Ms).replace("ref",Sn).getRegex(),Or=me(/^!?\[(ref)\](?:\[\])?/).replace("ref",Sn).getRegex(),bl=me("reflink|nolink(?!\\()","g").replace("reflink",jr).replace("nolink",Or).getRegex(),Qn=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Mn={_backpedal:ds,anyPunctuation:fl,autolink:hl,blockSkip:al,br:Er,code:sl,del:ds,emStrongLDelim:il,emStrongRDelimAst:dl,emStrongRDelimUnd:pl,escape:tl,link:vl,nolink:Or,punctuation:rl,reflink:jr,reflinkSearch:bl,tag:ml,text:nl,url:ds},xl={...Mn,link:me(/^!?\[(label)\]\((.*?)\)/).replace("label",Ms).getRegex(),reflink:me(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Ms).getRegex()},on={...Mn,emStrongRDelimAst:cl,emStrongLDelim:ul,url:me(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Qn).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:me(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Qn).getRegex()},yl={...on,br:me(Er).replace("{2,}","*").getRegex(),text:me(on.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ys={normal:Tn,gfm:Qo,pedantic:el},Xt={normal:Mn,gfm:on,breaks:yl,pedantic:xl},wl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},er=n=>wl[n];function ht(n,e){if(e){if(De.escapeTest.test(n))return n.replace(De.escapeReplace,er)}else if(De.escapeTestNoEncode.test(n))return n.replace(De.escapeReplaceNoEncode,er);return n}function tr(n){try{n=encodeURI(n).replace(De.percentDecode,"%")}catch{return null}return n}function sr(n,e){let s=n.replace(De.findPipe,(l,i,a)=>{let u=!1,d=i;for(;--d>=0&&a[d]==="\\";)u=!u;return u?"|":" |"}),r=s.split(De.splitPipe),o=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;o<r.length;o++)r[o]=r[o].trim().replace(De.slashPipe,"|");return r}function Kt(n,e,s){let r=n.length;if(r===0)return"";let o=0;for(;o<r&&n.charAt(r-o-1)===e;)o++;return n.slice(0,r-o)}function _l(n,e){if(n.indexOf(e[1])===-1)return-1;let s=0;for(let r=0;r<n.length;r++)if(n[r]==="\\")r++;else if(n[r]===e[0])s++;else if(n[r]===e[1]&&(s--,s<0))return r;return s>0?-2:-1}function nr(n,e,s,r,o){let l=e.href,i=e.title||null,a=n[1].replace(o.other.outputLinkReplace,"$1");r.state.inLink=!0;let u={type:n[0].charAt(0)==="!"?"image":"link",raw:s,href:l,title:i,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,u}function kl(n,e,s){let r=n.match(s.other.indentCodeCompensation);if(r===null)return e;let o=r[1];return e.split(`
`).map(l=>{let i=l.match(s.other.beginningSpace);if(i===null)return l;let[a]=i;return a.length>=o.length?l.slice(o.length):l}).join(`
`)}var Ls=class{constructor(e){ye(this,"options");ye(this,"rules");ye(this,"lexer");this.options=e||Nt}space(e){let s=this.rules.block.newline.exec(e);if(s&&s[0].length>0)return{type:"space",raw:s[0]}}code(e){let s=this.rules.block.code.exec(e);if(s){let r=s[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:s[0],codeBlockStyle:"indented",text:this.options.pedantic?r:Kt(r,`
`)}}}fences(e){let s=this.rules.block.fences.exec(e);if(s){let r=s[0],o=kl(r,s[3]||"",this.rules);return{type:"code",raw:r,lang:s[2]?s[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):s[2],text:o}}}heading(e){let s=this.rules.block.heading.exec(e);if(s){let r=s[2].trim();if(this.rules.other.endingHash.test(r)){let o=Kt(r,"#");(this.options.pedantic||!o||this.rules.other.endingSpaceChar.test(o))&&(r=o.trim())}return{type:"heading",raw:s[0],depth:s[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){let s=this.rules.block.hr.exec(e);if(s)return{type:"hr",raw:Kt(s[0],`
`)}}blockquote(e){let s=this.rules.block.blockquote.exec(e);if(s){let r=Kt(s[0],`
`).split(`
`),o="",l="",i=[];for(;r.length>0;){let a=!1,u=[],d;for(d=0;d<r.length;d++)if(this.rules.other.blockquoteStart.test(r[d]))u.push(r[d]),a=!0;else if(!a)u.push(r[d]);else break;r=r.slice(d);let f=u.join(`
`),g=f.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");o=o?`${o}
${f}`:f,l=l?`${l}
${g}`:g;let m=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(g,i,!0),this.lexer.state.top=m,r.length===0)break;let y=i.at(-1);if(y?.type==="code")break;if(y?.type==="blockquote"){let x=y,_=x.raw+`
`+r.join(`
`),k=this.blockquote(_);i[i.length-1]=k,o=o.substring(0,o.length-x.raw.length)+k.raw,l=l.substring(0,l.length-x.text.length)+k.text;break}else if(y?.type==="list"){let x=y,_=x.raw+`
`+r.join(`
`),k=this.list(_);i[i.length-1]=k,o=o.substring(0,o.length-y.raw.length)+k.raw,l=l.substring(0,l.length-x.raw.length)+k.raw,r=_.substring(i.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:o,tokens:i,text:l}}}list(e){let s=this.rules.block.list.exec(e);if(s){let r=s[1].trim(),o=r.length>1,l={type:"list",raw:"",ordered:o,start:o?+r.slice(0,-1):"",loose:!1,items:[]};r=o?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=o?r:"[*+-]");let i=this.rules.other.listItemRegex(r),a=!1;for(;e;){let d=!1,f="",g="";if(!(s=i.exec(e))||this.rules.block.hr.test(e))break;f=s[0],e=e.substring(f.length);let m=s[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,R=>" ".repeat(3*R.length)),y=e.split(`
`,1)[0],x=!m.trim(),_=0;if(this.options.pedantic?(_=2,g=m.trimStart()):x?_=s[1].length+1:(_=s[2].search(this.rules.other.nonSpaceChar),_=_>4?1:_,g=m.slice(_),_+=s[1].length),x&&this.rules.other.blankLine.test(y)&&(f+=y+`
`,e=e.substring(y.length+1),d=!0),!d){let R=this.rules.other.nextBulletRegex(_),P=this.rules.other.hrRegex(_),D=this.rules.other.fencesBeginRegex(_),ee=this.rules.other.headingBeginRegex(_),te=this.rules.other.htmlBeginRegex(_);for(;e;){let E=e.split(`
`,1)[0],C;if(y=E,this.options.pedantic?(y=y.replace(this.rules.other.listReplaceNesting,"  "),C=y):C=y.replace(this.rules.other.tabCharGlobal,"    "),D.test(y)||ee.test(y)||te.test(y)||R.test(y)||P.test(y))break;if(C.search(this.rules.other.nonSpaceChar)>=_||!y.trim())g+=`
`+C.slice(_);else{if(x||m.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||D.test(m)||ee.test(m)||P.test(m))break;g+=`
`+y}!x&&!y.trim()&&(x=!0),f+=E+`
`,e=e.substring(E.length+1),m=C.slice(_)}}l.loose||(a?l.loose=!0:this.rules.other.doubleBlankLine.test(f)&&(a=!0));let k=null,O;this.options.gfm&&(k=this.rules.other.listIsTask.exec(g),k&&(O=k[0]!=="[ ] ",g=g.replace(this.rules.other.listReplaceTask,""))),l.items.push({type:"list_item",raw:f,task:!!k,checked:O,loose:!1,text:g,tokens:[]}),l.raw+=f}let u=l.items.at(-1);if(u)u.raw=u.raw.trimEnd(),u.text=u.text.trimEnd();else return;l.raw=l.raw.trimEnd();for(let d=0;d<l.items.length;d++)if(this.lexer.state.top=!1,l.items[d].tokens=this.lexer.blockTokens(l.items[d].text,[]),!l.loose){let f=l.items[d].tokens.filter(m=>m.type==="space"),g=f.length>0&&f.some(m=>this.rules.other.anyLine.test(m.raw));l.loose=g}if(l.loose)for(let d=0;d<l.items.length;d++)l.items[d].loose=!0;return l}}html(e){let s=this.rules.block.html.exec(e);if(s)return{type:"html",block:!0,raw:s[0],pre:s[1]==="pre"||s[1]==="script"||s[1]==="style",text:s[0]}}def(e){let s=this.rules.block.def.exec(e);if(s){let r=s[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),o=s[2]?s[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",l=s[3]?s[3].substring(1,s[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):s[3];return{type:"def",tag:r,raw:s[0],href:o,title:l}}}table(e){let s=this.rules.block.table.exec(e);if(!s||!this.rules.other.tableDelimiter.test(s[2]))return;let r=sr(s[1]),o=s[2].replace(this.rules.other.tableAlignChars,"").split("|"),l=s[3]?.trim()?s[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],i={type:"table",raw:s[0],header:[],align:[],rows:[]};if(r.length===o.length){for(let a of o)this.rules.other.tableAlignRight.test(a)?i.align.push("right"):this.rules.other.tableAlignCenter.test(a)?i.align.push("center"):this.rules.other.tableAlignLeft.test(a)?i.align.push("left"):i.align.push(null);for(let a=0;a<r.length;a++)i.header.push({text:r[a],tokens:this.lexer.inline(r[a]),header:!0,align:i.align[a]});for(let a of l)i.rows.push(sr(a,i.header.length).map((u,d)=>({text:u,tokens:this.lexer.inline(u),header:!1,align:i.align[d]})));return i}}lheading(e){let s=this.rules.block.lheading.exec(e);if(s)return{type:"heading",raw:s[0],depth:s[2].charAt(0)==="="?1:2,text:s[1],tokens:this.lexer.inline(s[1])}}paragraph(e){let s=this.rules.block.paragraph.exec(e);if(s){let r=s[1].charAt(s[1].length-1)===`
`?s[1].slice(0,-1):s[1];return{type:"paragraph",raw:s[0],text:r,tokens:this.lexer.inline(r)}}}text(e){let s=this.rules.block.text.exec(e);if(s)return{type:"text",raw:s[0],text:s[0],tokens:this.lexer.inline(s[0])}}escape(e){let s=this.rules.inline.escape.exec(e);if(s)return{type:"escape",raw:s[0],text:s[1]}}tag(e){let s=this.rules.inline.tag.exec(e);if(s)return!this.lexer.state.inLink&&this.rules.other.startATag.test(s[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(s[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(s[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(s[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:s[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:s[0]}}link(e){let s=this.rules.inline.link.exec(e);if(s){let r=s[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let i=Kt(r.slice(0,-1),"\\");if((r.length-i.length)%2===0)return}else{let i=_l(s[2],"()");if(i===-2)return;if(i>-1){let a=(s[0].indexOf("!")===0?5:4)+s[1].length+i;s[2]=s[2].substring(0,i),s[0]=s[0].substring(0,a).trim(),s[3]=""}}let o=s[2],l="";if(this.options.pedantic){let i=this.rules.other.pedanticHrefTitle.exec(o);i&&(o=i[1],l=i[3])}else l=s[3]?s[3].slice(1,-1):"";return o=o.trim(),this.rules.other.startAngleBracket.test(o)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?o=o.slice(1):o=o.slice(1,-1)),nr(s,{href:o&&o.replace(this.rules.inline.anyPunctuation,"$1"),title:l&&l.replace(this.rules.inline.anyPunctuation,"$1")},s[0],this.lexer,this.rules)}}reflink(e,s){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let o=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),l=s[o.toLowerCase()];if(!l){let i=r[0].charAt(0);return{type:"text",raw:i,text:i}}return nr(r,l,r[0],this.lexer,this.rules)}}emStrong(e,s,r=""){let o=this.rules.inline.emStrongLDelim.exec(e);if(!(!o||o[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(o[1]||o[2])||!r||this.rules.inline.punctuation.exec(r))){let l=[...o[0]].length-1,i,a,u=l,d=0,f=o[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(f.lastIndex=0,s=s.slice(-1*e.length+l);(o=f.exec(s))!=null;){if(i=o[1]||o[2]||o[3]||o[4]||o[5]||o[6],!i)continue;if(a=[...i].length,o[3]||o[4]){u+=a;continue}else if((o[5]||o[6])&&l%3&&!((l+a)%3)){d+=a;continue}if(u-=a,u>0)continue;a=Math.min(a,a+u+d);let g=[...o[0]][0].length,m=e.slice(0,l+o.index+g+a);if(Math.min(l,a)%2){let x=m.slice(1,-1);return{type:"em",raw:m,text:x,tokens:this.lexer.inlineTokens(x)}}let y=m.slice(2,-2);return{type:"strong",raw:m,text:y,tokens:this.lexer.inlineTokens(y)}}}}codespan(e){let s=this.rules.inline.code.exec(e);if(s){let r=s[2].replace(this.rules.other.newLineCharGlobal," "),o=this.rules.other.nonSpaceChar.test(r),l=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return o&&l&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:s[0],text:r}}}br(e){let s=this.rules.inline.br.exec(e);if(s)return{type:"br",raw:s[0]}}del(e){let s=this.rules.inline.del.exec(e);if(s)return{type:"del",raw:s[0],text:s[2],tokens:this.lexer.inlineTokens(s[2])}}autolink(e){let s=this.rules.inline.autolink.exec(e);if(s){let r,o;return s[2]==="@"?(r=s[1],o="mailto:"+r):(r=s[1],o=r),{type:"link",raw:s[0],text:r,href:o,tokens:[{type:"text",raw:r,text:r}]}}}url(e){let s;if(s=this.rules.inline.url.exec(e)){let r,o;if(s[2]==="@")r=s[0],o="mailto:"+r;else{let l;do l=s[0],s[0]=this.rules.inline._backpedal.exec(s[0])?.[0]??"";while(l!==s[0]);r=s[0],s[1]==="www."?o="http://"+s[0]:o=s[0]}return{type:"link",raw:s[0],text:r,href:o,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(e){let s=this.rules.inline.text.exec(e);if(s){let r=this.lexer.state.inRawBlock;return{type:"text",raw:s[0],text:s[0],escaped:r}}}},it=class ln{constructor(e){ye(this,"tokens");ye(this,"options");ye(this,"state");ye(this,"tokenizer");ye(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Nt,this.options.tokenizer=this.options.tokenizer||new Ls,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let s={other:De,block:ys.normal,inline:Xt.normal};this.options.pedantic?(s.block=ys.pedantic,s.inline=Xt.pedantic):this.options.gfm&&(s.block=ys.gfm,this.options.breaks?s.inline=Xt.breaks:s.inline=Xt.gfm),this.tokenizer.rules=s}static get rules(){return{block:ys,inline:Xt}}static lex(e,s){return new ln(s).lex(e)}static lexInline(e,s){return new ln(s).inlineTokens(e)}lex(e){e=e.replace(De.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let s=0;s<this.inlineQueue.length;s++){let r=this.inlineQueue[s];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,s=[],r=!1){for(this.options.pedantic&&(e=e.replace(De.tabCharGlobal,"    ").replace(De.spaceLine,""));e;){let o;if(this.options.extensions?.block?.some(i=>(o=i.call({lexer:this},e,s))?(e=e.substring(o.raw.length),s.push(o),!0):!1))continue;if(o=this.tokenizer.space(e)){e=e.substring(o.raw.length);let i=s.at(-1);o.raw.length===1&&i!==void 0?i.raw+=`
`:s.push(o);continue}if(o=this.tokenizer.code(e)){e=e.substring(o.raw.length);let i=s.at(-1);i?.type==="paragraph"||i?.type==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+o.raw,i.text+=`
`+o.text,this.inlineQueue.at(-1).src=i.text):s.push(o);continue}if(o=this.tokenizer.fences(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.heading(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.hr(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.blockquote(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.list(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.html(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.def(e)){e=e.substring(o.raw.length);let i=s.at(-1);i?.type==="paragraph"||i?.type==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+o.raw,i.text+=`
`+o.raw,this.inlineQueue.at(-1).src=i.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title},s.push(o));continue}if(o=this.tokenizer.table(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.lheading(e)){e=e.substring(o.raw.length),s.push(o);continue}let l=e;if(this.options.extensions?.startBlock){let i=1/0,a=e.slice(1),u;this.options.extensions.startBlock.forEach(d=>{u=d.call({lexer:this},a),typeof u=="number"&&u>=0&&(i=Math.min(i,u))}),i<1/0&&i>=0&&(l=e.substring(0,i+1))}if(this.state.top&&(o=this.tokenizer.paragraph(l))){let i=s.at(-1);r&&i?.type==="paragraph"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+o.raw,i.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):s.push(o),r=l.length!==e.length,e=e.substring(o.raw.length);continue}if(o=this.tokenizer.text(e)){e=e.substring(o.raw.length);let i=s.at(-1);i?.type==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+o.raw,i.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):s.push(o);continue}if(e){let i="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(i);break}else throw new Error(i)}}return this.state.top=!0,s}inline(e,s=[]){return this.inlineQueue.push({src:e,tokens:s}),s}inlineTokens(e,s=[]){let r=e,o=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)a.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,o.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(o=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)r=r.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=this.options.hooks?.emStrongMask?.call({lexer:this},r)??r;let l=!1,i="";for(;e;){l||(i=""),l=!1;let a;if(this.options.extensions?.inline?.some(d=>(a=d.call({lexer:this},e,s))?(e=e.substring(a.raw.length),s.push(a),!0):!1))continue;if(a=this.tokenizer.escape(e)){e=e.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.tag(e)){e=e.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.link(e)){e=e.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(a.raw.length);let d=s.at(-1);a.type==="text"&&d?.type==="text"?(d.raw+=a.raw,d.text+=a.text):s.push(a);continue}if(a=this.tokenizer.emStrong(e,r,i)){e=e.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.codespan(e)){e=e.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.br(e)){e=e.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.del(e)){e=e.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.autolink(e)){e=e.substring(a.raw.length),s.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(e))){e=e.substring(a.raw.length),s.push(a);continue}let u=e;if(this.options.extensions?.startInline){let d=1/0,f=e.slice(1),g;this.options.extensions.startInline.forEach(m=>{g=m.call({lexer:this},f),typeof g=="number"&&g>=0&&(d=Math.min(d,g))}),d<1/0&&d>=0&&(u=e.substring(0,d+1))}if(a=this.tokenizer.inlineText(u)){e=e.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(i=a.raw.slice(-1)),l=!0;let d=s.at(-1);d?.type==="text"?(d.raw+=a.raw,d.text+=a.text):s.push(a);continue}if(e){let d="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return s}},js=class{constructor(e){ye(this,"options");ye(this,"parser");this.options=e||Nt}space(e){return""}code({text:e,lang:s,escaped:r}){let o=(s||"").match(De.notSpaceStart)?.[0],l=e.replace(De.endingNewline,"")+`
`;return o?'<pre><code class="language-'+ht(o)+'">'+(r?l:ht(l,!0))+`</code></pre>
`:"<pre><code>"+(r?l:ht(l,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}def(e){return""}heading({tokens:e,depth:s}){return`<h${s}>${this.parser.parseInline(e)}</h${s}>
`}hr(e){return`<hr>
`}list(e){let s=e.ordered,r=e.start,o="";for(let a=0;a<e.items.length;a++){let u=e.items[a];o+=this.listitem(u)}let l=s?"ol":"ul",i=s&&r!==1?' start="'+r+'"':"";return"<"+l+i+`>
`+o+"</"+l+`>
`}listitem(e){let s="";if(e.task){let r=this.checkbox({checked:!!e.checked});e.loose?e.tokens[0]?.type==="paragraph"?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=r+" "+ht(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):s+=r+" "}return s+=this.parser.parse(e.tokens,!!e.loose),`<li>${s}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let s="",r="";for(let l=0;l<e.header.length;l++)r+=this.tablecell(e.header[l]);s+=this.tablerow({text:r});let o="";for(let l=0;l<e.rows.length;l++){let i=e.rows[l];r="";for(let a=0;a<i.length;a++)r+=this.tablecell(i[a]);o+=this.tablerow({text:r})}return o&&(o=`<tbody>${o}</tbody>`),`<table>
<thead>
`+s+`</thead>
`+o+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let s=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?`<${r} align="${e.align}">`:`<${r}>`)+s+`</${r}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${ht(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:s,tokens:r}){let o=this.parser.parseInline(r),l=tr(e);if(l===null)return o;e=l;let i='<a href="'+e+'"';return s&&(i+=' title="'+ht(s)+'"'),i+=">"+o+"</a>",i}image({href:e,title:s,text:r,tokens:o}){o&&(r=this.parser.parseInline(o,this.parser.textRenderer));let l=tr(e);if(l===null)return ht(r);e=l;let i=`<img src="${e}" alt="${r}"`;return s&&(i+=` title="${ht(s)}"`),i+=">",i}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:ht(e.text)}},Ln=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},ut=class an{constructor(e){ye(this,"options");ye(this,"renderer");ye(this,"textRenderer");this.options=e||Nt,this.options.renderer=this.options.renderer||new js,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Ln}static parse(e,s){return new an(s).parse(e)}static parseInline(e,s){return new an(s).parseInline(e)}parse(e,s=!0){let r="";for(let o=0;o<e.length;o++){let l=e[o];if(this.options.extensions?.renderers?.[l.type]){let a=l,u=this.options.extensions.renderers[a.type].call({parser:this},a);if(u!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(a.type)){r+=u||"";continue}}let i=l;switch(i.type){case"space":{r+=this.renderer.space(i);continue}case"hr":{r+=this.renderer.hr(i);continue}case"heading":{r+=this.renderer.heading(i);continue}case"code":{r+=this.renderer.code(i);continue}case"table":{r+=this.renderer.table(i);continue}case"blockquote":{r+=this.renderer.blockquote(i);continue}case"list":{r+=this.renderer.list(i);continue}case"html":{r+=this.renderer.html(i);continue}case"def":{r+=this.renderer.def(i);continue}case"paragraph":{r+=this.renderer.paragraph(i);continue}case"text":{let a=i,u=this.renderer.text(a);for(;o+1<e.length&&e[o+1].type==="text";)a=e[++o],u+=`
`+this.renderer.text(a);s?r+=this.renderer.paragraph({type:"paragraph",raw:u,text:u,tokens:[{type:"text",raw:u,text:u,escaped:!0}]}):r+=u;continue}default:{let a='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}parseInline(e,s=this.renderer){let r="";for(let o=0;o<e.length;o++){let l=e[o];if(this.options.extensions?.renderers?.[l.type]){let a=this.options.extensions.renderers[l.type].call({parser:this},l);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){r+=a||"";continue}}let i=l;switch(i.type){case"escape":{r+=s.text(i);break}case"html":{r+=s.html(i);break}case"link":{r+=s.link(i);break}case"image":{r+=s.image(i);break}case"strong":{r+=s.strong(i);break}case"em":{r+=s.em(i);break}case"codespan":{r+=s.codespan(i);break}case"br":{r+=s.br(i);break}case"del":{r+=s.del(i);break}case"text":{r+=s.text(i);break}default:{let a='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}},Es,as=(Es=class{constructor(e){ye(this,"options");ye(this,"block");this.options=e||Nt}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}emStrongMask(e){return e}provideLexer(){return this.block?it.lex:it.lexInline}provideParser(){return this.block?ut.parse:ut.parseInline}},ye(Es,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),ye(Es,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),Es),$l=class{constructor(...e){ye(this,"defaults",kn());ye(this,"options",this.setOptions);ye(this,"parse",this.parseMarkdown(!0));ye(this,"parseInline",this.parseMarkdown(!1));ye(this,"Parser",ut);ye(this,"Renderer",js);ye(this,"TextRenderer",Ln);ye(this,"Lexer",it);ye(this,"Tokenizer",Ls);ye(this,"Hooks",as);this.use(...e)}walkTokens(e,s){let r=[];for(let o of e)switch(r=r.concat(s.call(this,o)),o.type){case"table":{let l=o;for(let i of l.header)r=r.concat(this.walkTokens(i.tokens,s));for(let i of l.rows)for(let a of i)r=r.concat(this.walkTokens(a.tokens,s));break}case"list":{let l=o;r=r.concat(this.walkTokens(l.items,s));break}default:{let l=o;this.defaults.extensions?.childTokens?.[l.type]?this.defaults.extensions.childTokens[l.type].forEach(i=>{let a=l[i].flat(1/0);r=r.concat(this.walkTokens(a,s))}):l.tokens&&(r=r.concat(this.walkTokens(l.tokens,s)))}}return r}use(...e){let s=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(r=>{let o={...r};if(o.async=this.defaults.async||o.async||!1,r.extensions&&(r.extensions.forEach(l=>{if(!l.name)throw new Error("extension name required");if("renderer"in l){let i=s.renderers[l.name];i?s.renderers[l.name]=function(...a){let u=l.renderer.apply(this,a);return u===!1&&(u=i.apply(this,a)),u}:s.renderers[l.name]=l.renderer}if("tokenizer"in l){if(!l.level||l.level!=="block"&&l.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let i=s[l.level];i?i.unshift(l.tokenizer):s[l.level]=[l.tokenizer],l.start&&(l.level==="block"?s.startBlock?s.startBlock.push(l.start):s.startBlock=[l.start]:l.level==="inline"&&(s.startInline?s.startInline.push(l.start):s.startInline=[l.start]))}"childTokens"in l&&l.childTokens&&(s.childTokens[l.name]=l.childTokens)}),o.extensions=s),r.renderer){let l=this.defaults.renderer||new js(this.defaults);for(let i in r.renderer){if(!(i in l))throw new Error(`renderer '${i}' does not exist`);if(["options","parser"].includes(i))continue;let a=i,u=r.renderer[a],d=l[a];l[a]=(...f)=>{let g=u.apply(l,f);return g===!1&&(g=d.apply(l,f)),g||""}}o.renderer=l}if(r.tokenizer){let l=this.defaults.tokenizer||new Ls(this.defaults);for(let i in r.tokenizer){if(!(i in l))throw new Error(`tokenizer '${i}' does not exist`);if(["options","rules","lexer"].includes(i))continue;let a=i,u=r.tokenizer[a],d=l[a];l[a]=(...f)=>{let g=u.apply(l,f);return g===!1&&(g=d.apply(l,f)),g}}o.tokenizer=l}if(r.hooks){let l=this.defaults.hooks||new as;for(let i in r.hooks){if(!(i in l))throw new Error(`hook '${i}' does not exist`);if(["options","block"].includes(i))continue;let a=i,u=r.hooks[a],d=l[a];as.passThroughHooks.has(i)?l[a]=f=>{if(this.defaults.async&&as.passThroughHooksRespectAsync.has(i))return(async()=>{let m=await u.call(l,f);return d.call(l,m)})();let g=u.call(l,f);return d.call(l,g)}:l[a]=(...f)=>{if(this.defaults.async)return(async()=>{let m=await u.apply(l,f);return m===!1&&(m=await d.apply(l,f)),m})();let g=u.apply(l,f);return g===!1&&(g=d.apply(l,f)),g}}o.hooks=l}if(r.walkTokens){let l=this.defaults.walkTokens,i=r.walkTokens;o.walkTokens=function(a){let u=[];return u.push(i.call(this,a)),l&&(u=u.concat(l.call(this,a))),u}}this.defaults={...this.defaults,...o}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,s){return it.lex(e,s??this.defaults)}parser(e,s){return ut.parse(e,s??this.defaults)}parseMarkdown(e){return(s,r)=>{let o={...r},l={...this.defaults,...o},i=this.onError(!!l.silent,!!l.async);if(this.defaults.async===!0&&o.async===!1)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof s>"u"||s===null)return i(new Error("marked(): input parameter is undefined or null"));if(typeof s!="string")return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(s)+", string expected"));if(l.hooks&&(l.hooks.options=l,l.hooks.block=e),l.async)return(async()=>{let a=l.hooks?await l.hooks.preprocess(s):s,u=await(l.hooks?await l.hooks.provideLexer():e?it.lex:it.lexInline)(a,l),d=l.hooks?await l.hooks.processAllTokens(u):u;l.walkTokens&&await Promise.all(this.walkTokens(d,l.walkTokens));let f=await(l.hooks?await l.hooks.provideParser():e?ut.parse:ut.parseInline)(d,l);return l.hooks?await l.hooks.postprocess(f):f})().catch(i);try{l.hooks&&(s=l.hooks.preprocess(s));let a=(l.hooks?l.hooks.provideLexer():e?it.lex:it.lexInline)(s,l);l.hooks&&(a=l.hooks.processAllTokens(a)),l.walkTokens&&this.walkTokens(a,l.walkTokens);let u=(l.hooks?l.hooks.provideParser():e?ut.parse:ut.parseInline)(a,l);return l.hooks&&(u=l.hooks.postprocess(u)),u}catch(a){return i(a)}}}onError(e,s){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let o="<p>An error occurred:</p><pre>"+ht(r.message+"",!0)+"</pre>";return s?Promise.resolve(o):o}if(s)return Promise.reject(r);throw r}}},zt=new $l;function pe(n,e){return zt.parse(n,e)}pe.options=pe.setOptions=function(n){return zt.setOptions(n),pe.defaults=zt.defaults,kr(pe.defaults),pe};pe.getDefaults=kn;pe.defaults=Nt;pe.use=function(...n){return zt.use(...n),pe.defaults=zt.defaults,kr(pe.defaults),pe};pe.walkTokens=function(n,e){return zt.walkTokens(n,e)};pe.parseInline=zt.parseInline;pe.Parser=ut;pe.parser=ut.parse;pe.Renderer=js;pe.TextRenderer=Ln;pe.Lexer=it;pe.lexer=it.lex;pe.Tokenizer=Ls;pe.Hooks=as;pe.parse=pe;pe.options;pe.setOptions;pe.use;pe.walkTokens;pe.parseInline;ut.parse;it.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:zr,setPrototypeOf:rr,isFrozen:Cl,getPrototypeOf:Sl,getOwnPropertyDescriptor:El}=Object;let{freeze:He,seal:rt,create:un}=Object,{apply:dn,construct:cn}=typeof Reflect<"u"&&Reflect;He||(He=function(e){return e});rt||(rt=function(e){return e});dn||(dn=function(e,s){for(var r=arguments.length,o=new Array(r>2?r-2:0),l=2;l<r;l++)o[l-2]=arguments[l];return e.apply(s,o)});cn||(cn=function(e){for(var s=arguments.length,r=new Array(s>1?s-1:0),o=1;o<s;o++)r[o-1]=arguments[o];return new e(...r)});const ws=Ue(Array.prototype.forEach),Tl=Ue(Array.prototype.lastIndexOf),or=Ue(Array.prototype.pop),Qt=Ue(Array.prototype.push),Al=Ue(Array.prototype.splice),Ts=Ue(String.prototype.toLowerCase),Ws=Ue(String.prototype.toString),Gs=Ue(String.prototype.match),es=Ue(String.prototype.replace),Ml=Ue(String.prototype.indexOf),Ll=Ue(String.prototype.trim),at=Ue(Object.prototype.hasOwnProperty),Ie=Ue(RegExp.prototype.test),ts=jl(TypeError);function Ue(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var s=arguments.length,r=new Array(s>1?s-1:0),o=1;o<s;o++)r[o-1]=arguments[o];return dn(n,e,r)}}function jl(n){return function(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return cn(n,s)}}function ae(n,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ts;rr&&rr(n,null);let r=e.length;for(;r--;){let o=e[r];if(typeof o=="string"){const l=s(o);l!==o&&(Cl(e)||(e[r]=l),o=l)}n[o]=!0}return n}function Ol(n){for(let e=0;e<n.length;e++)at(n,e)||(n[e]=null);return n}function gt(n){const e=un(null);for(const[s,r]of zr(n))at(n,s)&&(Array.isArray(r)?e[s]=Ol(r):r&&typeof r=="object"&&r.constructor===Object?e[s]=gt(r):e[s]=r);return e}function ss(n,e){for(;n!==null;){const r=El(n,e);if(r){if(r.get)return Ue(r.get);if(typeof r.value=="function")return Ue(r.value)}n=Sl(n)}function s(){return null}return s}const lr=He(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Js=He(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Zs=He(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),zl=He(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ys=He(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Rl=He(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),ar=He(["#text"]),ir=He(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Xs=He(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ur=He(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),_s=He(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Pl=rt(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Nl=rt(/<%[\w\W]*|[\w\W]*%>/gm),Vl=rt(/\$\{[\w\W]*/gm),Bl=rt(/^data-[\-\w.\u00B7-\uFFFF]+$/),Il=rt(/^aria-[\-\w]+$/),Rr=rt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Dl=rt(/^(?:\w+script|data):/i),Hl=rt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Pr=rt(/^html$/i),Ul=rt(/^[a-z][.\w]*(-[.\w]+)+$/i);var dr=Object.freeze({__proto__:null,ARIA_ATTR:Il,ATTR_WHITESPACE:Hl,CUSTOM_ELEMENT:Ul,DATA_ATTR:Bl,DOCTYPE_NAME:Pr,ERB_EXPR:Nl,IS_ALLOWED_URI:Rr,IS_SCRIPT_OR_DATA:Dl,MUSTACHE_EXPR:Pl,TMPLIT_EXPR:Vl});const ns={element:1,text:3,progressingInstruction:7,comment:8,document:9},Fl=function(){return typeof window>"u"?null:window},ql=function(e,s){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const o="data-tt-policy-suffix";s&&s.hasAttribute(o)&&(r=s.getAttribute(o));const l="dompurify"+(r?"#"+r:"");try{return e.createPolicy(l,{createHTML(i){return i},createScriptURL(i){return i}})}catch{return console.warn("TrustedTypes policy "+l+" could not be created."),null}},cr=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Nr(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Fl();const e=Z=>Nr(Z);if(e.version="3.3.1",e.removed=[],!n||!n.document||n.document.nodeType!==ns.document||!n.Element)return e.isSupported=!1,e;let{document:s}=n;const r=s,o=r.currentScript,{DocumentFragment:l,HTMLTemplateElement:i,Node:a,Element:u,NodeFilter:d,NamedNodeMap:f=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:g,DOMParser:m,trustedTypes:y}=n,x=u.prototype,_=ss(x,"cloneNode"),k=ss(x,"remove"),O=ss(x,"nextSibling"),R=ss(x,"childNodes"),P=ss(x,"parentNode");if(typeof i=="function"){const Z=s.createElement("template");Z.content&&Z.content.ownerDocument&&(s=Z.content.ownerDocument)}let D,ee="";const{implementation:te,createNodeIterator:E,createDocumentFragment:C,getElementsByTagName:H}=s,{importNode:ve}=r;let $=cr();e.isSupported=typeof zr=="function"&&typeof P=="function"&&te&&te.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:h,ERB_EXPR:v,TMPLIT_EXPR:B,DATA_ATTR:U,ARIA_ATTR:se,IS_SCRIPT_OR_DATA:$e,ATTR_WHITESPACE:N,CUSTOM_ELEMENT:j}=dr;let{IS_ALLOWED_URI:G}=dr,V=null;const oe=ae({},[...lr,...Js,...Zs,...Ys,...ar]);let K=null;const fe=ae({},[...ir,...Xs,...ur,..._s]);let le=Object.seal(un(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Te=null,Ze=null;const Ye=Object.seal(un(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let F=!0,J=!0,ue=!1,ot=!0,Pe=!1,We=!0,Fe=!1,qt=!1,Wt=!1,kt=!1,yt=!1,Vt=!1,vs=!0,bs=!1;const Is="user-content-";let Gt=!0,Tt=!1,$t={},Xe=null;const Jt=ae({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let M=null;const A=ae({},["audio","video","img","source","image","track"]);let I=null;const ie=ae({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),he="http://www.w3.org/1998/Math/MathML",Ce="http://www.w3.org/2000/svg",Ae="http://www.w3.org/1999/xhtml";let Ge=Ae,Ke=!1,Qe=null;const Zt=ae({},[he,Ce,Ae],Ws);let et=ae({},["mi","mo","mn","ms","mtext"]),be=ae({},["annotation-xml"]);const Yt=ae({},["title","style","font","a","script"]);let Bt=null;const xs=["application/xhtml+xml","text/html"],oo="text/html";let ze=null,It=null;const lo=s.createElement("form"),Bn=function(b){return b instanceof RegExp||b instanceof Function},Ds=function(){let b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(It&&It===b)){if((!b||typeof b!="object")&&(b={}),b=gt(b),Bt=xs.indexOf(b.PARSER_MEDIA_TYPE)===-1?oo:b.PARSER_MEDIA_TYPE,ze=Bt==="application/xhtml+xml"?Ws:Ts,V=at(b,"ALLOWED_TAGS")?ae({},b.ALLOWED_TAGS,ze):oe,K=at(b,"ALLOWED_ATTR")?ae({},b.ALLOWED_ATTR,ze):fe,Qe=at(b,"ALLOWED_NAMESPACES")?ae({},b.ALLOWED_NAMESPACES,Ws):Zt,I=at(b,"ADD_URI_SAFE_ATTR")?ae(gt(ie),b.ADD_URI_SAFE_ATTR,ze):ie,M=at(b,"ADD_DATA_URI_TAGS")?ae(gt(A),b.ADD_DATA_URI_TAGS,ze):A,Xe=at(b,"FORBID_CONTENTS")?ae({},b.FORBID_CONTENTS,ze):Jt,Te=at(b,"FORBID_TAGS")?ae({},b.FORBID_TAGS,ze):gt({}),Ze=at(b,"FORBID_ATTR")?ae({},b.FORBID_ATTR,ze):gt({}),$t=at(b,"USE_PROFILES")?b.USE_PROFILES:!1,F=b.ALLOW_ARIA_ATTR!==!1,J=b.ALLOW_DATA_ATTR!==!1,ue=b.ALLOW_UNKNOWN_PROTOCOLS||!1,ot=b.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Pe=b.SAFE_FOR_TEMPLATES||!1,We=b.SAFE_FOR_XML!==!1,Fe=b.WHOLE_DOCUMENT||!1,kt=b.RETURN_DOM||!1,yt=b.RETURN_DOM_FRAGMENT||!1,Vt=b.RETURN_TRUSTED_TYPE||!1,Wt=b.FORCE_BODY||!1,vs=b.SANITIZE_DOM!==!1,bs=b.SANITIZE_NAMED_PROPS||!1,Gt=b.KEEP_CONTENT!==!1,Tt=b.IN_PLACE||!1,G=b.ALLOWED_URI_REGEXP||Rr,Ge=b.NAMESPACE||Ae,et=b.MATHML_TEXT_INTEGRATION_POINTS||et,be=b.HTML_INTEGRATION_POINTS||be,le=b.CUSTOM_ELEMENT_HANDLING||{},b.CUSTOM_ELEMENT_HANDLING&&Bn(b.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(le.tagNameCheck=b.CUSTOM_ELEMENT_HANDLING.tagNameCheck),b.CUSTOM_ELEMENT_HANDLING&&Bn(b.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(le.attributeNameCheck=b.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),b.CUSTOM_ELEMENT_HANDLING&&typeof b.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(le.allowCustomizedBuiltInElements=b.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Pe&&(J=!1),yt&&(kt=!0),$t&&(V=ae({},ar),K=[],$t.html===!0&&(ae(V,lr),ae(K,ir)),$t.svg===!0&&(ae(V,Js),ae(K,Xs),ae(K,_s)),$t.svgFilters===!0&&(ae(V,Zs),ae(K,Xs),ae(K,_s)),$t.mathMl===!0&&(ae(V,Ys),ae(K,ur),ae(K,_s))),b.ADD_TAGS&&(typeof b.ADD_TAGS=="function"?Ye.tagCheck=b.ADD_TAGS:(V===oe&&(V=gt(V)),ae(V,b.ADD_TAGS,ze))),b.ADD_ATTR&&(typeof b.ADD_ATTR=="function"?Ye.attributeCheck=b.ADD_ATTR:(K===fe&&(K=gt(K)),ae(K,b.ADD_ATTR,ze))),b.ADD_URI_SAFE_ATTR&&ae(I,b.ADD_URI_SAFE_ATTR,ze),b.FORBID_CONTENTS&&(Xe===Jt&&(Xe=gt(Xe)),ae(Xe,b.FORBID_CONTENTS,ze)),b.ADD_FORBID_CONTENTS&&(Xe===Jt&&(Xe=gt(Xe)),ae(Xe,b.ADD_FORBID_CONTENTS,ze)),Gt&&(V["#text"]=!0),Fe&&ae(V,["html","head","body"]),V.table&&(ae(V,["tbody"]),delete Te.tbody),b.TRUSTED_TYPES_POLICY){if(typeof b.TRUSTED_TYPES_POLICY.createHTML!="function")throw ts('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof b.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ts('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');D=b.TRUSTED_TYPES_POLICY,ee=D.createHTML("")}else D===void 0&&(D=ql(y,o)),D!==null&&typeof ee=="string"&&(ee=D.createHTML(""));He&&He(b),It=b}},In=ae({},[...Js,...Zs,...zl]),Dn=ae({},[...Ys,...Rl]),ao=function(b){let z=P(b);(!z||!z.tagName)&&(z={namespaceURI:Ge,tagName:"template"});const q=Ts(b.tagName),_e=Ts(z.tagName);return Qe[b.namespaceURI]?b.namespaceURI===Ce?z.namespaceURI===Ae?q==="svg":z.namespaceURI===he?q==="svg"&&(_e==="annotation-xml"||et[_e]):!!In[q]:b.namespaceURI===he?z.namespaceURI===Ae?q==="math":z.namespaceURI===Ce?q==="math"&&be[_e]:!!Dn[q]:b.namespaceURI===Ae?z.namespaceURI===Ce&&!be[_e]||z.namespaceURI===he&&!et[_e]?!1:!Dn[q]&&(Yt[q]||!In[q]):!!(Bt==="application/xhtml+xml"&&Qe[b.namespaceURI]):!1},pt=function(b){Qt(e.removed,{element:b});try{P(b).removeChild(b)}catch{k(b)}},At=function(b,z){try{Qt(e.removed,{attribute:z.getAttributeNode(b),from:z})}catch{Qt(e.removed,{attribute:null,from:z})}if(z.removeAttribute(b),b==="is")if(kt||yt)try{pt(z)}catch{}else try{z.setAttribute(b,"")}catch{}},Hn=function(b){let z=null,q=null;if(Wt)b="<remove></remove>"+b;else{const Me=Gs(b,/^[\r\n\t ]+/);q=Me&&Me[0]}Bt==="application/xhtml+xml"&&Ge===Ae&&(b='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+b+"</body></html>");const _e=D?D.createHTML(b):b;if(Ge===Ae)try{z=new m().parseFromString(_e,Bt)}catch{}if(!z||!z.documentElement){z=te.createDocument(Ge,"template",null);try{z.documentElement.innerHTML=Ke?ee:_e}catch{}}const Be=z.body||z.documentElement;return b&&q&&Be.insertBefore(s.createTextNode(q),Be.childNodes[0]||null),Ge===Ae?H.call(z,Fe?"html":"body")[0]:Fe?z.documentElement:Be},Un=function(b){return E.call(b.ownerDocument||b,b,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},Hs=function(b){return b instanceof g&&(typeof b.nodeName!="string"||typeof b.textContent!="string"||typeof b.removeChild!="function"||!(b.attributes instanceof f)||typeof b.removeAttribute!="function"||typeof b.setAttribute!="function"||typeof b.namespaceURI!="string"||typeof b.insertBefore!="function"||typeof b.hasChildNodes!="function")},Fn=function(b){return typeof a=="function"&&b instanceof a};function wt(Z,b,z){ws(Z,q=>{q.call(e,b,z,It)})}const qn=function(b){let z=null;if(wt($.beforeSanitizeElements,b,null),Hs(b))return pt(b),!0;const q=ze(b.nodeName);if(wt($.uponSanitizeElement,b,{tagName:q,allowedTags:V}),We&&b.hasChildNodes()&&!Fn(b.firstElementChild)&&Ie(/<[/\w!]/g,b.innerHTML)&&Ie(/<[/\w!]/g,b.textContent)||b.nodeType===ns.progressingInstruction||We&&b.nodeType===ns.comment&&Ie(/<[/\w]/g,b.data))return pt(b),!0;if(!(Ye.tagCheck instanceof Function&&Ye.tagCheck(q))&&(!V[q]||Te[q])){if(!Te[q]&&Gn(q)&&(le.tagNameCheck instanceof RegExp&&Ie(le.tagNameCheck,q)||le.tagNameCheck instanceof Function&&le.tagNameCheck(q)))return!1;if(Gt&&!Xe[q]){const _e=P(b)||b.parentNode,Be=R(b)||b.childNodes;if(Be&&_e){const Me=Be.length;for(let qe=Me-1;qe>=0;--qe){const _t=_(Be[qe],!0);_t.__removalCount=(b.__removalCount||0)+1,_e.insertBefore(_t,O(b))}}}return pt(b),!0}return b instanceof u&&!ao(b)||(q==="noscript"||q==="noembed"||q==="noframes")&&Ie(/<\/no(script|embed|frames)/i,b.innerHTML)?(pt(b),!0):(Pe&&b.nodeType===ns.text&&(z=b.textContent,ws([h,v,B],_e=>{z=es(z,_e," ")}),b.textContent!==z&&(Qt(e.removed,{element:b.cloneNode()}),b.textContent=z)),wt($.afterSanitizeElements,b,null),!1)},Wn=function(b,z,q){if(vs&&(z==="id"||z==="name")&&(q in s||q in lo))return!1;if(!(J&&!Ze[z]&&Ie(U,z))){if(!(F&&Ie(se,z))){if(!(Ye.attributeCheck instanceof Function&&Ye.attributeCheck(z,b))){if(!K[z]||Ze[z]){if(!(Gn(b)&&(le.tagNameCheck instanceof RegExp&&Ie(le.tagNameCheck,b)||le.tagNameCheck instanceof Function&&le.tagNameCheck(b))&&(le.attributeNameCheck instanceof RegExp&&Ie(le.attributeNameCheck,z)||le.attributeNameCheck instanceof Function&&le.attributeNameCheck(z,b))||z==="is"&&le.allowCustomizedBuiltInElements&&(le.tagNameCheck instanceof RegExp&&Ie(le.tagNameCheck,q)||le.tagNameCheck instanceof Function&&le.tagNameCheck(q))))return!1}else if(!I[z]){if(!Ie(G,es(q,N,""))){if(!((z==="src"||z==="xlink:href"||z==="href")&&b!=="script"&&Ml(q,"data:")===0&&M[b])){if(!(ue&&!Ie($e,es(q,N,"")))){if(q)return!1}}}}}}}return!0},Gn=function(b){return b!=="annotation-xml"&&Gs(b,j)},Jn=function(b){wt($.beforeSanitizeAttributes,b,null);const{attributes:z}=b;if(!z||Hs(b))return;const q={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:K,forceKeepAttr:void 0};let _e=z.length;for(;_e--;){const Be=z[_e],{name:Me,namespaceURI:qe,value:_t}=Be,Dt=ze(Me),Us=_t;let Ve=Me==="value"?Us:Ll(Us);if(q.attrName=Dt,q.attrValue=Ve,q.keepAttr=!0,q.forceKeepAttr=void 0,wt($.uponSanitizeAttribute,b,q),Ve=q.attrValue,bs&&(Dt==="id"||Dt==="name")&&(At(Me,b),Ve=Is+Ve),We&&Ie(/((--!?|])>)|<\/(style|title|textarea)/i,Ve)){At(Me,b);continue}if(Dt==="attributename"&&Gs(Ve,"href")){At(Me,b);continue}if(q.forceKeepAttr)continue;if(!q.keepAttr){At(Me,b);continue}if(!ot&&Ie(/\/>/i,Ve)){At(Me,b);continue}Pe&&ws([h,v,B],Yn=>{Ve=es(Ve,Yn," ")});const Zn=ze(b.nodeName);if(!Wn(Zn,Dt,Ve)){At(Me,b);continue}if(D&&typeof y=="object"&&typeof y.getAttributeType=="function"&&!qe)switch(y.getAttributeType(Zn,Dt)){case"TrustedHTML":{Ve=D.createHTML(Ve);break}case"TrustedScriptURL":{Ve=D.createScriptURL(Ve);break}}if(Ve!==Us)try{qe?b.setAttributeNS(qe,Me,Ve):b.setAttribute(Me,Ve),Hs(b)?pt(b):or(e.removed)}catch{At(Me,b)}}wt($.afterSanitizeAttributes,b,null)},io=function Z(b){let z=null;const q=Un(b);for(wt($.beforeSanitizeShadowDOM,b,null);z=q.nextNode();)wt($.uponSanitizeShadowNode,z,null),qn(z),Jn(z),z.content instanceof l&&Z(z.content);wt($.afterSanitizeShadowDOM,b,null)};return e.sanitize=function(Z){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},z=null,q=null,_e=null,Be=null;if(Ke=!Z,Ke&&(Z="<!-->"),typeof Z!="string"&&!Fn(Z))if(typeof Z.toString=="function"){if(Z=Z.toString(),typeof Z!="string")throw ts("dirty is not a string, aborting")}else throw ts("toString is not a function");if(!e.isSupported)return Z;if(qt||Ds(b),e.removed=[],typeof Z=="string"&&(Tt=!1),Tt){if(Z.nodeName){const _t=ze(Z.nodeName);if(!V[_t]||Te[_t])throw ts("root node is forbidden and cannot be sanitized in-place")}}else if(Z instanceof a)z=Hn("<!---->"),q=z.ownerDocument.importNode(Z,!0),q.nodeType===ns.element&&q.nodeName==="BODY"||q.nodeName==="HTML"?z=q:z.appendChild(q);else{if(!kt&&!Pe&&!Fe&&Z.indexOf("<")===-1)return D&&Vt?D.createHTML(Z):Z;if(z=Hn(Z),!z)return kt?null:Vt?ee:""}z&&Wt&&pt(z.firstChild);const Me=Un(Tt?Z:z);for(;_e=Me.nextNode();)qn(_e),Jn(_e),_e.content instanceof l&&io(_e.content);if(Tt)return Z;if(kt){if(yt)for(Be=C.call(z.ownerDocument);z.firstChild;)Be.appendChild(z.firstChild);else Be=z;return(K.shadowroot||K.shadowrootmode)&&(Be=ve.call(r,Be,!0)),Be}let qe=Fe?z.outerHTML:z.innerHTML;return Fe&&V["!doctype"]&&z.ownerDocument&&z.ownerDocument.doctype&&z.ownerDocument.doctype.name&&Ie(Pr,z.ownerDocument.doctype.name)&&(qe="<!DOCTYPE "+z.ownerDocument.doctype.name+`>
`+qe),Pe&&ws([h,v,B],_t=>{qe=es(qe,_t," ")}),D&&Vt?D.createHTML(qe):qe},e.setConfig=function(){let Z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ds(Z),qt=!0},e.clearConfig=function(){It=null,qt=!1},e.isValidAttribute=function(Z,b,z){It||Ds({});const q=ze(Z),_e=ze(b);return Wn(q,_e,z)},e.addHook=function(Z,b){typeof b=="function"&&Qt($[Z],b)},e.removeHook=function(Z,b){if(b!==void 0){const z=Tl($[Z],b);return z===-1?void 0:Al($[Z],z,1)[0]}return or($[Z])},e.removeHooks=function(Z){$[Z]=[]},e.removeAllHooks=function(){$=cr()},e}var Rt=Nr();const jn="",Wl="/api",Le=async(n,e={})=>{const s=ct(),r=new Headers({"Content-Type":"application/json",...e.headers});s.isAuthenticated&&s.token&&r.set("Authorization",`Bearer ${s.token}`);const o=await fetch(n,{...e,headers:r});if(o.status===401)throw s.logout(),ms.push("/login"),new Error("会话已过期，请重新登录");if(!o.ok){const l=await o.json().catch(()=>({}));let i=`请求失败，状态码: ${o.status}`;throw l.detail&&(typeof l.detail=="string"?i=l.detail:typeof l.detail=="object"&&(i=JSON.stringify(l.detail))),new Error(i)}return o.json()},ft=`${jn}${Wl}/novels`,Gl="/api/writer",lt=`${jn}${Gl}/novels`;class ke{static async createNovel(e,s){return Le(ft,{method:"POST",body:JSON.stringify({title:e,initial_prompt:s})})}static async getNovel(e){return Le(`${ft}/${e}`)}static async getChapter(e,s){return Le(`${ft}/${e}/chapters/${s}`)}static async getSection(e,s){return Le(`${ft}/${e}/sections/${s}`)}static async converseConcept(e,s,r={}){const o=s||{id:null,value:null};return Le(`${ft}/${e}/concept/converse`,{method:"POST",body:JSON.stringify({user_input:o,conversation_state:r})})}static async generateBlueprint(e){return Le(`${ft}/${e}/blueprint/generate`,{method:"POST"})}static async saveBlueprint(e,s){return Le(`${ft}/${e}/blueprint/save`,{method:"POST",body:JSON.stringify(s)})}static async generateChapter(e,s,r){return Le(`${lt}/${e}/chapters/generate`,{method:"POST",body:JSON.stringify({chapter_number:s,writing_notes:r||void 0})})}static async evaluateChapter(e,s){return Le(`${lt}/${e}/chapters/evaluate`,{method:"POST",body:JSON.stringify({chapter_number:s})})}static async cancelEvaluation(e,s){return Le(`${lt}/${e}/chapters/evaluate/cancel`,{method:"POST",body:JSON.stringify({chapter_number:s})})}static async generateWithReview(e,s,r={}){return Le(`${lt}/${e}/chapters/generate-with-review`,{method:"POST",body:JSON.stringify({chapter_number:s,score_threshold:r.score_threshold??70,max_attempts:r.max_attempts??3,auto_select_best:r.auto_select_best??!0,writing_notes:r.writing_notes,rewrite_provider:r.rewrite_provider})})}static async selectChapterVersion(e,s,r){return Le(`${lt}/${e}/chapters/select`,{method:"POST",body:JSON.stringify({chapter_number:s,version_index:r})})}static async autoCreateChapters(e,s={}){const r=ct(),o=new Headers({"Content-Type":"application/json"});r.isAuthenticated&&r.token&&o.set("Authorization",`Bearer ${r.token}`);const l=await fetch(`${lt}/${e}/chapters/auto-create`,{method:"POST",headers:o,body:JSON.stringify(s)});if(l.status===401)throw r.logout(),ms.push("/login"),new Error("会话已过期，请重新登录");if(!l.ok){const i=await l.json().catch(()=>({}));throw new Error(i.detail||`请求失败，状态码: ${l.status}`)}return l}static async stopAutoCreate(e){return Le(`${lt}/${e}/chapters/auto-create/stop`,{method:"POST"})}static async getAllNovels(){return Le(ft)}static async deleteNovels(e){return Le(ft,{method:"DELETE",body:JSON.stringify(e)})}static async updateChapterOutline(e,s){return Le(`${lt}/${e}/chapters/update-outline`,{method:"POST",body:JSON.stringify(s)})}static async deleteChapter(e,s){return Le(`${lt}/${e}/chapters/delete`,{method:"POST",body:JSON.stringify({chapter_numbers:s})})}static async generateChapterOutline(e,s,r){return Le(`${lt}/${e}/chapters/outline`,{method:"POST",body:JSON.stringify({start_chapter:s,num_chapters:r})})}static async updateBlueprint(e,s){return Le(`${ft}/${e}/blueprint`,{method:"PATCH",body:JSON.stringify(s)})}static async editChapterContent(e,s,r){return Le(`${lt}/${e}/chapters/edit`,{method:"POST",body:JSON.stringify({chapter_number:s,content:r})})}}const ks=`${jn}/api/auth`;async function pr(n,e={}){const s=ct(),r=new Headers(e.headers||{});s.token&&r.set("Authorization",`Bearer ${s.token}`),e.headers=r;const o=await fetch(n,e),l=o.headers.get("X-Token-Refresh");return l&&(s.token=l,localStorage.setItem("token",l)),o}const ct=yr("auth",{state:()=>({token:localStorage.getItem("token")||null,user:null,authOptions:null,authOptionsLoaded:!1}),getters:{isAuthenticated:n=>!!n.token,allowRegistration:n=>n.authOptions?.allow_registration??!0,enableLinuxdoLogin:n=>n.authOptions?.enable_linuxdo_login??!1,mustChangePassword:n=>n.user?.must_change_password??!1},actions:{async fetchAuthOptions(n=!1){if(!(this.authOptionsLoaded&&!n))try{const e=await fetch(`${ks}/options`);if(!e.ok)throw new Error("读取认证开关失败");const s=await e.json();this.authOptions=s}catch(e){console.error("获取认证配置失败，将使用默认值",e),this.authOptions={allow_registration:!0,enable_linuxdo_login:!1}}finally{this.authOptionsLoaded=!0}},async login(n,e){const s=new URLSearchParams;s.append("username",n),s.append("password",e);const r=await pr(`${ks}/token`,{method:"POST",body:s});if(!r.ok)throw new Error("Failed to login");const o=await r.json();this.token=o.access_token,this.token&&localStorage.setItem("token",this.token);const l=!!o.must_change_password;return await this.fetchUser(),this.user&&(this.user.must_change_password=l||this.user.must_change_password),l},async register(n){const e=await fetch(`${ks}/users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok){const r=(await e.json().catch(()=>({}))).detail||"Failed to register";throw new Error(r)}},logout(){this.token=null,this.user=null,localStorage.removeItem("token")},async fetchUser(){if(this.token)try{const n=await pr(`${ks}/users/me`);if(!n.ok)throw new Error("Failed to fetch user");const e=await n.json();this.user={id:e.id,username:e.username,is_admin:e.is_admin||!1,must_change_password:e.must_change_password||!1}}catch{this.logout()}}}}),Vr="",Jl="/api/admin",Zl=async(n,e={})=>{const s=ct(),r=new Headers({"Content-Type":"application/json",...e.headers});s.isAuthenticated&&s.token&&r.set("Authorization",`Bearer ${s.token}`);const o=await fetch(n,{...e,headers:r});if(o.status===401)throw s.logout(),ms.push("/login"),new Error("会话已过期，请重新登录");if(!o.ok){const l=await o.json().catch(()=>({}));let i=`请求失败，状态码: ${o.status}`;throw l.detail&&(typeof l.detail=="string"?i=l.detail:Array.isArray(l.detail)&&(i=l.detail.map(a=>{const u=a.loc?a.loc.join("."):"",d=a.msg||a.message||JSON.stringify(a);return u?`${u}: ${d}`:d}).join("; "))),new Error(i)}if(o.status!==204)return o.json()},Yl=(n,e={})=>Zl(`${Vr}${Jl}${n}`,e);class pn{static request(e,s={}){return Yl(e,s)}static getStatistics(){return this.request("/stats")}static listUsers(){return this.request("/users")}static listNovels(){return this.request("/novel-projects")}static getNovelDetails(e){return this.request(`/novel-projects/${e}`)}static getNovelSection(e,s){return this.request(`/novel-projects/${e}/sections/${s}`)}static getNovelChapter(e,s){return this.request(`/novel-projects/${e}/chapters/${s}`)}static listPrompts(){return this.request("/prompts")}static createPrompt(e){return this.request("/prompts",{method:"POST",body:JSON.stringify(e)})}static getPrompt(e){return this.request(`/prompts/${e}`)}static updatePrompt(e,s){return this.request(`/prompts/${e}`,{method:"PATCH",body:JSON.stringify(s)})}static deletePrompt(e){return this.request(`/prompts/${e}`,{method:"DELETE"})}static listUpdateLogs(){return this.request("/update-logs")}static createUpdateLog(e){return this.request("/update-logs",{method:"POST",body:JSON.stringify(e)})}static updateUpdateLog(e,s){return this.request(`/update-logs/${e}`,{method:"PATCH",body:JSON.stringify(s)})}static deleteUpdateLog(e){return this.request(`/update-logs/${e}`,{method:"DELETE"})}static getDailyRequestLimit(){return this.request("/settings/daily-request-limit")}static setDailyRequestLimit(e){return this.request("/settings/daily-request-limit",{method:"PUT",body:JSON.stringify({limit:e})})}static listSystemConfigs(){return this.request("/system-configs")}static upsertSystemConfig(e,s){return this.request(`/system-configs/${e}`,{method:"PUT",body:JSON.stringify({key:e,...s})})}static patchSystemConfig(e,s){return this.request(`/system-configs/${e}`,{method:"PATCH",body:JSON.stringify(s)})}static deleteSystemConfig(e){return this.request(`/system-configs/${e}`,{method:"DELETE"})}static changePassword(e,s){return this.request("/password",{method:"POST",body:JSON.stringify({old_password:e,new_password:s})})}}const Xl=async(n,e={})=>{const s=await fetch(n,{...e});if(!s.ok){const r=await s.json().catch(()=>({}));throw new Error(r.detail||`Request failed, status code: ${s.status}`)}if(s.status!==204)return s.json()},Kl=()=>Xl(`${Vr}/api/updates/latest`),Ql={class:"flex items-center justify-center min-h-screen p-4 relative"},ea={class:"w-full max-w-4xl bg-white rounded-2xl shadow-xl overflow-hidden transform transition-all duration-300 flex flex-col max-h-[90vh]"},ta={class:"p-8 sm:p-10 pb-4"},sa={key:0,class:"bg-slate-50 border border-slate-200 rounded-xl p-4"},na=["innerHTML"],ra={class:"px-8 sm:px-10 pb-8 sm:pb-10 overflow-y-auto flex-1"},oa={class:"flow-root"},la={role:"list",class:"-mb-8"},aa={class:"relative pb-8"},ia={key:0,class:"absolute left-2.5 top-4 -ml-px h-full w-0.5 bg-slate-200","aria-hidden":"true"},ua={class:"relative flex items-start space-x-4"},da={class:"min-w-0 flex-1"},ca={class:"bg-slate-50/80 border border-slate-200/80 rounded-xl p-4"},pa={class:"text-sm font-semibold text-slate-600"},fa=["innerHTML"],ha={class:"absolute top-4 right-4 flex space-x-2"},ga=W({__name:"WorkspaceEntry",setup(n){pe.setOptions({gfm:!0,breaks:!0});const e=y=>Rt.sanitize(pe.parse(y)),s=Et(),r=ct(),o=S(!1),l=S([]),i=L(()=>l.value.find(y=>/交流群/.test(y.content))),a=L(()=>i.value?l.value.filter(y=>y.id!==i.value.id):l.value);Ee(async()=>{if(localStorage.getItem("hideAnnouncement")!==new Date().toDateString())try{l.value=await Kl(),l.value.length>0&&(o.value=!0)}catch(x){console.error("Failed to fetch update logs:",x)}});const u=()=>{o.value=!1},d=()=>{localStorage.setItem("hideAnnouncement",new Date().toDateString()),u()},f=()=>{r.logout(),s.push("/login")},g=()=>{s.push("/inspiration")},m=()=>{s.push("/workspace")};return(y,x)=>{const _=Rs("router-link");return c(),p("div",Ql,[o.value?(c(),p("div",{key:0,class:"fixed inset-0 bg-slate-900/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm",onClick:Ne(u,["self"])},[t("div",ea,[t("div",ta,[x[0]||(x[0]=t("header",{class:"text-center mb-6"},[t("h1",{class:"text-2xl sm:text-3xl font-bold text-slate-800"},"更新日志")],-1)),i.value?(c(),p("div",sa,[t("div",{innerHTML:e(i.value.content)},null,8,na)])):T("",!0)]),t("div",ra,[t("div",oa,[t("ul",la,[(c(!0),p(re,null,ge(a.value,(k,O)=>(c(),p("li",{key:k.id},[t("div",aa,[O<a.value.length-1?(c(),p("span",ia)):T("",!0),t("div",ua,[x[1]||(x[1]=t("div",{class:"h-5 w-5 bg-blue-500 rounded-full flex items-center justify-center ring-8 ring-white mt-1"},null,-1)),t("div",da,[t("div",ca,[t("time",pa,w(new Date(k.created_at).toLocaleDateString()),1),t("div",{class:"mt-3 prose max-w-none prose-sm prose-slate",innerHTML:e(k.content)},null,8,fa)])])])])]))),128))])])]),t("footer",{class:"bg-slate-50/70 px-8 py-4 border-t border-slate-200 mt-auto"},[t("div",{class:"flex justify-end items-center space-x-4"},[t("button",{onClick:d,class:"px-5 py-2 text-sm font-semibold text-slate-600 bg-transparent rounded-lg hover:bg-slate-200 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-400"}," 今日不再显示 "),t("button",{onClick:u,class:"px-5 py-2 text-sm font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-sm"}," 关闭 ")])])])])):T("",!0),t("div",ha,[xe(_,{to:"/settings",class:"px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-2 cursor-pointer"},{default:Re(()=>[...x[2]||(x[2]=[Y(" 设置 ",-1)])]),_:1}),t("button",{onClick:f,class:"px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-2 cursor-pointer"}," 退出登录 ")]),t("div",{class:"w-full max-w-4xl mx-auto"},[t("div",{class:"text-center p-8 fade-in"},[x[5]||(x[5]=t("h1",{class:"text-4xl md:text-5xl font-bold text-gray-800 mb-4"},"拯救小说家：创作中心",-1)),x[6]||(x[6]=t("p",{class:"text-lg text-gray-600 mb-12"},"从一个新灵感开始，或继续打磨你的世界。",-1)),t("div",{class:"grid md:grid-cols-2 gap-8 max-w-2xl mx-auto"},[t("div",{onClick:g,class:"group p-8 bg-white/70 backdrop-blur-xl rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 cursor-pointer"},[...x[3]||(x[3]=[t("h2",{class:"text-2xl font-bold text-indigo-600 mb-3"},"灵感模式",-1),t("p",{class:"text-gray-600"},"没有头绪？让AI通过对话式引导，帮你构建故事的雏形。",-1)])]),t("div",{onClick:m,class:"group p-8 bg-white/70 backdrop-blur-xl rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 cursor-pointer"},[...x[4]||(x[4]=[t("h2",{class:"text-2xl font-bold text-teal-600 mb-3"},"小说工作台",-1),t("p",{class:"text-gray-600"},"查看、编辑和管理你所有的小说项目工程。",-1)])])])])])])}}}),fs=yr("novel",()=>{const n=S([]),e=S(null),s=S({}),r=S(!1),o=S(null),l=L(()=>n.value.length),i=L(()=>e.value!==null);async function a(){r.value=!0,o.value=null;try{n.value=await ke.getAllNovels()}catch($){o.value=$ instanceof Error?$.message:"加载项目失败"}finally{r.value=!1}}async function u($,h){r.value=!0,o.value=null;try{const v=await ke.createNovel($,h);return e.value=v,s.value={},v}catch(v){throw o.value=v instanceof Error?v.message:"创建项目失败",v}finally{r.value=!1}}async function d($,h=!1){h||(r.value=!0),o.value=null;try{e.value=await ke.getNovel($)}catch(v){o.value=v instanceof Error?v.message:"加载项目失败"}finally{h||(r.value=!1)}}async function f($){o.value=null;try{if(!e.value)throw new Error("没有当前项目");const h=await ke.getChapter(e.value.id,$),v=e.value;Array.isArray(v.chapters)||(v.chapters=[]);const B=v.chapters.findIndex(U=>U.chapter_number===$);return B>=0?v.chapters.splice(B,1,h):v.chapters.push(h),v.chapters.sort((U,se)=>U.chapter_number-se.chapter_number),h}catch(h){throw o.value=h instanceof Error?h.message:"加载章节失败",h}}function g($,h){if(!e.value)return;const v=e.value;Array.isArray(v.chapters)||(v.chapters=[]);const B=v.chapters.find(se=>se.chapter_number===$);if(B){B.generation_status=h;return}const U=v.blueprint?.chapter_outline?.find(se=>se.chapter_number===$);v.chapters.push({chapter_number:$,title:U?.title||`第${$}章`,summary:U?.summary||"",content:null,versions:null,evaluation:null,generation_status:h}),v.chapters.sort((se,$e)=>se.chapter_number-$e.chapter_number)}function m($,h){if(!e.value)return;const v=e.value;Array.isArray(v.chapters)||(v.chapters=[]);const B=v.chapters.find(U=>U.chapter_number===$);B?(Object.assign(B,h),h.status&&(B.generation_status=h.status),h.real_summary&&(B.summary=h.real_summary)):(h.title||h.content)&&(h.status&&!h.generation_status&&(h.generation_status=h.status),h.real_summary&&!h.summary&&(h.summary=h.real_summary),v.chapters.push(h),v.chapters.sort((U,se)=>U.chapter_number-se.chapter_number))}async function y($){r.value=!0,o.value=null;try{if(!e.value)throw new Error("没有当前项目");const h=await ke.converseConcept(e.value.id,$,s.value);return s.value=h.conversation_state,h}catch(h){throw o.value=h instanceof Error?h.message:"对话失败",h}finally{r.value=!1}}async function x(){r.value=!0,o.value=null;try{if(!e.value)throw new Error("没有当前项目");return await ke.generateBlueprint(e.value.id)}catch($){throw o.value=$ instanceof Error?$.message:"生成蓝图失败",$}finally{r.value=!1}}async function _($){r.value=!0,o.value=null;try{if(!e.value)throw new Error("没有当前项目");if(!$)throw new Error("缺少蓝图数据");e.value=await ke.saveBlueprint(e.value.id,$)}catch(h){throw o.value=h instanceof Error?h.message:"保存蓝图失败",h}finally{r.value=!1}}async function k($,h){o.value=null;try{if(!e.value)throw new Error("没有当前项目");const v=await ke.generateChapter(e.value.id,$,h);return e.value=v,v}catch(v){throw o.value=v instanceof Error?v.message:"生成章节失败",v}}async function O($){o.value=null;try{if(!e.value)throw new Error("没有当前项目");const h=await ke.evaluateChapter(e.value.id,$);return e.value=h,h}catch(h){throw o.value=h instanceof Error?h.message:"评估章节失败",h}}async function R($){o.value=null;try{if(!e.value)throw new Error("没有当前项目");const h=await ke.cancelEvaluation(e.value.id,$);return e.value=h,h}catch(h){throw o.value=h instanceof Error?h.message:"取消评审失败",h}}async function P($,h){o.value=null;try{if(!e.value)throw new Error("没有当前项目");const v=await ke.selectChapterVersion(e.value.id,$,h);e.value=v}catch(v){throw o.value=v instanceof Error?v.message:"选择章节版本失败",v}}async function D($){r.value=!0,o.value=null;try{const h=await ke.deleteNovels($);return n.value=n.value.filter(v=>!$.includes(v.id)),e.value&&$.includes(e.value.id)&&(e.value=null,s.value={}),h}catch(h){throw o.value=h instanceof Error?h.message:"删除项目失败",h}finally{r.value=!1}}async function ee($){o.value=null;try{if(!e.value)throw new Error("没有当前项目");const h=await ke.updateChapterOutline(e.value.id,$);e.value=h}catch(h){throw o.value=h instanceof Error?h.message:"更新章节大纲失败",h}}async function te($){o.value=null;try{if(!e.value)throw new Error("没有当前项目");const h=Array.isArray($)?$:[$],v=await ke.deleteChapter(e.value.id,h);e.value=v}catch(h){throw o.value=h instanceof Error?h.message:"删除章节失败",h}}async function E($,h){o.value=null;try{if(!e.value)throw new Error("没有当前项目");const v=await ke.generateChapterOutline(e.value.id,$,h);e.value=v}catch(v){throw o.value=v instanceof Error?v.message:"生成大纲失败",v}}async function C($,h,v){o.value=null;try{const B=await ke.editChapterContent($,h,v);e.value=B}catch(B){throw o.value=B instanceof Error?B.message:"编辑章节内容失败",B}}function H(){o.value=null}function ve($){e.value=$}return{projects:n,currentProject:e,currentConversationState:s,isLoading:r,error:o,projectsCount:l,hasCurrentProject:i,loadProjects:a,createProject:u,loadProject:d,loadChapter:f,updateChapterStatus:g,updateChapterData:m,sendConversation:y,generateBlueprint:x,saveBlueprint:_,generateChapter:k,evaluateChapter:O,cancelEvaluation:R,selectChapterVersion:P,deleteProjects:D,updateChapterOutline:ee,deleteChapter:te,generateChapterOutline:E,editChapterContent:C,clearError:H,setCurrentProject:ve}}),ma={class:"group bg-white rounded-xl border border-gray-200 p-5 hover:shadow-xl hover:-translate-y-1.5 transition-all duration-300 flex flex-col justify-between"},va={class:"flex items-center gap-4 mb-4"},ba={class:"font-bold text-lg text-gray-900 hover:text-indigo-600 transition-colors"},xa={class:"text-sm text-gray-500"},ya={class:"text-xs text-gray-400 mt-1"},wa={class:"mb-4"},_a={class:"flex justify-between text-sm text-gray-600 mb-1"},ka={class:"w-full bg-gray-200 rounded-full h-2"},$a={class:"flex flex-wrap gap-2 mb-4"},Ca={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Sa={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},Ea={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600"},Ta={class:"flex gap-2 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0"},Aa=W({__name:"ProjectCard",props:{project:{}},emits:["click","detail","continue","delete"],setup(n,{emit:e}){const s=n,r=e,o=L(()=>{const d={科幻:{bg:"bg-indigo-100",text:"text-indigo-600",progress:"bg-indigo-500"},悬疑:{bg:"bg-teal-100",text:"text-teal-600",progress:"bg-teal-500"},奇幻:{bg:"bg-green-100",text:"text-green-600",progress:"bg-green-500"},东方奇幻:{bg:"bg-purple-100",text:"text-purple-600",progress:"bg-purple-500"},穿越:{bg:"bg-pink-100",text:"text-pink-600",progress:"bg-pink-500"},default:{bg:"bg-gray-100",text:"text-gray-600",progress:"bg-gray-500"}},f=s.project.genre||"",g=Object.keys(d).find(m=>m!=="default"&&f.includes(m))||"default";return d[g]}),l=L(()=>{const{completed_chapters:d,total_chapters:f}=s.project;return f>0?Math.round(d/f*100):0}),i=L(()=>{const{completed_chapters:d,total_chapters:f}=s.project;return d>0?`已完成 ${d}/${f} 章`:f>0?"准备创作":"蓝图完成"}),a=L(()=>s.project.total_chapters);L(()=>0);const u=()=>{r("delete",s.project.id)};return(d,f)=>(c(),p("div",ma,[t("div",null,[t("div",va,[t("div",{class:Q([o.value.bg,"w-12 h-12 rounded-lg flex items-center justify-center"])},[(c(),p("svg",{xmlns:"http://www.w3.org/2000/svg",class:Q([o.value.text,"h-6 w-6"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[...f[3]||(f[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"},null,-1)])],2))],2),t("div",{class:"flex-1 cursor-pointer",onClick:f[0]||(f[0]=g=>d.$emit("detail",n.project.id))},[t("h3",ba,w(n.project.title),1),t("p",xa,w(n.project.genre||"未知类型")+" | "+w(i.value),1),t("p",ya," 最后编辑: "+w(n.project.last_edited),1)])]),t("div",wa,[t("div",_a,[f[4]||(f[4]=t("span",null,"完成进度",-1)),t("span",null,w(l.value)+"%",1)]),t("div",ka,[t("div",{class:Q([o.value.progress,"h-2 rounded-full transition-all duration-300"]),style:Ht({width:`${l.value}%`})},null,6)])]),t("div",$a,[n.project.genre?(c(),p("span",Ca,w(n.project.genre),1)):T("",!0),a.value>0?(c(),p("span",Sa,w(a.value)+" 章节 ",1)):T("",!0),t("span",Ea,w(n.project.last_edited),1)])]),t("div",Ta,[t("button",{onClick:f[1]||(f[1]=Ne(g=>d.$emit("detail",n.project.id),["stop"])),class:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm font-medium py-2 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-1"},[...f[5]||(f[5]=[t("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),t("path",{"fill-rule":"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z","clip-rule":"evenodd"})],-1),Y(" 查看详情 ",-1)])]),t("button",{onClick:Ne(u,["stop"]),class:"px-3 py-2 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors duration-200 flex items-center justify-center",title:"删除项目"},[...f[6]||(f[6]=[t("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z","clip-rule":"evenodd"}),t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 012 0v4a1 1 0 11-2 0V7zM12 7a1 1 0 012 0v4a1 1 0 11-2 0V7z","clip-rule":"evenodd"})],-1)])]),t("button",{onClick:f[2]||(f[2]=Ne(g=>d.$emit("continue",n.project),["stop"])),class:Q([o.value.bg,o.value.text,"flex-1 text-sm font-semibold py-2 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-1 hover:opacity-80"])},[...f[7]||(f[7]=[t("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})],-1),Y(" 继续创作 ",-1)])],2)])]))}}),Ma=Pt(Aa,[["__scopeId","data-v-2ec33df0"]]),La={class:"flex items-center justify-center min-h-screen p-4"},ja={class:"flex items-center gap-2"},Oa={key:0,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},za={key:1,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},Ra={class:"w-full max-w-7xl mx-auto"},Pa={class:"p-8 bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl fade-in"},Na={class:"flex justify-between items-center mb-8"},Va={class:"flex items-center space-x-4"},Ba={key:0,class:"flex justify-center items-center py-8"},Ia={key:1,class:"text-red-500 text-center py-8"},Da={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Ha={key:0,class:"col-span-full text-center py-8"},Ua={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},Fa={class:"bg-white rounded-2xl shadow-2xl max-w-md w-full"},qa={class:"p-6"},Wa={class:"text-gray-700 mb-6"},Ga={class:"flex gap-3 justify-end"},Ja=["disabled"],Za={key:0,class:"w-4 h-4 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},Ya=W({__name:"NovelWorkspace",setup(n){const e=Et(),s=fs(),r=ct(),o=S(!1),l=S(null),i=S(!1),a=S(null),u=()=>{e.push("/")},d=()=>{e.push("/inspiration")},f=k=>{e.push(`/detail/${k}`)},g=k=>{k.title==="未命名灵感"?e.push(`/inspiration?project_id=${k.id}`):e.push(`/novel/${k.id}`)},m=async()=>{await s.loadProjects()},y=k=>{const O=s.projects.find(R=>R.id===k);O&&(l.value=O,o.value=!0)},x=()=>{o.value=!1,l.value=null},_=async()=>{if(l.value){i.value=!0;try{await s.deleteProjects([l.value.id]),a.value={type:"success",text:`项目 "${l.value.title}" 已成功删除`},o.value=!1,l.value=null,setTimeout(()=>{a.value=null},3e3)}catch(k){console.error("删除项目失败:",k),a.value={type:"error",text:"删除项目失败，请重试"},setTimeout(()=>{a.value=null},3e3)}finally{i.value=!1}}};return Ee(()=>{m()}),(k,O)=>{const R=Rs("router-link");return c(),p("div",La,[a.value?(c(),p("div",{key:0,class:Q(["fixed top-4 right-4 z-60 px-4 py-3 rounded-lg shadow-lg transition-all duration-300",a.value.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"])},[t("div",ja,[a.value.type==="success"?(c(),p("svg",Oa,[...O[0]||(O[0]=[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):(c(),p("svg",za,[...O[1]||(O[1]=[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)])])),t("span",null,w(a.value.text),1)])],2)):T("",!0),t("div",Ra,[t("div",Pa,[t("div",Na,[t("div",Va,[O[3]||(O[3]=t("h2",{class:"text-3xl font-bold text-gray-800"},"我的小说项目",-1)),we(r).user?.is_admin?(c(),je(R,{key:0,to:"/admin",class:"text-sm text-indigo-600 hover:text-indigo-800"},{default:Re(()=>[...O[2]||(O[2]=[Y("管理后台",-1)])]),_:1})):T("",!0)]),t("button",{onClick:u,class:"text-gray-500 hover:text-gray-800 transition-colors"}," ← 返回 ")]),we(s).isLoading?(c(),p("div",Ba,[...O[4]||(O[4]=[t("div",{class:"loader"},null,-1)])])):we(s).error?(c(),p("div",Ia,[Y(w(we(s).error)+" ",1),t("button",{onClick:m,class:"block mt-4 mx-auto px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-all duration-300 transform hover:scale-105"}," 重试 ")])):(c(),p("div",Da,[we(s).projects.length===0?(c(),p("div",Ha,[O[5]||(O[5]=t("p",{class:"text-gray-500 mb-4"},"还没有项目，快去开启灵感模式创建一个吧！",-1)),t("button",{onClick:d,class:"px-6 py-3 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-all duration-300 transform hover:scale-105"}," 开始创作 ")])):T("",!0),(c(!0),p(re,null,ge(we(s).projects,P=>(c(),je(Ma,{key:P.id,project:P,onClick:D=>g(P),onDetail:f,onContinue:g,onDelete:y},null,8,["project","onClick"]))),128)),t("div",{onClick:d,class:"flex items-center justify-center p-5 bg-transparent border-2 border-dashed border-gray-300 rounded-xl hover:bg-gray-50 hover:border-indigo-400 transition-colors duration-300 cursor-pointer group min-h-[180px]"},[...O[6]||(O[6]=[t("div",{class:"text-center text-gray-500 group-hover:text-indigo-500 transition-colors"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mx-auto h-8 w-8 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})]),t("span",{class:"font-semibold"},"创建新项目")],-1)])])]))])]),o.value?(c(),p("div",Ua,[t("div",Fa,[t("div",qa,[O[8]||(O[8]=mt('<div class="flex items-center gap-3 mb-4"><div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center"><svg class="w-6 h-6 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 012 0v4a1 1 0 11-2 0V7zM12 7a1 1 0 012 0v4a1 1 0 11-2 0V7z" clip-rule="evenodd"></path></svg></div><div><h3 class="text-lg font-semibold text-gray-900">确认删除</h3><p class="text-sm text-gray-600">此操作无法撤销</p></div></div>',1)),t("p",Wa,' 确定要删除项目 "'+w(l.value?.title)+'" 吗？所有相关数据将被永久删除。 ',1),t("div",Ga,[t("button",{onClick:x,class:"px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors"}," 取消 "),t("button",{onClick:_,disabled:i.value,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[i.value?(c(),p("svg",Za,[...O[7]||(O[7]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])):T("",!0),Y(" "+w(i.value?"删除中...":"确认删除"),1)],8,Ja)])])])])):T("",!0)])}}}),Xa=["innerHTML"],Ka={key:1},Qa=W({__name:"ChatBubble",props:{message:{},type:{}},setup(n){const e=n,s=i=>{if(!i)return"";let a=i.replace(/\\n/g,`
`).replace(/\\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");return a=a.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),a=a.replace(/(?<!\*)\*([^*]+)\*(?!\*)/g,"<em>$1</em>"),a=a.replace(/^([A-Z])\)\s*\*\*(.*?)\*\*(.*)/gm,'<div class="mb-2"><span class="inline-flex items-center justify-center w-6 h-6 bg-indigo-100 text-indigo-600 text-sm font-bold rounded-full mr-2">$1</span><strong>$2</strong>$3</div>'),a=a.replace(/\n/g,"<br>"),a=a.replace(/(<br\s*\/?>\s*){2,}/g,'</p><p class="mt-2">'),a.includes("<p>")||(a=`<p>${a}</p>`),Rt.sanitize(a)},r=L(()=>e.type==="ai"?s(e.message):e.message),o=L(()=>`w-full flex ${e.type==="ai"?"justify-start":"justify-end"}`),l=L(()=>{const i="max-w-md lg:max-w-lg p-4 rounded-lg shadow-md fade-in",a=e.type==="ai"?"chat-bubble-ai":"chat-bubble-user";return`${i} ${a}`});return(i,a)=>(c(),p("div",{class:Q(o.value)},[t("div",{class:Q(l.value)},[n.type==="ai"?(c(),p("div",{key:0,class:"prose prose-sm max-w-none prose-headings:mt-2 prose-headings:mb-1 prose-p:my-1 prose-ul:my-1 prose-ol:my-1 prose-li:my-0",innerHTML:r.value},null,8,Xa)):(c(),p("div",Ka,w(n.message),1))],2)],2))}}),ei={class:"fade-in"},ti={key:0,class:"flex justify-center items-center p-4"},si={key:1},ni={class:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3"},ri=["onClick"],oi=["placeholder","disabled"],li=["disabled"],ai=["placeholder"],ii=5,ui=5,di=W({__name:"ConversationInput",props:{uiControl:{},loading:{type:Boolean}},emits:["submit"],setup(n,{emit:e}){const s=n,r=e,o=S(""),l=S(),i=S(!1),a=()=>{const g=l.value;if(!g||typeof window>"u")return;const m=parseFloat(window.getComputedStyle(g).lineHeight||"0")||20,y=m*ii,x=m*ui;g.style.height="auto";const _=Math.min(x,Math.max(y,g.scrollHeight));g.style.height=`${_}px`},u=()=>{a()},d=(g,m)=>{r("submit",{id:g,value:m})},f=()=>{o.value.trim()&&(r("submit",{id:"text_input",value:o.value.trim()}),o.value="",tt(()=>a()))};return Se(()=>s.uiControl,async g=>{i.value=!1,o.value="",await tt(),a(),g?.type==="text_input"&&l.value?.focus()},{deep:!0}),Se(i,async g=>{g&&(await tt(),a(),l.value?.focus())}),(g,m)=>(c(),p("div",ei,[n.loading||!n.uiControl?(c(),p("div",ti,[...m[3]||(m[3]=[t("div",{class:"loader"},null,-1)])])):n.uiControl.type==="single_choice"?(c(),p("div",si,[t("div",ni,[(c(!0),p(re,null,ge(n.uiControl.options,y=>(c(),p("button",{key:y.id,onClick:x=>d(y.id,y.label),class:"p-3 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-400"},w(y.label),9,ri))),128)),t("button",{onClick:m[0]||(m[0]=y=>i.value=!0),class:"p-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400"}," 我要输入 ")]),t("form",{onSubmit:Ne(f,["prevent"]),class:"flex items-center gap-3"},[de(t("textarea",{"onUpdate:modelValue":m[1]||(m[1]=y=>o.value=y),placeholder:i.value?"请输入您的想法...":"选择上方选项或点击“我要输入”",class:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 outline-none transition-all disabled:bg-gray-100 resize-none overflow-y-auto leading-relaxed",disabled:!i.value,rows:"5",ref_key:"textInputRef",ref:l,onInput:u},null,40,oi),[[ce,o.value]]),t("button",{type:"submit",class:"flex-shrink-0 w-12 h-12 bg-indigo-500 rounded-full flex items-center justify-center hover:bg-indigo-600 transition-all shadow-md disabled:bg-gray-300",disabled:!i.value},[...m[4]||(m[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"text-white"},[t("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),t("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})],-1)])],8,li)],32)])):n.uiControl.type==="text_input"?(c(),p("form",{key:2,onSubmit:Ne(f,["prevent"]),class:"flex items-center gap-3"},[de(t("textarea",{"onUpdate:modelValue":m[2]||(m[2]=y=>o.value=y),placeholder:n.uiControl.placeholder||"请输入...",class:"w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 outline-none transition-all resize-none overflow-y-auto leading-relaxed",required:"",ref_key:"textInputRef",ref:l,rows:"5",onInput:u},null,40,ai),[[ce,o.value]]),m[5]||(m[5]=t("button",{type:"submit",class:"flex-shrink-0 w-12 h-12 bg-indigo-500 rounded-full flex items-center justify-center hover:bg-indigo-600 transition-all shadow-md"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"text-white"},[t("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),t("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})])],-1))],32)):T("",!0)]))}}),ci={class:"p-8 bg-white rounded-2xl shadow-2xl fade-in"},pi={class:"text-center mb-8"},fi=["innerHTML"],hi={key:0,class:"text-center py-12"},gi={class:"relative mx-auto mb-8 w-24 h-24"},mi={key:0,class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},vi={key:1,class:"w-6 h-6 text-white animate-pulse",fill:"currentColor",viewBox:"0 0 20 20"},bi={class:"space-y-4"},xi={class:"text-xl font-semibold text-gray-800 animate-pulse"},yi={class:"w-full max-w-md mx-auto"},wi={class:"w-full bg-gray-200 rounded-full h-2 overflow-hidden"},_i={key:1,class:"text-center space-x-4"},ki=["disabled"],Ks=180,$i=W({__name:"BlueprintConfirmation",props:{aiMessage:{}},emits:["blueprintGenerated","back"],setup(n,{emit:e}){pe.setOptions({gfm:!0,breaks:!0});const s=n,r=e,o=fs(),l=S(!1),i=S(0),a=S(0);let u=null,d=null;const f=L(()=>Rt.sanitize(pe.parse(s.aiMessage))),g=L(()=>{if(i.value>=100)return"生成完成！正在准备展示...";const x=["正在分析故事结构...","构建角色关系网络...","生成情节发展脉络...","完善世界观设定...","优化章节安排...","最后润色细节..."],_=Math.floor(i.value/100*x.length);return x[Math.min(_,x.length-1)]});L(()=>Math.max(0,Ks-a.value));const m=async()=>{l.value=!0,i.value=0,a.value=0,u=setInterval(()=>{a.value+=.1;const x=a.value/Ks;if(x<.7)i.value=Math.min(80,x/.7*80);else{const _=(x-.7)/.3;i.value=Math.min(95,80+_*15)}},100),d=setTimeout(()=>{y(),l.value=!1,X.showError("生成超时，请稍后重试。如果问题持续，请检查网络连接。","生成超时")},Ks*1e3);try{const x=await o.generateBlueprint();u&&(clearInterval(u),u=null),i.value=100,await new Promise(_=>setTimeout(_,800)),y(),l.value=!1,r("blueprintGenerated",x)}catch(x){console.error("生成蓝图失败:",x),y(),l.value=!1,X.showError(`生成蓝图失败: ${x instanceof Error?x.message:"未知错误"}`,"生成失败")}},y=()=>{u&&(clearInterval(u),u=null),d&&(clearTimeout(d),d=null)};return st(()=>{y()}),(x,_)=>(c(),p("div",ci,[_[7]||(_[7]=t("h2",{class:"text-3xl font-bold text-center text-gray-800 mb-6"},"信息收集完成！",-1)),t("div",pi,[t("div",{class:"prose prose-lg prose-gray max-w-none mx-auto mb-4 text-gray-600",innerHTML:f.value},null,8,fi),_[0]||(_[0]=t("p",{class:"text-sm text-gray-500"}," 我们已经收集了足够的信息来为您创建详细的小说蓝图。点击下方按钮开始生成您的专属故事大纲。 ",-1))]),l.value?(c(),p("div",hi,[t("div",gi,[t("div",{class:Q(["absolute inset-0 border-4 rounded-full transition-colors duration-500",i.value>=100?"border-green-100":"border-indigo-100"])},null,2),t("div",{class:Q(["absolute inset-0 border-4 border-transparent rounded-full transition-colors duration-500",[i.value>=100?"border-t-green-500 border-r-green-400":"border-t-indigo-500 border-r-indigo-400",i.value<100?"animate-spin":""]])},null,2),t("div",{class:Q(["absolute inset-3 rounded-full animate-pulse opacity-20 transition-colors duration-500",i.value>=100?"bg-green-500":"bg-indigo-500"])},null,2),t("div",{class:Q(["absolute inset-6 rounded-full flex items-center justify-center transition-colors duration-500",i.value>=100?"bg-green-500":"bg-indigo-500"])},[i.value>=100?(c(),p("svg",mi,[..._[1]||(_[1]=[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):(c(),p("svg",vi,[..._[2]||(_[2]=[t("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])]))],2)]),t("div",bi,[t("h3",xi,w(g.value),1),_[4]||(_[4]=t("p",{class:"text-gray-600"},"AI正在为您精心打造独特的故事蓝图...",-1)),t("div",yi,[t("div",wi,[t("div",{class:Q(["h-2 rounded-full transition-all duration-1000 ease-out relative",i.value>=100?"bg-gradient-to-r from-green-500 to-emerald-600":"bg-gradient-to-r from-indigo-500 to-purple-600"]),style:Ht({width:`${i.value}%`})},[..._[3]||(_[3]=[t("div",{class:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-shimmer"},null,-1)])],6)])]),_[5]||(_[5]=t("div",{class:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200"},[t("p",{class:"text-sm text-blue-800"},[t("svg",{class:"inline w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),Y(" AI正在分析您的创意偏好，生成过程需要一些时间，请耐心等待... ")])],-1))])])):(c(),p("div",_i,[t("button",{onClick:m,disabled:l.value,class:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold py-3 px-8 rounded-full hover:from-indigo-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"},[..._[6]||(_[6]=[t("span",{class:"flex items-center justify-center"},[t("svg",{class:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})]),Y(" 开始创建蓝图 ")],-1)])],8,ki)]))]))}}),Ci=Pt($i,[["__scopeId","data-v-4a298e03"]]),Si={class:"p-8 bg-white rounded-2xl shadow-2xl fade-in"},Ei={key:0,class:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200"},Ti={class:"text-blue-800"},Ai=["innerHTML"],Mi={key:1,class:"text-center py-8"},Li={key:2,class:"text-center mt-8 space-x-4"},ji=["disabled"],Oi=W({__name:"BlueprintDisplay",props:{blueprint:{},aiMessage:{}},emits:["confirm","regenerate"],setup(n,{emit:e}){const s=n,r=e,o=S(!1),l=async()=>{await X.showConfirm("重新生成会覆盖当前蓝图，确定继续吗？","重新生成确认")&&r("regenerate")},i=async()=>{o.value=!0;try{await r("confirm")}finally{o.value=!1}},a=L(()=>{if(!s.blueprint)return'<p class="text-center text-red-500">抱歉，生成大纲失败，未能获取到最终数据。</p>';const u=s.blueprint,d=(R,P="待补充")=>R||P,f=(R,P,D)=>`
    <div class="mb-8 bg-white rounded-xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow duration-300">
      <div class="flex items-center mb-4">
        <div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3">
          ${D}
        </div>
        <h3 class="text-xl font-bold text-gray-800">${R}</h3>
      </div>
      <div class="prose max-w-none text-gray-700">
        ${P}
      </div>
    </div>
  `,g={summary:'<svg class="w-5 h-5 text-indigo-600" fill="currentColor" viewBox="0 0 20 20"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',world:'<svg class="w-5 h-5 text-indigo-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 019 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z" clip-rule="evenodd"></path></svg>',characters:'<svg class="w-5 h-5 text-indigo-600" fill="currentColor" viewBox="0 0 20 20"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path></svg>',relationships:'<svg class="w-5 h-5 text-indigo-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>',chapters:'<svg class="w-5 h-5 text-indigo-600" fill="currentColor" viewBox="0 0 20 20"><path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"></path></svg>'},m=R=>!R||R.length===0?'<p class="text-gray-500 italic">暂无角色信息</p>':R.map(P=>{if(typeof P=="object"&&P.name){const D=P.name,ee={identity:{keys:["identity_background","identity","background","身份背景","身份"],label:"🎭 身份背景",priority:1},personality:{keys:["personality_traits","personality","traits","character","性格特质","性格"],label:"🎨 性格特质",priority:2},goal:{keys:["core_goal","goal","objectives","aims","核心目标","目标"],label:"🎯 核心目标",priority:3},abilities:{keys:["abilities_skills","abilities","skills","powers","能力技能","能力","技能"],label:"⚡ 能力技能",priority:4},relationship:{keys:["relationship_with_protagonist","relationship_to_protagonist","relationship","relation","与主角关系","关系"],label:"🤝 与主角关系",priority:5},role:{keys:["role","character_role","story_role","角色定位","角色"],label:"👤 角色定位",priority:0}},te={},E=new Set(["name"]);Object.entries(ee).forEach(([$,h])=>{for(const v of h.keys)if(P[v]&&!E.has(v)){te[$]={value:P[v],label:h.label,priority:h.priority},E.add(v);break}}),Object.entries(P).forEach(([$,h])=>{if(!E.has($)&&h&&typeof h=="string"&&h.trim()){const v=$.replace(/_/g," ").replace(/([A-Z])/g," $1").replace(/^./,B=>B.toUpperCase());te[`unknown_${$}`]={value:h,label:`📝 ${v}`,priority:99},E.add($)}});const C=Object.entries(te).sort(([,$],[,h])=>$.priority-h.priority);let H="";C.forEach(([$,h])=>{$!=="role"&&(H+=`
            <div class="bg-white/70 rounded-lg p-3">
              <span class="font-medium text-gray-700 block mb-1">${h.label}：</span>
              <span class="text-gray-800">${h.value}</span>
            </div>
          `)});const ve=te.role;return`
          <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-indigo-400 rounded-lg p-5 mb-4">
            <div class="flex items-center justify-between mb-3">
              <h4 class="text-lg font-bold text-indigo-800 flex items-center">
                <span class="w-2 h-2 bg-indigo-500 rounded-full mr-2"></span>
                ${D}
              </h4>
              ${ve?`<span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full text-xs font-medium">${ve.value}</span>`:""}
            </div>
            <div class="space-y-3 text-sm">
              ${H}
            </div>
          </div>
        `}else if(typeof P=="object"&&P.description){const D=P.description,ee=D.identity||"",te=D.personality||"",E=D.relationship_to_protagonist||"";return`
          <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-indigo-400 rounded-lg p-5 mb-4">
            <h4 class="text-lg font-bold text-indigo-800 mb-3 flex items-center">
              <span class="w-2 h-2 bg-indigo-500 rounded-full mr-2"></span>
              ${P.name}
            </h4>
            <div class="space-y-2 text-sm">
              ${ee?`<div class="flex items-start"><span class="font-medium text-gray-600 min-w-16">身份：</span><span class="text-gray-800">${ee}</span></div>`:""}
              ${te?`<div class="flex items-start"><span class="font-medium text-gray-600 min-w-16">性格：</span><span class="text-gray-800">${te}</span></div>`:""}
              ${E?`<div class="flex items-start"><span class="font-medium text-gray-600 min-w-16">关系：</span><span class="text-gray-800">${E}</span></div>`:""}
            </div>
          </div>
        `}else return`
          <div class="bg-gray-50 border-l-4 border-gray-300 rounded-lg p-4 mb-3">
            <h4 class="font-semibold text-gray-800">${P.name||"未知角色"}</h4>
            <p class="text-gray-600 text-sm mt-1">${P.description||"无描述"}</p>
          </div>
        `}).join(""),y=R=>{if(!R||typeof R!="object")return'<p class="text-gray-500 italic">暂无世界设定信息</p>';let P="";return R.core_rules&&(P+=`
        <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4">
          <h4 class="font-semibold text-amber-800 mb-2 flex items-center">
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
            核心设定
          </h4>
          <p class="text-amber-700">${R.core_rules}</p>
        </div>
      `),R.key_locations&&R.key_locations.length>0&&(P+=`
        <div class="mb-4">
          <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
            <svg class="w-4 h-4 mr-2 text-teal-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg>
            关键地点
          </h4>
          <div class="grid gap-3">
            ${R.key_locations.map(D=>`
              <div class="bg-teal-50 border-l-3 border-teal-400 p-3 rounded-r-lg">
                <h5 class="font-medium text-teal-800">${D.name}</h5>
                <p class="text-teal-700 text-sm mt-1">${D.description}</p>
              </div>
            `).join("")}
          </div>
        </div>
      `),R.factions&&R.factions.length>0&&(P+=`
        <div>
          <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
            <svg class="w-4 h-4 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 20 20"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path></svg>
            主要势力
          </h4>
          <div class="grid gap-3">
            ${R.factions.map(D=>`
              <div class="bg-purple-50 border-l-3 border-purple-400 p-3 rounded-r-lg">
                <h5 class="font-medium text-purple-800">${D.name}</h5>
                <p class="text-purple-700 text-sm mt-1">${D.description}</p>
              </div>
            `).join("")}
          </div>
        </div>
      `),P||'<p class="text-gray-500 italic">暂无世界设定详细信息</p>'},x=R=>!R||R.length===0?'<p class="text-gray-500 italic">暂无关系设定</p>':`
      <div class="space-y-3">
        ${R.map(P=>{const D=P.character_from||P.source||"角色A",ee=P.character_to||P.target||"角色B",te=P.description||"暂无描述";return`
            <div class="bg-rose-50 border border-rose-200 rounded-lg p-4">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center">
                  <span class="font-medium text-rose-800 bg-white px-3 py-1 rounded-full text-sm shadow-sm">${D}</span>
                  <svg class="w-5 h-5 mx-3 text-rose-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                  </svg>
                  <span class="font-medium text-rose-800 bg-white px-3 py-1 rounded-full text-sm shadow-sm">${ee}</span>
                </div>
              </div>
              <div class="text-sm text-rose-700 bg-white/50 rounded-lg p-3">
                <span class="font-medium">关系描述：</span>${te}
              </div>
            </div>
          `}).join("")}
      </div>
    `,_=`
    <div class="text-center mb-8 p-6 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl text-white">
      <h1 class="text-4xl font-bold mb-4">${d(u.title,"未知标题")}</h1>
      <div class="flex flex-wrap justify-center gap-3 mb-4">
        <span class="bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-medium">${d(u.genre,"未指定")}</span>
        <span class="bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-medium">${d(u.style,"未指定")}</span>
        <span class="bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-medium">${d(u.tone,"未指定")}</span>
        <span class="bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-medium">${d(u.target_audience,"未指定")}</span>
      </div>
    </div>
  `,k=f("故事梗概",`
    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-5 mb-4">
      <h4 class="font-semibold text-blue-800 mb-2">一句话总结</h4>
      <p class="text-lg italic text-blue-700">"${d(u.one_sentence_summary)}"</p>
    </div>
    <div class="prose max-w-none">
      <h4 class="font-semibold text-gray-800 mb-3">完整简介</h4>
      <p class="text-gray-700 leading-relaxed">${d(u.full_synopsis)}</p>
    </div>
    `,g.summary),O=`
    <div class="space-y-4">
      ${(u.chapter_outline||[]).map((R,P)=>`
        <div class="group relative overflow-hidden bg-gradient-to-r from-gray-50 to-white border border-gray-200 rounded-lg p-5 hover:shadow-md transition-all duration-300">
          <div class="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-indigo-500 to-purple-600 transform origin-top group-hover:scale-y-110 transition-transform duration-300"></div>
          <div class="flex items-start">
            <div class="flex-shrink-0 w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-4">
              <span class="text-indigo-600 font-bold text-sm">${R.chapter_number}</span>
            </div>
            <div class="flex-1">
              <h4 class="text-lg font-bold text-gray-800 mb-2 group-hover:text-indigo-600 transition-colors duration-300">第 ${R.chapter_number} 章: ${R.title}</h4>
              <p class="text-gray-600 leading-relaxed">${R.summary}</p>
            </div>
          </div>
        </div>
      `).join("")}
    </div>
  `;return`
    ${_}
    ${k}
    ${f("世界设定",y(u.world_setting),g.world)}
    ${f("主要角色",m(u.characters||[]),g.characters)}
    ${f("角色关系",x(u.relationships||[]),g.relationships)}
    ${f("章节大纲",O,g.chapters)}
  `});return(u,d)=>(c(),p("div",Si,[d[3]||(d[3]=t("h2",{class:"text-3xl font-bold text-center text-gray-800 mb-6"},"你的故事蓝图已生成！",-1)),n.aiMessage?(c(),p("div",Ei,[t("p",Ti,w(n.aiMessage),1)])):T("",!0),t("div",{class:"prose max-w-none p-6 bg-gray-50 rounded-lg border border-gray-200",innerHTML:a.value},null,8,Ai),o.value?(c(),p("div",Mi,[...d[0]||(d[0]=[mt('<div class="relative mx-auto mb-6 w-16 h-16"><div class="absolute inset-0 border-4 border-green-100 rounded-full"></div><div class="absolute inset-0 border-4 border-transparent border-t-green-500 rounded-full animate-spin"></div><div class="absolute inset-2 bg-green-500 rounded-full flex items-center justify-center"><svg class="w-6 h-6 text-white animate-pulse" fill="currentColor" viewBox="0 0 20 20"><path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6a1 1 0 10-2 0v5.586l-1.293-1.293z"></path><path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v1a1 1 0 11-2 0V4H7v1a1 1 0 11-2 0V4z"></path></svg></div></div><h3 class="text-lg font-semibold text-gray-800 mb-2 animate-pulse">正在保存蓝图...</h3><p class="text-gray-600">即将跳转到写作工作台，开始您的创作之旅</p><div class="mt-4 w-32 mx-auto"><div class="w-full bg-gray-200 rounded-full h-1"><div class="h-1 bg-gradient-to-r from-green-400 to-green-600 rounded-full animate-pulse" style="width:100%;"></div></div></div>',4)])])):(c(),p("div",Li,[t("button",{onClick:l,class:"bg-gray-200 text-gray-700 font-bold py-3 px-8 rounded-full hover:bg-gray-300 transition-all duration-300 transform hover:scale-105"},[...d[1]||(d[1]=[t("span",{class:"flex items-center justify-center"},[t("svg",{class:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})]),Y(" 重新生成 ")],-1)])]),t("button",{onClick:i,disabled:o.value,class:"bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-3 px-8 rounded-full hover:from-green-600 hover:to-emerald-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"},[...d[2]||(d[2]=[t("span",{class:"flex items-center justify-center"},[t("svg",{class:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})]),Y(" 确认并开始创作 ")],-1)])],8,ji)]))]))}}),zi={class:"absolute inset-0 bg-white flex flex-col items-center justify-center text-center p-8 transition-opacity duration-500"},Ri=W({__name:"InspirationLoading",setup(n){return(e,s)=>(c(),p("div",zi,[...s[0]||(s[0]=[mt('<div class="relative mb-8"><div class="w-24 h-24 bg-gradient-to-r from-indigo-400 to-purple-500 rounded-full mx-auto flex items-center justify-center animate-pulse shadow-lg"><svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707"></path></svg></div><div class="absolute inset-0 w-24 h-24 bg-gradient-to-r from-indigo-400 to-purple-500 rounded-full mx-auto animate-ping opacity-30"></div></div><h2 class="text-2xl font-bold text-gray-800 mb-3">正在为你准备灵感空间...</h2><div class="space-y-2 text-gray-600"><p class="animate-pulse" style="animation-delay:0.2s;">✨ 连接文思泉涌的AI...</p><p class="animate-pulse" style="animation-delay:0.6s;">🎨 铺开创意的画卷...</p><p class="animate-pulse" style="animation-delay:1s;">🚀 准备开启灵感之旅！</p></div>',3)])]))}}),Pi={class:"flex items-center justify-center min-h-screen p-4"},Ni={class:"w-full max-w-6xl mx-auto"},Vi={key:0,class:"text-center p-8 bg-white/70 backdrop-blur-xl rounded-2xl shadow-lg fade-in"},Bi=["disabled"],Ii={key:1,class:"h-[90vh] max-h-[950px] flex flex-col bg-white rounded-2xl shadow-2xl overflow-hidden fade-in"},Di={class:"p-4 border-b border-gray-200"},Hi={class:"flex justify-between items-center"},Ui={class:"flex items-center gap-4"},Fi={key:0,class:"text-sm font-medium text-gray-500 bg-gray-100 px-2 py-1 rounded-md"},qi={class:"p-4 border-t border-gray-200 bg-gray-50"},Wi=W({__name:"InspirationMode",setup(n){const e=Et(),s=_n(),r=fs(),o=S(!1),l=S(!1),i=S(!1),a=S(!1),u=S([]),d=S(null),f=S(0),g=S(null),m=S(""),y=S(""),x=S(),_=()=>{e.push("/")},k=()=>{o.value=!1,l.value=!1,i.value=!1,a.value=!1,u.value=[],d.value=null,f.value=0,g.value=null,m.value="",y.value="",r.setCurrentProject(null),r.currentConversationState={}},O=async()=>{await X.showConfirm("确定要退出灵感模式吗？当前进度可能会丢失。","退出确认")&&(k(),e.push("/"))},R=async()=>{await X.showConfirm("确定要重新开始吗？当前对话内容将会丢失。","重新开始确认")&&await D()},P=()=>{i.value=!1},D=async()=>{k(),o.value=!0,l.value=!0;try{await r.createProject("未命名灵感","开始灵感模式"),await te(null)}catch(h){console.error("启动灵感模式失败:",h),X.showError(`无法开始灵感模式: ${h instanceof Error?h.message:"未知错误"}`,"启动失败"),k()}},ee=async h=>{try{await r.loadProject(h);const v=r.currentProject;if(v&&v.conversation_history){o.value=!0,u.value=v.conversation_history.map(U=>{if(U.role==="user")try{return{content:JSON.parse(U.content).value,type:"user"}}catch{return{content:U.content,type:"user"}}else try{return{content:JSON.parse(U.content).ai_message,type:"ai"}}catch{return{content:U.content,type:"ai"}}}).filter(U=>U!==null&&U.content!==null);const B=v.conversation_history.filter(U=>U.role==="assistant").pop()?.content;if(B){const U=JSON.parse(B);U.is_complete?(m.value=U.ai_message,i.value=!0):d.value=U.ui_control}f.value=v.conversation_history.filter(U=>U.role==="assistant").length,await $()}}catch(v){console.error("恢复对话失败:",v),X.showError(`无法恢复对话: ${v instanceof Error?v.message:"未知错误"}`,"加载失败"),k()}},te=async h=>{try{h&&h.value&&(u.value.push({content:h.value,type:"user"}),await $());const v=await r.sendConversation(h);l.value&&(l.value=!1),u.value.push({content:v.ai_message,type:"ai"}),f.value++,await $(),v.is_complete&&v.ready_for_blueprint?(m.value=v.ai_message,i.value=!0):v.is_complete?await E():d.value=v.ui_control}catch(v){console.error("对话失败:",v),l.value&&(l.value=!1),X.showError(`抱歉，与AI连接时遇到问题: ${v instanceof Error?v.message:"未知错误"}`,"通信失败"),k()}},E=async()=>{try{const h=await r.generateBlueprint();C(h)}catch(h){console.error("生成蓝图失败:",h),X.showError(`生成蓝图失败: ${h instanceof Error?h.message:"未知错误"}`,"生成失败")}},C=h=>{g.value=h.blueprint,y.value=h.ai_message,i.value=!1,a.value=!0},H=()=>{a.value=!1,i.value=!0},ve=async()=>{if(!g.value){X.showError("蓝图数据缺失，请重新生成或稍后重试。","保存失败");return}try{await r.saveBlueprint(g.value),r.currentProject&&e.push(`/novel/${r.currentProject.id}`)}catch(h){console.error("保存蓝图失败:",h),X.showError(`保存蓝图失败: ${h instanceof Error?h.message:"未知错误"}`,"保存失败")}},$=async()=>{await tt(),x.value&&(x.value.scrollTop=x.value.scrollHeight)};return Ee(()=>{const h=s.query.project_id;h?ee(h):k()}),(h,v)=>(c(),p("div",Pi,[t("div",Ni,[o.value?!i.value&&!a.value?(c(),p("div",Ii,[t("div",Di,[t("div",Hi,[v[4]||(v[4]=mt('<div class="flex items-center gap-2"><span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-indigo-500"></span></span><span class="text-sm font-medium text-indigo-600">与“文思”对话中...</span></div>',1)),t("div",Ui,[f.value>0?(c(),p("span",Fi," 第 "+w(f.value)+" 轮 ",1)):T("",!0),t("button",{onClick:R,title:"重新开始",class:"text-gray-400 hover:text-indigo-600 transition-colors"},[...v[2]||(v[2]=[t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})],-1)])]),t("button",{onClick:O,title:"返回首页",class:"text-gray-400 hover:text-gray-600 transition-colors"},[...v[3]||(v[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])])])]),t("div",{class:"flex-1 p-6 overflow-y-auto space-y-6 relative",ref_key:"chatArea",ref:x},[xe(cs,{name:"fade"},{default:Re(()=>[l.value?(c(),je(Ri,{key:0})):T("",!0)]),_:1}),(c(!0),p(re,null,ge(u.value,(B,U)=>(c(),je(Qa,{key:U,message:B.content,type:B.type},null,8,["message","type"]))),128))],512),t("div",qi,[xe(di,{"ui-control":d.value,loading:we(r).isLoading,onSubmit:te},null,8,["ui-control","loading"])])])):T("",!0):(c(),p("div",Vi,[v[0]||(v[0]=t("h1",{class:"text-4xl md:text-5xl font-bold text-gray-800"},"小说家的新篇章",-1)),v[1]||(v[1]=t("p",{class:"text-lg text-gray-600 mt-4 mb-8"}," 准备好释放你的创造力了吗？让AI引导你，一步步构建出独一无二的故事世界。 ",-1)),t("button",{onClick:D,disabled:we(r).isLoading,class:"bg-indigo-500 text-white font-bold py-3 px-8 rounded-full hover:bg-indigo-600 transition-all duration-300 transform hover:scale-105 shadow-lg focus:outline-none focus:ring-4 focus:ring-indigo-300 disabled:opacity-50 disabled:cursor-not-allowed"},w(we(r).isLoading?"正在准备...":"开启灵感模式"),9,Bi),t("button",{onClick:_,class:"mt-4 block mx-auto text-gray-500 hover:text-gray-800 transition-colors"}," 返回 ")])),i.value?(c(),je(Ci,{key:2,"ai-message":m.value,onBlueprintGenerated:C,onBack:P},null,8,["ai-message"])):T("",!0),a.value?(c(),je(Oi,{key:3,blueprint:g.value,"ai-message":y.value,onConfirm:ve,onRegenerate:H},null,8,["blueprint","ai-message"])):T("",!0)])]))}}),Qs=W({__name:"Tooltip",props:{text:{}},setup(n){const e=S(!1),s=S(null),r=S(null),o=S({top:0,left:0}),l=L(()=>({top:`${o.value.top}px`,left:`${o.value.left}px`}));let i,a;const u=()=>{clearTimeout(i),a=setTimeout(async()=>{e.value=!0,await tt(),m()},1e3)},d=()=>{clearTimeout(a),i=setTimeout(()=>{e.value=!1},200)},f=()=>{clearTimeout(i)},g=()=>{e.value=!1},m=()=>{if(!s.value||!r.value)return;const y=s.value.getBoundingClientRect(),x=r.value.getBoundingClientRect();let _=y.top-x.height-8,k=y.left+y.width/2-x.width/2;_<0&&(_=y.bottom+8),k<0&&(k=8),k+x.width>window.innerWidth&&(k=window.innerWidth-x.width-8),o.value={top:_,left:k}};return(y,x)=>(c(),p("div",{ref_key:"triggerRef",ref:s,class:"inline-block",onMouseenter:u,onMouseleave:d},[fo(y.$slots,"default"),(c(),je(wn,{to:"body"},[xe(cs,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:Re(()=>[e.value&&n.text?(c(),p("div",{key:0,ref_key:"tooltipRef",ref:r,style:Ht(l.value),class:"fixed z-50 p-3 text-sm leading-tight text-white bg-gray-800 rounded-lg shadow-lg max-w-xs",onMouseenter:f,onMouseleave:g},w(n.text),37)):T("",!0)]),_:1})]))],544))}}),Gi={class:"flex-shrink-0 z-30 bg-white/80 backdrop-blur-lg border-b border-gray-200 shadow-sm"},Ji={class:"px-4 sm:px-6 lg:px-8"},Zi={class:"flex items-center justify-between h-16"},Yi={class:"flex items-center gap-2 sm:gap-4 min-w-0"},Xi={class:"min-w-0"},Ki={class:"text-base sm:text-lg font-bold text-gray-900 truncate"},Qi={class:"hidden sm:flex items-center gap-2 md:gap-4 text-xs md:text-sm text-gray-600"},eu={class:"hidden md:inline"},tu={class:"hidden lg:inline"},su={class:"flex items-center gap-1 sm:gap-2"},nu=W({__name:"WDHeader",props:{project:{},progress:{},completedChapters:{},totalChapters:{}},emits:["goBack","viewProjectDetail","toggleSidebar"],setup(n){const e=Et(),s=ct(),r=()=>{s.logout(),e.push("/login")};return(o,l)=>(c(),p("div",Gi,[t("div",Ji,[t("div",Zi,[t("div",Yi,[t("button",{onClick:l[0]||(l[0]=i=>o.$emit("goBack")),class:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors flex-shrink-0"},[...l[3]||(l[3]=[t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L4.414 9H17a1 1 0 110 2H4.414l5.293 5.293a1 1 0 010 1.414z","clip-rule":"evenodd"})],-1)])]),t("div",Xi,[t("h1",Ki,w(n.project?.title||"加载中..."),1),t("div",Qi,[t("span",null,w(n.project?.blueprint?.genre||"--"),1),l[4]||(l[4]=t("span",{class:"hidden md:inline"},"•",-1)),t("span",eu,w(n.progress)+"% 完成",1),l[5]||(l[5]=t("span",{class:"hidden lg:inline"},"•",-1)),t("span",tu,w(n.completedChapters)+"/"+w(n.totalChapters)+" 章",1)])])]),t("div",su,[t("button",{onClick:l[1]||(l[1]=i=>o.$emit("viewProjectDetail")),class:"p-2 sm:px-3 sm:py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-2"},[...l[6]||(l[6]=[t("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),t("path",{"fill-rule":"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z","clip-rule":"evenodd"})],-1),t("span",{class:"hidden md:inline text-sm"},"项目详情",-1)])]),l[9]||(l[9]=t("div",{class:"w-px h-6 bg-gray-300 hidden sm:block"},null,-1)),t("button",{onClick:r,class:"p-2 sm:px-3 sm:py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-2"},[...l[7]||(l[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),t("span",{class:"hidden md:inline text-sm"},"退出登录",-1)])]),t("button",{onClick:l[2]||(l[2]=i=>o.$emit("toggleSidebar")),class:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors lg:hidden"},[...l[8]||(l[8]=[t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z","clip-rule":"evenodd"})],-1)])])])])])]))}}),ru={class:"h-full flex flex-col"},ou={class:"p-6 border-b border-gray-100 flex-shrink-0"},lu={class:"flex items-center gap-3 mb-4"},au={class:"text-sm text-gray-600"},iu={class:"space-y-3"},uu={class:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-3"},du={class:"text-xs text-blue-700 line-clamp-3"},cu={class:"grid grid-cols-2 gap-2 text-xs"},pu={class:"bg-purple-50 rounded-lg p-2 text-center"},fu={class:"font-semibold text-purple-800"},hu={class:"bg-green-50 rounded-lg p-2 text-center"},gu={class:"font-semibold text-green-800"},mu={class:"p-6 pb-4"},vu={class:"flex items-center justify-between mb-4"},bu={class:"flex items-center gap-2"},xu={class:"bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full text-xs font-medium"},yu={class:"px-6 pb-6"},wu={key:0,class:"space-y-2"},_u=["onClick"],ku={class:"flex items-start gap-3"},$u={class:"flex-shrink-0 pt-1"},Cu=["disabled","checked","onClick"],Su={key:0,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},Eu={key:1,class:"w-4 h-4 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},Tu={key:2,class:"w-4 h-4 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},Au={key:3,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},Mu={key:4},Lu={class:"flex-1 min-w-0"},ju={class:"font-semibold text-gray-900 text-sm mb-1 line-clamp-1"},Ou={class:"text-xs text-gray-600 line-clamp-2 leading-relaxed"},zu={class:"mt-2 flex items-center gap-2 flex-wrap"},Ru={key:1,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},Pu={key:2,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 animate-pulse"},Nu={key:3,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 animate-pulse"},Vu={key:4,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 animate-pulse"},Bu={key:5,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-cyan-100 text-cyan-800 animate-pulse"},Iu={key:6,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"},Du={key:7,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800"},Hu={key:8,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600"},Uu={class:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity duration-200"},Fu=["onClick"],qu=["onClick","disabled","title"],Wu={key:0,class:"w-4 h-4 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},Gu={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},Ju={key:1,class:"text-center py-8 text-gray-500"},Zu={key:2,class:"mt-4"},Yu={class:"mt-4 flex gap-2"},Xu=["disabled"],Ku={key:0,class:"w-5 h-5 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},Qu={key:1,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},ed=W({__name:"WDSidebar",props:{project:{},sidebarOpen:{type:Boolean},selectedChapterNumber:{},generatingChapter:{},evaluatingChapter:{},isGeneratingOutline:{type:Boolean}},emits:["closeSidebar","selectChapter","generateChapter","editChapter","deleteChapter","generateOutline","autoCreate"],setup(n,{emit:e}){const s=n,r=e,o=S([]),l=S(null),i=S({}),a=L(()=>s.project?.blueprint?.characters?.length||0),u=L(()=>s.project?.blueprint?.relationships?.length||0),d=L(()=>!s.project?.blueprint?.chapter_outline||s.project.blueprint.chapter_outline.length===0?null:Math.max(...s.project.blueprint.chapter_outline.map($=>$.chapter_number))),f=L(()=>s.project?.blueprint?.chapter_outline?.length||0),g=L(()=>s.project?.blueprint?.chapter_outline?s.project.blueprint.chapter_outline.some($=>!O($.chapter_number)):!1);function m($){if(O($))return;const h=o.value.indexOf($);h>-1?o.value.splice(h,1):o.value.push($)}function y(){if(o.value.length===0)return;const $=[...o.value].sort((v,B)=>v-B);if(!d.value||!$.includes(d.value)){X.showWarning("批量删除必须包含最后一章。","操作提示");return}if(!$.every((v,B)=>B===0||v===$[B-1]+1)){X.showWarning("只能删除连续的章节块。","操作提示");return}r("deleteChapter",$),o.value=[]}async function x($){await X.showConfirm("重新生成会覆盖当前章节的生成结果，确定继续吗？","重新生成确认")&&r("generateChapter",$)}function _($,h){if(!h){delete i.value[$];return}const v=h instanceof Element?h:h.$el instanceof Element?h.$el:null;v&&(i.value[$]=v)}const k=async()=>{if(!s.project?.blueprint?.chapter_outline)return;const h=[...s.project.blueprint.chapter_outline].sort((U,se)=>U.chapter_number-se.chapter_number).find(U=>!O(U.chapter_number));if(!h)return;await tt();const v=i.value[h.chapter_number];if(!v)return;l.value?v.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}):v.scrollIntoView({behavior:"smooth",block:"center"})},O=$=>{if(!s.project?.chapters)return!1;const h=s.project.chapters.find(v=>v.chapter_number===$);return h&&h.generation_status==="successful"},R=$=>{if(!s.project?.chapters)return!1;const h=s.project.chapters.find(v=>v.chapter_number===$);return h&&h.generation_status==="waiting_for_confirm"},P=$=>{if(!s.project?.chapters)return!1;const h=s.project.chapters.find(v=>v.chapter_number===$);return h&&h.generation_status==="generating"},D=$=>{if(!s.project?.chapters)return!1;const h=s.project.chapters.find(v=>v.chapter_number===$);return h&&h.generation_status==="evaluating"},ee=$=>{if(!s.project?.chapters)return!1;const h=s.project.chapters.find(v=>v.chapter_number===$);return h&&h.generation_status==="failed"},te=$=>{if(!s.project?.chapters)return!1;const h=s.project.chapters.find(v=>v.chapter_number===$);return h&&h.generation_status==="selecting"},E=$=>{if(!s.project?.chapters)return!1;const h=s.project.chapters.find(v=>v.chapter_number===$);return h&&h.generation_status==="ingesting"},C=$=>{if(!s.project?.chapters)return null;const h=s.project.chapters.find(v=>v.chapter_number===$);if(!h?.evaluation)return null;try{let v=JSON.parse(h.evaluation);if(typeof v=="string"&&(v=JSON.parse(v)),v.versions&&Array.isArray(v.versions)){const B=v.best_choice||1,U=v.versions.find($e=>$e.version_index===B);if(U?.score!==void 0)return U.score;const se=v.versions.map($e=>$e.score).filter($e=>typeof $e=="number");if(se.length>0)return Math.max(...se)}if(v.evaluation){const U=Object.values(v.evaluation).map(se=>se.score).filter(se=>typeof se=="number");if(U.length>0)return Math.max(...U)}return null}catch{return null}},H=$=>$>=90?"bg-emerald-100 text-emerald-700":$>=80?"bg-blue-100 text-blue-700":$>=70?"bg-yellow-100 text-yellow-700":$>=60?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700",ve=$=>{if(!s.project?.blueprint?.chapter_outline)return!1;const h=s.project.blueprint.chapter_outline.sort((B,U)=>B.chapter_number-U.chapter_number);for(const B of h){if(B.chapter_number>=$)break;const U=s.project?.chapters.find(se=>se.chapter_number===B.chapter_number);if(!U||U.generation_status!=="successful")return!1}const v=s.project?.chapters.find(B=>B.chapter_number===$);return v&&v.generation_status==="successful",!0};return($,h)=>(c(),p("div",null,[n.sidebarOpen?(c(),p("div",{key:0,onClick:h[0]||(h[0]=v=>$.$emit("closeSidebar")),class:"fixed inset-0 bg-black/20 backdrop-blur-sm z-40 lg:hidden"})):T("",!0),t("div",{class:Q(["bg-white rounded-2xl shadow-lg border border-gray-100 transition-all duration-300 h-full","lg:relative lg:translate-x-0 lg:w-80 lg:flex-shrink-0",n.sidebarOpen?"fixed left-4 top-20 bottom-4 w-80 z-50 translate-x-0":"lg:w-80 lg:flex-shrink-0 -translate-x-full absolute lg:relative"])},[t("div",ru,[t("div",ou,[t("div",lu,[h[4]||(h[4]=t("div",{class:"w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center"},[t("svg",{class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",null,[h[3]||(h[3]=t("h2",{class:"text-lg font-bold text-gray-900"},"故事蓝图",-1)),t("p",au,w(n.project.blueprint?.style||"未设定风格"),1)])]),t("div",iu,[t("div",uu,[h[5]||(h[5]=t("h3",{class:"text-sm font-semibold text-blue-900 mb-1"},"故事概要",-1)),xe(Qs,{text:n.project.blueprint?.one_sentence_summary},{default:Re(()=>[t("p",du,w(n.project.blueprint?.one_sentence_summary||"暂无概要"),1)]),_:1},8,["text"])]),t("div",cu,[t("div",pu,[t("div",fu,w(a.value),1),h[6]||(h[6]=t("div",{class:"text-purple-600"},"角色",-1))]),t("div",hu,[t("div",gu,w(u.value),1),h[7]||(h[7]=t("div",{class:"text-green-600"},"关系",-1))])])])]),t("div",{ref_key:"listContainer",ref:l,class:"flex-1 overflow-y-auto"},[t("div",mu,[t("div",vu,[h[8]||(h[8]=t("h3",{class:"text-lg font-bold text-gray-900"},"章节大纲",-1)),t("div",bu,[g.value?(c(),p("button",{key:0,onClick:Ne(k,["stop"]),class:"px-3 py-1 text-xs font-medium text-indigo-600 bg-indigo-50 rounded-full hover:bg-indigo-100 transition-colors"}," 定位到未完成 ")):T("",!0),t("span",xu,w(f.value)+" 章 ",1)])])]),t("div",yu,[n.project.blueprint?.chapter_outline?.length?(c(),p("div",wu,[(c(!0),p(re,null,ge(n.project.blueprint.chapter_outline,v=>(c(),p("div",{key:v.chapter_number,ref_for:!0,ref:B=>_(v.chapter_number,B),onClick:B=>$.$emit("selectChapter",v.chapter_number),class:Q(["group cursor-pointer rounded-lg border-2 p-4 transition-all duration-200",o.value.includes(v.chapter_number)?"border-red-300 bg-red-50":n.selectedChapterNumber===v.chapter_number?"border-indigo-300 bg-indigo-50 shadow-md":"border-gray-200 hover:border-indigo-200 hover:bg-gray-50"])},[t("div",ku,[t("div",$u,[t("input",{type:"checkbox",disabled:O(v.chapter_number),checked:o.value.includes(v.chapter_number),onClick:Ne(B=>m(v.chapter_number),["stop"]),class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 disabled:opacity-50"},null,8,Cu)]),t("div",{class:Q(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0",O(v.chapter_number)?"bg-green-500 text-white":P(v.chapter_number)||D(v.chapter_number)||te(v.chapter_number)||E(v.chapter_number)?"bg-blue-500 text-white animate-pulse":ee(v.chapter_number)?"bg-red-500 text-white":n.selectedChapterNumber===v.chapter_number?"bg-indigo-500 text-white":"bg-gray-200 text-gray-600"])},[O(v.chapter_number)?(c(),p("svg",Su,[...h[9]||(h[9]=[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):P(v.chapter_number)||te(v.chapter_number)||E(v.chapter_number)?(c(),p("svg",Eu,[...h[10]||(h[10]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])):D(v.chapter_number)?(c(),p("svg",Tu,[...h[11]||(h[11]=[t("path",{d:"M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15v1a1 1 0 001 1h12a1 1 0 001-1v-1a1 1 0 00-.293-.707L16 11.586V8a6 6 0 00-6-6zM8.05 17a2 2 0 103.9 0H8.05z"},null,-1)])])):ee(v.chapter_number)?(c(),p("svg",Au,[...h[12]||(h[12]=[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)])])):(c(),p("span",Mu,w(v.chapter_number),1))],2),t("div",Lu,[xe(Qs,{text:v.title},{default:Re(()=>[t("h4",ju,w(v.title),1)]),_:2},1032,["text"]),xe(Qs,{text:v.summary},{default:Re(()=>[t("p",Ou,w(v.summary),1)]),_:2},1032,["text"]),t("div",zu,[C(v.chapter_number)!==null?(c(),p("span",{key:0,class:Q(["inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",H(C(v.chapter_number))])},w(C(v.chapter_number))+" 分 ",3)):T("",!0),O(v.chapter_number)?(c(),p("span",Ru," 已完成 ")):P(v.chapter_number)?(c(),p("span",Pu," 生成中... ")):te(v.chapter_number)?(c(),p("span",Nu," 选择中... ")):D(v.chapter_number)?(c(),p("span",Vu," 评审中... ")):E(v.chapter_number)?(c(),p("span",Bu," 入库中... ")):ee(v.chapter_number)?(c(),p("span",Iu," 生成失败 ")):R(v.chapter_number)?(c(),p("span",Du," 待选择版本 ")):(c(),p("span",Hu," 未开始 "))])]),t("div",Uu,[O(v.chapter_number)?T("",!0):(c(),p("button",{key:0,onClick:Ne(B=>$.$emit("editChapter",v),["stop"]),class:"p-1.5 text-gray-500 hover:bg-gray-100 rounded-md transition-colors",title:"编辑大纲"},[...h[13]||(h[13]=[t("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),t("path",{"fill-rule":"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z","clip-rule":"evenodd"})],-1)])],8,Fu)),ve(v.chapter_number)||ee(v.chapter_number)||R(v.chapter_number)?(c(),p("button",{key:1,onClick:Ne(B=>x(v.chapter_number),["stop"]),disabled:n.generatingChapter===v.chapter_number||P(v.chapter_number),class:"p-1.5 text-indigo-600 hover:bg-indigo-100 rounded-md transition-colors disabled:opacity-50",title:O(v.chapter_number)?"重新生成":ee(v.chapter_number)?"重试":R(v.chapter_number)?"重新生成版本":"开始创作"},[n.generatingChapter===v.chapter_number||P(v.chapter_number)?(c(),p("svg",Wu,[...h[14]||(h[14]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])):(c(),p("svg",Gu,[...h[15]||(h[15]=[t("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"},null,-1)])]))],8,qu)):T("",!0)])])],10,_u))),128))])):(c(),p("div",Ju,[...h[16]||(h[16]=[t("svg",{class:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9z"})],-1),t("p",null,"暂无章节大纲",-1)])])),o.value.length>0?(c(),p("div",Zu,[t("button",{onClick:y,class:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"},[h[17]||(h[17]=t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z","clip-rule":"evenodd"})],-1)),t("span",null,"删除选中的 "+w(o.value.length)+" 章",1)])])):T("",!0),t("div",Yu,[t("button",{onClick:h[1]||(h[1]=v=>$.$emit("generateOutline")),disabled:s.isGeneratingOutline,class:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[s.isGeneratingOutline?(c(),p("svg",Ku,[...h[18]||(h[18]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])):(c(),p("svg",Qu,[...h[19]||(h[19]=[t("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"},null,-1)])])),t("span",null,w(s.isGeneratingOutline?"生成中...":"生成后续大纲"),1)],8,Xu),t("button",{onClick:h[2]||(h[2]=v=>$.$emit("autoCreate")),class:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors"},[...h[20]||(h[20]=[t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"})],-1),t("span",null,"连续创作",-1)])])])])],512)])],2)]))}}),td={class:"h-full flex items-center justify-center"},sd=W({__name:"WorkspaceInitial",setup(n){return(e,s)=>(c(),p("div",td,[...s[0]||(s[0]=[mt('<div class="text-center"><svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20"><path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"></path></svg><h3 class="text-lg font-semibold text-gray-700 mb-2">选择章节开始创作</h3><p class="text-gray-500">从左侧章节列表中选择一个章节，开始您的创作之旅</p></div>',1)])]))}}),nd={class:"h-full flex items-center justify-center"},rd={class:"text-center max-w-md"},od={class:"text-2xl font-bold text-gray-800 mb-3"},ld={class:"space-y-2 text-gray-600 mb-6"},ad={class:"animate-pulse"},id={class:"animate-pulse",style:{"animation-delay":"0.5s"}},ud=W({__name:"ChapterGenerating",props:{chapterNumber:{},status:{}},emits:["cancel-evaluation"],setup(n,{emit:e}){const s=n,r=e,o=L(()=>{switch(s.status){case"generating":return{title:`AI 正在为您创作第${s.chapterNumber}章`,line1:"✨ 构思情节发展...",line2:"📝 编织精彩对话..."};case"evaluating":return{title:`AI 正在评审第${s.chapterNumber}章的多个版本`,line1:"🧐 分析故事结构...",line2:"⚖️ 比较版本优劣..."};case"selecting":return{title:`正在确认第${s.chapterNumber}章的最终版本`,line1:"💾 保存您的选择...",line2:"✍️ 生成最终摘要..."};default:return{title:"请稍候...",line1:"正在处理您的请求...",line2:"..."}}});return(l,i)=>(c(),p("div",nd,[t("div",rd,[i[2]||(i[2]=mt('<div class="relative mb-8"><div class="w-24 h-24 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-full mx-auto flex items-center justify-center animate-pulse shadow-lg"><svg class="w-12 h-12 text-white animate-spin" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path></svg></div><div class="absolute inset-0 w-24 h-24 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-full mx-auto animate-ping opacity-20"></div></div>',1)),t("h3",od,w(o.value.title),1),t("div",ld,[t("p",ad,w(o.value.line1),1),t("p",id,w(o.value.line2),1),i[1]||(i[1]=t("p",{class:"animate-pulse",style:{"animation-delay":"1s"}},"🎨 描绘生动场景...",-1))]),i[3]||(i[3]=t("div",{class:"bg-blue-50 border border-blue-200 rounded-xl p-4"},[t("p",{class:"text-blue-800 text-sm"},[t("svg",{class:"w-4 h-4 inline mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),Y(" 生成过程通常需要2分钟以上，请耐心等待。您可以随时离开此页面，生成完成后再回来查看。 ")])],-1)),n.status==="evaluating"?(c(),p("button",{key:0,onClick:i[0]||(i[0]=a=>r("cancel-evaluation")),class:"mt-4 px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors"}," 取消评审 ")):T("",!0)])]))}}),dd={class:"space-y-6"},cd={key:0,class:"bg-red-50 border border-red-200 rounded-xl p-4"},pd={class:"flex items-center justify-between"},fd=["disabled"],hd={key:0,class:"w-4 h-4 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},gd={key:1,class:"bg-purple-50 border border-purple-200 rounded-xl p-4"},md={class:"flex items-center justify-between"},vd={key:2,class:"bg-blue-50 border border-blue-200 rounded-xl p-4"},bd={class:"flex items-start gap-3"},xd={class:"flex-1"},yd=["innerHTML"],wd={key:3,class:"bg-amber-50 border border-amber-200 rounded-xl p-4"},_d={key:4,class:"bg-blue-50 border border-blue-200 rounded-xl p-4"},kd={class:"bg-gray-50 rounded-xl p-4"},$d={class:"flex items-center justify-between mb-4"},Cd={class:"font-semibold text-gray-800"},Sd={class:"text-sm font-normal text-gray-600 ml-2"},Ed={class:"grid gap-3"},Td=["onClick"],Ad={class:"flex items-start gap-3"},Md={key:0,class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},Ld={key:1},jd={class:"flex-1"},Od={class:"text-sm text-gray-700 line-clamp-3"},zd={class:"mt-2 flex items-center gap-2 text-xs text-gray-500"},Rd={key:0,class:"text-indigo-600 font-medium"},Pd={key:1},Nd={key:3,class:"text-green-600 font-medium"},Vd={class:"mt-2"},Bd=["onClick"],Id={class:"mt-4 flex justify-end items-center gap-4"},Dd=["disabled"],Hd={key:0,class:"w-4 h-4 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},Ud=["disabled"],Fd={key:0,class:"w-5 h-5 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},qd={key:1},fr=W({__name:"VersionSelector",props:{selectedChapter:{},chapterGenerationResult:{},availableVersions:{},selectedVersionIndex:{},evaluatingChapter:{},isSelectingVersion:{type:Boolean},isEvaluationFailed:{type:Boolean}},emits:["hideVersionSelector","update:selectedVersionIndex","showVersionDetail","confirmVersionSelection","evaluateChapter","showEvaluationDetail"],setup(n){const e=n,s=a=>{if(!e.selectedChapter?.content||!e.availableVersions?.[a]?.content)return!1;const u=r(e.selectedChapter.content),d=r(e.availableVersions[a].content);return u===d},r=a=>{if(!a)return"";typeof a!="string"&&(typeof a=="object"&&a.content?a=a.content:a=String(a));try{const d=JSON.parse(a);d&&typeof d=="object"&&d.content&&(a=d.content)}catch{}let u=a.replace(/^"|"$/g,"");return u=u.replace(/\\n/g,`
`),u=u.replace(/\\"/g,'"'),u=u.replace(/\\t/g,"	"),u=u.replace(/\\\\/g,"\\"),u},o=a=>{if(!a)return"";let u=a.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");return u=u.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),u=u.replace(/(?<!\*)\*([^*]+)\*(?!\*)/g,"<em>$1</em>"),u=u.replace(/^([A-Z])\)\s*\*\*(.*?)\*\*(.*)/gm,'<div class="mb-2"><span class="inline-flex items-center justify-center w-6 h-6 bg-indigo-100 text-indigo-600 text-sm font-bold rounded-full mr-2">$1</span><strong>$2</strong>$3</div>'),u=u.replace(/\n/g,"<br>"),u=u.replace(/(<br\s*\/?>\s*){2,}/g,'</p><p class="mt-2">'),u.includes("<p>")||(u=`<p>${u}</p>`),Rt.sanitize(u)},l=L(()=>{const a={};if(!e.selectedChapter?.evaluation)return a;try{const u=JSON.parse(e.selectedChapter.evaluation);if(u.versions&&Array.isArray(u.versions))for(const d of u.versions)d.version_index!==void 0&&d.score!==void 0&&(a[d.version_index-1]=d.score);else if(u.evaluation)for(const[d,f]of Object.entries(u.evaluation)){const g=d.match(/version(\d+)/);g&&f?.score!==void 0&&(a[parseInt(g[1])-1]=f.score)}}catch{}return a}),i=a=>a===null?"":a>=90?"bg-green-100 text-green-700":a>=80?"bg-blue-100 text-blue-700":a>=70?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700";return(a,u)=>(c(),p("div",dd,[n.isEvaluationFailed?(c(),p("div",cd,[t("div",pd,[u[5]||(u[5]=mt('<div class="flex items-center gap-3"><div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0"><svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg></div><div><h4 class="font-bold text-red-900">AI 评审失败</h4><p class="text-sm text-red-700">AI 评审时遇到问题，请重试。</p></div></div>',1)),t("button",{onClick:u[0]||(u[0]=d=>a.$emit("evaluateChapter")),disabled:n.evaluatingChapter===n.selectedChapter?.chapter_number,class:"px-4 py-2 bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors disabled:opacity-50 flex items-center gap-2 whitespace-nowrap"},[n.evaluatingChapter===n.selectedChapter?.chapter_number?(c(),p("svg",hd,[...u[4]||(u[4]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])):T("",!0),Y(" "+w(n.evaluatingChapter===n.selectedChapter?.chapter_number?"重试中...":"重新评审"),1)],8,fd)])])):n.selectedChapter?.evaluation?(c(),p("div",gd,[t("div",md,[u[6]||(u[6]=mt('<div class="flex items-center gap-3"><div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0"><svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15v1a1 1 0 001 1h12a1 1 0 001-1v-1a1 1 0 00-.293-.707L16 11.586V8a6 6 0 00-6-6zM8.05 17a2 2 0 103.9 0H8.05z"></path></svg></div><div><h4 class="font-bold text-purple-900">AI 评审已完成</h4><p class="text-sm text-purple-700">AI 已对所有版本进行评估，点击查看详细结果。</p></div></div>',1)),t("button",{onClick:u[1]||(u[1]=d=>a.$emit("showEvaluationDetail")),class:"px-4 py-2 bg-purple-600 text-white hover:bg-purple-700 rounded-lg transition-colors flex items-center gap-2 whitespace-nowrap"}," 查看 AI 评审 ")])])):T("",!0),n.chapterGenerationResult?.ai_message?(c(),p("div",vd,[t("div",bd,[u[7]||(u[7]=t("div",{class:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0"},[t("svg",{class:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})])],-1)),t("div",xd,[t("div",{class:"prose prose-sm max-w-none prose-headings:mt-2 prose-headings:mb-1 prose-p:my-1 prose-ul:my-1 prose-ol:my-1 prose-li:my-0 text-blue-800",innerHTML:o(n.chapterGenerationResult.ai_message)},null,8,yd)])])])):T("",!0),n.selectedChapter?.content?(c(),p("div",wd,[...u[8]||(u[8]=[t("div",{class:"flex items-center gap-2 text-amber-800"},[t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),t("span",{class:"font-medium"},"您可以查看所有版本并选择不同的版本")],-1)])])):(c(),p("div",_d,[...u[9]||(u[9]=[t("div",{class:"flex items-center gap-2 text-blue-800"},[t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),t("span",{class:"font-medium"},"请选择一个版本来完成这个章节")],-1)])])),t("div",kd,[t("div",$d,[t("h4",Cd,[Y(w(n.availableVersions.length>1?"选择版本":"生成内容")+" ",1),t("span",Sd,"("+w(n.availableVersions.length)+" 个版本)",1)])]),t("div",Ed,[(c(!0),p(re,null,ge(n.availableVersions,(d,f)=>(c(),p("div",{key:f,onClick:g=>a.$emit("update:selectedVersionIndex",f),class:Q(["cursor-pointer border-2 rounded-lg p-4 transition-all duration-200",n.selectedVersionIndex===f?"border-indigo-300 bg-indigo-50 shadow-md":s(f)?"border-green-300 bg-green-50":"border-gray-200 hover:border-indigo-200 hover:bg-white"])},[t("div",Ad,[t("div",{class:Q(["w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0",n.selectedVersionIndex===f?"bg-indigo-500 text-white":s(f)?"bg-green-500 text-white":"bg-gray-300 text-gray-600"])},[s(f)?(c(),p("svg",Md,[...u[10]||(u[10]=[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):(c(),p("span",Ld,w(f+1),1))],2),t("div",jd,[t("p",Od,w(r(d.content).substring(0,150))+"... ",1),t("div",zd,[d.provider?(c(),p("span",Rd,w(d.provider),1)):T("",!0),d.provider?(c(),p("span",Pd,"•")):T("",!0),t("span",null,"约 "+w(Math.round(r(d.content).length/100)*100)+" 字",1),l.value[f]!==void 0?(c(),p("span",{key:2,class:Q(["px-2 py-0.5 rounded-full text-xs font-semibold",i(l.value[f])])},w(l.value[f])+" 分 ",3)):T("",!0),s(f)?(c(),p("span",Nd,"• 当前选中")):T("",!0)]),t("div",Vd,[t("button",{onClick:Ne(g=>a.$emit("showVersionDetail",f),["stop"]),class:"text-xs text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-1"},[...u[11]||(u[11]=[t("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),t("path",{"fill-rule":"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z","clip-rule":"evenodd"})],-1),Y(" 查看详情 ",-1)])],8,Bd)])])])],10,Td))),128))]),t("div",Id,[t("button",{onClick:u[2]||(u[2]=d=>a.$emit("evaluateChapter")),disabled:n.evaluatingChapter===n.selectedChapter?.chapter_number||n.availableVersions.length<2,class:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[n.evaluatingChapter===n.selectedChapter?.chapter_number?(c(),p("svg",Hd,[...u[12]||(u[12]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])):T("",!0),Y(" "+w(n.evaluatingChapter===n.selectedChapter?.chapter_number?"评审中...":"AI 评审"),1)],8,Dd),t("button",{onClick:u[3]||(u[3]=d=>a.$emit("confirmVersionSelection")),disabled:!n.availableVersions?.[n.selectedVersionIndex]?.content||s(n.selectedVersionIndex)||n.isSelectingVersion,class:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"},[n.isSelectingVersion?(c(),p("svg",Fd,[...u[13]||(u[13]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])):(c(),p("span",qd,w(s(n.selectedVersionIndex)?"当前版本":"确认选择此版本"),1))],8,Ud)])])]))}}),Wd={class:"space-y-6"},Gd={class:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6"},Jd={class:"flex items-center justify-between"},Zd={class:"bg-gray-50 rounded-xl p-6"},Yd={class:"flex items-center justify-between mb-4 gap-3"},Xd={class:"flex items-center gap-3"},Kd={class:"text-sm text-gray-500"},Qd=["disabled"],ec={class:"prose max-w-none"},tc={class:"whitespace-pre-wrap text-gray-700 leading-relaxed"},sc=W({__name:"ChapterContent",props:{selectedChapter:{}},emits:["showVersionSelector"],setup(n){const e=o=>{if(!o)return"";try{const i=JSON.parse(o);i&&typeof i=="object"&&i.content&&(o=i.content)}catch{}let l=o.replace(/^"|"$/g,"");return l=l.replace(/\\n/g,`
`),l=l.replace(/\\"/g,'"'),l=l.replace(/\\t/g,"	"),l=l.replace(/\\\\/g,"\\"),l},s=o=>o.replace(/[\\/:*?"<>|]/g,"_"),r=o=>{if(!o)return;const l=o.title?.trim()||`第${o.chapter_number}章`,i=s(l)||`chapter-${o.chapter_number}`,a=e(o.content||""),u=new Blob([a],{type:"text/plain;charset=utf-8"}),d=URL.createObjectURL(u),f=document.createElement("a");f.href=d,f.download=`${i}.txt`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(d)};return(o,l)=>(c(),p("div",Wd,[t("div",Gd,[t("div",Jd,[l[3]||(l[3]=t("div",{class:"flex items-center gap-2 text-green-800"},[t("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})]),t("span",{class:"font-medium"},"这个章节已经完成")],-1)),n.selectedChapter.versions&&n.selectedChapter.versions.length>0?(c(),p("button",{key:0,onClick:l[0]||(l[0]=i=>o.$emit("showVersionSelector",!0)),class:"text-green-700 hover:text-green-800 text-sm font-medium flex items-center gap-1"},[...l[2]||(l[2]=[t("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),t("path",{"fill-rule":"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z","clip-rule":"evenodd"})],-1),Y(" 查看所有版本 ",-1)])])):T("",!0)])]),t("div",Zd,[t("div",Yd,[l[5]||(l[5]=t("h4",{class:"font-semibold text-gray-800"},"章节内容",-1)),t("div",Xd,[t("div",Kd," 约 "+w(Math.round(e(n.selectedChapter.content||"").length/100)*100)+" 字 ",1),t("button",{class:Q(["inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium rounded-lg border transition-colors duration-200",n.selectedChapter.content?"border-indigo-200 text-indigo-600 hover:bg-indigo-50":"border-gray-200 text-gray-400 cursor-not-allowed"]),disabled:!n.selectedChapter.content,onClick:l[1]||(l[1]=i=>r(n.selectedChapter))},[...l[4]||(l[4]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v16h16V4m-4 4l-4-4-4 4m4-4v12"})],-1),Y(" 导出TXT ",-1)])],10,Qd)])]),t("div",ec,[t("div",tc,w(e(n.selectedChapter.content||"")),1)])])]))}}),nc={class:"h-full flex items-center justify-center"},rc={class:"text-center max-w-md"},oc={class:"text-2xl font-bold text-gray-800 mb-3"},lc=["disabled"],ac={key:0,class:"w-4 h-4 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},ic={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},uc=W({__name:"ChapterFailed",props:{chapterNumber:{},generatingChapter:{}},emits:["generateChapter"],setup(n){return(e,s)=>(c(),p("div",nc,[t("div",rc,[s[3]||(s[3]=t("div",{class:"w-24 h-24 bg-red-100 rounded-full mx-auto flex items-center justify-center mb-6 shadow-lg"},[t("svg",{class:"w-12 h-12 text-red-500",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),t("h3",oc,"第"+w(n.chapterNumber)+"章生成失败",1),s[4]||(s[4]=t("p",{class:"text-gray-600 mb-6"},"很抱歉，AI在生成这个章节时遇到了问题。请点击重试按钮重新生成。",-1)),t("button",{onClick:s[0]||(s[0]=r=>e.$emit("generateChapter",n.chapterNumber)),disabled:n.generatingChapter===n.chapterNumber,class:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 flex items-center gap-2 mx-auto"},[n.generatingChapter===n.chapterNumber?(c(),p("svg",ac,[...s[1]||(s[1]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])):(c(),p("svg",ic,[...s[2]||(s[2]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])),Y(" "+w(n.generatingChapter===n.chapterNumber?"重试中...":"重试生成"),1)],8,lc)])]))}}),dc={class:"h-full flex items-center justify-center"},cc={class:"text-center"},pc={key:0},fc=["disabled"],hc={key:0,class:"w-4 h-4 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},gc={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},mc={key:1},vc=W({__name:"ChapterEmpty",props:{chapterNumber:{},generatingChapter:{},canGenerate:{type:Boolean}},emits:["generateChapter"],setup(n){return(e,s)=>(c(),p("div",dc,[t("div",cc,[s[5]||(s[5]=t("svg",{class:"w-16 h-16 text-gray-300 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})],-1)),s[6]||(s[6]=t("h3",{class:"text-lg font-semibold text-gray-700 mb-2"},"开始创作",-1)),n.canGenerate?(c(),p("div",pc,[s[3]||(s[3]=t("p",{class:"text-gray-500 mb-4"},'点击"开始创作"按钮生成这个章节',-1)),t("button",{onClick:s[0]||(s[0]=r=>e.$emit("generateChapter",n.chapterNumber)),disabled:n.generatingChapter===n.chapterNumber,class:"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 flex items-center gap-2 mx-auto"},[n.generatingChapter===n.chapterNumber?(c(),p("svg",hc,[...s[1]||(s[1]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])):(c(),p("svg",gc,[...s[2]||(s[2]=[t("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"},null,-1)])])),Y(" "+w(n.generatingChapter===n.chapterNumber?"生成中...":"开始创作"),1)],8,fc)])):(c(),p("div",mc,[...s[4]||(s[4]=[t("p",{class:"text-gray-500 mb-4"},"请先完成前面的章节，才能生成此章节",-1),t("div",{class:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-600 rounded-lg"},[t("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z","clip-rule":"evenodd"})]),Y(" 按顺序生成 ")],-1)])]))])]))}}),bc={class:"flex-1 min-w-0 h-full"},xc={class:"bg-white rounded-2xl shadow-lg border border-gray-100 h-full flex flex-col"},yc={key:0,class:"border-b border-gray-100 p-6 flex-shrink-0"},wc={class:"flex items-center justify-between"},_c={class:"flex items-center gap-3 mb-2"},kc={class:"text-xl font-bold text-gray-900"},$c={class:"text-lg text-gray-700 mb-1"},Cc={class:"text-sm text-gray-600"},Sc={class:"flex items-center gap-2"},Ec=["disabled"],Tc={key:0,class:"w-4 h-4 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},Ac={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},Mc={class:"flex-1 p-6 overflow-y-auto"},Lc={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},jc={class:"bg-white rounded-2xl shadow-xl w-full h-full flex flex-col"},Oc={class:"flex items-center justify-between p-6 border-b border-gray-200"},zc={class:"text-lg font-semibold text-gray-900"},Rc={class:"flex-1 p-6 overflow-hidden"},Pc={class:"flex flex-col h-full"},Nc=["disabled"],Vc={class:"text-sm text-gray-500 mt-2"},Bc={class:"flex items-center justify-end gap-3 p-6 border-t border-gray-200"},Ic=["disabled"],Dc=["disabled"],Hc={key:0,class:"w-4 h-4 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},Uc=W({__name:"WDWorkspace",props:{project:{},selectedChapterNumber:{},generatingChapter:{},evaluatingChapter:{},showVersionSelector:{type:Boolean},chapterGenerationResult:{},selectedVersionIndex:{},availableVersions:{},isSelectingVersion:{type:Boolean}},emits:["regenerateChapter","evaluateChapter","cancelEvaluation","hideVersionSelector","update:selectedVersionIndex","showVersionDetail","confirmVersionSelection","generateChapter","showVersionSelector","showEvaluationDetail","fetchChapterStatus","editChapter"],setup(n,{emit:e}){const s=n,r=e,o=async()=>{await X.showConfirm("重新生成会覆盖当前章节的现有内容，确定继续吗？","重新生成确认")&&r("regenerateChapter")},l=S(!1),i=S(""),a=S(!1),u=E=>{if(!E)return"";try{const H=JSON.parse(E);H&&typeof H=="object"&&H.content&&(E=H.content)}catch{}let C=E.replace(/^"|"$/g,"");return C=C.replace(/\\n/g,`
`),C=C.replace(/\\"/g,'"'),C=C.replace(/\\t/g,"	"),C=C.replace(/\\\\/g,"\\"),C},d=()=>{m.value?.content&&(i.value=u(m.value.content),l.value=!0)},f=()=>{l.value=!1,i.value="",a.value=!1},g=async()=>{if(!(!s.selectedChapterNumber||!i.value.trim())){a.value=!0;try{r("editChapter",{chapterNumber:s.selectedChapterNumber,content:i.value}),f()}catch(E){console.error("保存章节内容失败:",E)}finally{a.value=!1}}},m=L(()=>!s.project||s.selectedChapterNumber===null?null:s.project.chapters.find(E=>E.chapter_number===s.selectedChapterNumber)||null),y=L(()=>!s.project?.blueprint?.chapter_outline||s.selectedChapterNumber===null?null:s.project.blueprint.chapter_outline.find(E=>E.chapter_number===s.selectedChapterNumber)||null),x=E=>{if(!s.project?.chapters)return!1;const C=s.project.chapters.find(H=>H.chapter_number===E);return C&&C.generation_status==="successful"},_=E=>{if(!s.project?.chapters)return!1;const C=s.project.chapters.find(H=>H.chapter_number===E);return C&&C.generation_status==="failed"},k=E=>{if(!s.project?.chapters)return!1;const C=s.project.chapters.find(H=>H.chapter_number===E);return C&&C.generation_status==="evaluation_failed"},O=E=>{if(E===null||!s.project?.blueprint?.chapter_outline)return!1;const C=s.project.blueprint.chapter_outline.sort((ve,$)=>ve.chapter_number-$.chapter_number);for(const ve of C){if(ve.chapter_number>=E)break;const $=s.project?.chapters.find(h=>h.chapter_number===ve.chapter_number);if(!$||$.generation_status!=="successful")return!1}const H=s.project?.chapters.find(ve=>ve.chapter_number===E);return H&&H.generation_status==="successful",!0},R=L(()=>{if(!s.selectedChapterNumber)return sd;const E=m.value?.generation_status;return E==="generating"||E==="evaluating"||E==="selecting"?ud:E==="waiting_for_confirm"||E==="evaluation_failed"||s.showVersionSelector&&m.value?.versions?.length?fr:m.value?.content?sc:_(s.selectedChapterNumber)?uc:vc}),P=S(null),D=()=>{ee(),P.value=window.setInterval(()=>{r("fetchChapterStatus")},1e4)},ee=()=>{P.value&&(clearInterval(P.value),P.value=null)};Se(()=>[m.value?.generation_status,s.evaluatingChapter,s.isSelectingVersion,s.selectedChapterNumber],([E,C,H,ve])=>{if(ve===null){ee();return}E==="generating"||E==="evaluating"||E==="selecting"?D():ee()},{immediate:!0}),st(()=>{ee()});const te=L(()=>{if(!s.selectedChapterNumber)return{};const E=m.value?.generation_status;return E==="generating"||E==="evaluating"||E==="selecting"?{chapterNumber:s.selectedChapterNumber,status:E}:E==="waiting_for_confirm"||E==="evaluation_failed"?{selectedChapter:m.value,chapterGenerationResult:s.chapterGenerationResult,availableVersions:s.availableVersions,selectedVersionIndex:s.selectedVersionIndex,isSelectingVersion:s.isSelectingVersion,evaluatingChapter:s.evaluatingChapter,isEvaluationFailed:k(s.selectedChapterNumber)}:s.showVersionSelector&&m.value?.versions?.length?{selectedChapter:m.value,chapterGenerationResult:s.chapterGenerationResult,availableVersions:s.availableVersions,selectedVersionIndex:s.selectedVersionIndex,isSelectingVersion:s.isSelectingVersion,evaluatingChapter:s.evaluatingChapter,isEvaluationFailed:!1}:m.value?.content?{selectedChapter:m.value}:_(s.selectedChapterNumber)?{chapterNumber:s.selectedChapterNumber,generatingChapter:s.generatingChapter}:{chapterNumber:s.selectedChapterNumber,generatingChapter:s.generatingChapter,canGenerate:O(s.selectedChapterNumber)}});return(E,C)=>(c(),p("div",bc,[t("div",xc,[n.selectedChapterNumber?(c(),p("div",yc,[t("div",wc,[t("div",null,[t("div",_c,[t("h2",kc,"第"+w(n.selectedChapterNumber)+"章",1),t("span",{class:Q(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",x(n.selectedChapterNumber)?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"])},w(x(n.selectedChapterNumber)?"已完成":"未完成"),3)]),t("h3",$c,w(y.value?.title||"未知标题"),1),t("p",Cc,w(y.value?.summary||"暂无章节描述"),1)]),t("div",Sc,[x(n.selectedChapterNumber)?(c(),p("button",{key:0,onClick:d,class:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors flex items-center gap-2 whitespace-nowrap"},[...C[11]||(C[11]=[t("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})],-1),Y(" 手动编辑 ",-1)])])):T("",!0),t("button",{onClick:o,disabled:n.generatingChapter===n.selectedChapterNumber,class:"px-4 py-2 bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg transition-colors disabled:opacity-50 flex items-center gap-2 whitespace-nowrap"},[n.generatingChapter===n.selectedChapterNumber?(c(),p("svg",Tc,[...C[12]||(C[12]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])):(c(),p("svg",Ac,[...C[13]||(C[13]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])),Y(" "+w(n.generatingChapter===n.selectedChapterNumber?"生成中...":"重新生成"),1)],8,Ec)])])])):T("",!0),t("div",Mc,[(c(),je(rn(R.value),wr(te.value,{onHideVersionSelector:C[0]||(C[0]=H=>E.$emit("hideVersionSelector")),"onUpdate:selectedVersionIndex":C[1]||(C[1]=H=>E.$emit("update:selectedVersionIndex",H)),onShowVersionDetail:C[2]||(C[2]=H=>E.$emit("showVersionDetail",H)),onConfirmVersionSelection:C[3]||(C[3]=H=>E.$emit("confirmVersionSelection")),onGenerateChapter:C[4]||(C[4]=H=>E.$emit("generateChapter",H)),onShowVersionSelector:C[5]||(C[5]=H=>E.$emit("showVersionSelector")),onRegenerateChapter:C[6]||(C[6]=H=>E.$emit("regenerateChapter")),onEvaluateChapter:C[7]||(C[7]=H=>E.$emit("evaluateChapter")),onShowEvaluationDetail:C[8]||(C[8]=H=>E.$emit("showEvaluationDetail")),onCancelEvaluation:C[9]||(C[9]=H=>E.$emit("cancelEvaluation"))}),null,16))])]),l.value?(c(),p("div",Lc,[t("div",jc,[t("div",Oc,[t("h3",zc," 编辑第"+w(n.selectedChapterNumber)+"章内容 ",1),t("button",{onClick:f,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...C[14]||(C[14]=[t("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])]),t("div",Rc,[t("div",Pc,[C[15]||(C[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," 章节内容 ",-1)),de(t("textarea",{"onUpdate:modelValue":C[10]||(C[10]=H=>i.value=H),class:"flex-1 w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-none",placeholder:"请输入章节内容...",disabled:a.value},null,8,Nc),[[ce,i.value]]),t("div",Vc," 字数统计: "+w(i.value.length),1)])]),t("div",Bc,[t("button",{onClick:f,disabled:a.value,class:"px-4 py-2 text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-lg transition-colors disabled:opacity-50"}," 取消 ",8,Ic),t("button",{onClick:g,disabled:a.value||!i.value.trim(),class:"px-4 py-2 bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg transition-colors disabled:opacity-50 flex items-center gap-2"},[a.value?(c(),p("svg",Hc,[...C[16]||(C[16]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])):T("",!0),Y(" "+w(a.value?"保存中...":"保存"),1)],8,Dc)])])])):T("",!0)]))}}),Fc={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},qc={class:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[80vh] overflow-hidden"},Wc={class:"flex items-center justify-between p-6 border-b border-gray-200"},Gc={class:"text-sm text-gray-600 mt-1"},Jc={class:"p-6 overflow-y-auto max-h-[60vh]"},Zc={class:"prose max-w-none"},Yc={class:"whitespace-pre-wrap text-gray-700 leading-relaxed"},Xc={class:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50"},Kc={class:"text-sm text-gray-500"},Qc={key:0,class:"inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-800 font-medium"},e0={key:1,class:"text-gray-400"},t0={class:"flex gap-3"},s0=W({__name:"WDVersionDetailModal",props:{show:{type:Boolean},detailVersionIndex:{},version:{},isCurrent:{type:Boolean}},emits:["close","selectVersion"],setup(n){const e=s=>{if(!s)return"";try{const o=JSON.parse(s);o&&typeof o=="object"&&o.content&&(s=o.content)}catch{}let r=s.replace(/^"|"$/g,"");return r=r.replace(/\\n/g,`
`),r=r.replace(/\\"/g,'"'),r=r.replace(/\\t/g,"	"),r=r.replace(/\\\\/g,"\\"),r};return(s,r)=>n.show?(c(),p("div",Fc,[t("div",qc,[t("div",Wc,[t("div",null,[r[5]||(r[5]=t("h3",{class:"text-xl font-bold text-gray-900"},"版本详情",-1)),t("p",Gc,[Y(" 版本 "+w(n.detailVersionIndex+1)+" ",1),r[3]||(r[3]=t("span",{class:"text-gray-400"},"•",-1)),Y(" "+w(n.version?.style||"标准")+"风格 ",1),r[4]||(r[4]=t("span",{class:"text-gray-400"},"•",-1)),Y(" 约 "+w(Math.round(e(n.version?.content||"").length/100)*100)+" 字 ",1)])]),t("button",{onClick:r[0]||(r[0]=o=>s.$emit("close")),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[...r[6]||(r[6]=[t("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])]),t("div",Jc,[t("div",Zc,[t("div",Yc,w(e(n.version?.content||"")),1)])]),t("div",Xc,[t("div",Kc,[n.isCurrent?(c(),p("span",Qc,[...r[7]||(r[7]=[t("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1),Y(" 当前选中版本 ",-1)])])):(c(),p("span",e0,"未选中版本"))]),t("div",t0,[t("button",{onClick:r[1]||(r[1]=o=>s.$emit("close")),class:"px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-200 rounded-lg transition-colors"}," 关闭 "),n.isCurrent?T("",!0):(c(),p("button",{key:0,onClick:r[2]||(r[2]=o=>s.$emit("selectVersion")),class:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," 选择此版本 "))])])])])):T("",!0)}}),n0={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},r0={class:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[80vh] overflow-hidden flex flex-col"},o0={class:"flex items-center justify-between p-6 border-b border-gray-200"},l0={class:"flex items-center gap-3"},a0={key:0,class:"text-xs text-gray-500 mt-0.5"},i0={class:"p-6 overflow-y-auto max-h-[calc(80vh-130px)]"},u0={key:0,class:"space-y-6 text-sm"},d0={class:"bg-purple-50 border border-purple-200 rounded-xl p-4"},c0={class:"font-semibold text-purple-800 text-base"},p0={class:"text-purple-700 mt-2"},f0={key:0,class:"space-y-4"},h0={class:"flex items-center justify-between mb-2"},g0={class:"flex items-center gap-3"},m0={class:"font-bold text-gray-800 text-lg"},v0={class:"flex items-center gap-2"},b0=["onClick"],x0=["onClick","disabled"],y0={key:0,class:"mb-3 p-3 bg-white border border-gray-200 rounded-lg max-h-60 overflow-y-auto"},w0={class:"whitespace-pre-wrap text-gray-700 text-sm leading-relaxed"},_0={class:"text-xs text-gray-500 mb-3"},k0={key:0},$0={key:1},C0={key:2},S0={class:"prose prose-sm max-w-none text-gray-700 space-y-3"},E0={class:"list-disc pl-5 space-y-1"},T0={class:"list-disc pl-5 space-y-1"},A0={class:"font-medium text-amber-700"},M0={key:0,class:"text-gray-500 text-xs block mt-0.5"},L0={key:1,class:"space-y-4"},j0={class:"flex items-center justify-between mb-2"},O0={class:"flex items-center gap-3"},z0={class:"font-bold text-gray-800 text-lg"},R0=["onClick","disabled"],P0={class:"text-xs text-gray-500 mb-3"},N0={key:0},V0={key:1},B0={key:2},I0={class:"prose prose-sm max-w-none text-gray-700 space-y-3"},D0={class:"list-disc pl-5 space-y-1"},H0={class:"list-disc pl-5 space-y-1"},U0={class:"font-medium text-amber-700"},F0={key:0,class:"text-gray-500 text-xs block mt-0.5"},q0=["innerHTML"],W0={class:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50"},G0={class:"flex items-center gap-2"},J0=["disabled"],Z0={key:0,class:"w-4 h-4 animate-spin",fill:"currentColor",viewBox:"0 0 20 20"},Y0=W({__name:"WDEvaluationDetailModal",props:{show:{type:Boolean},evaluation:{},versions:{default:null},rewriting:{type:Boolean,default:!1}},emits:["close","rewrite","rewrite-version"],setup(n){const e=n,s=S(new Set),r=y=>{s.value.has(y)?s.value.delete(y):s.value.add(y),s.value=new Set(s.value)},o=y=>!e.versions||y<1||y>e.versions.length?null:e.versions[y-1]?.content||null,l=y=>{const _=String(y).match(/\d+/);return _?parseInt(_[0],10):1},i=y=>{if(!e.versions||y<1||y>e.versions.length)return null;const x=e.versions[y-1];return x?.model||x?.provider||null},a=y=>!e.versions||y<1||y>e.versions.length?0:(e.versions[y-1]?.content||"").length,u=y=>y>=90?"bg-emerald-100 text-emerald-700":y>=80?"bg-blue-100 text-blue-700":y>=70?"bg-yellow-100 text-yellow-700":y>=60?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700",d=L(()=>{if(!e.evaluation)return null;try{let y=JSON.parse(e.evaluation);return typeof y=="string"&&(y=JSON.parse(y)),y}catch(y){return console.error("Failed to parse evaluation JSON:",y),null}}),f=L(()=>d.value&&d.value._evaluation_model||null),g=L(()=>{if(!d.value)return!1;if(d.value.versions&&Array.isArray(d.value.versions)){for(const y of d.value.versions)if(y.cons&&y.cons.length>0)return!0;return!1}if(d.value.evaluation){const y=d.value.evaluation;for(const x in y){const _=y[x];if(_.cons&&_.cons.length>0)return!0}}return!1}),m=y=>{if(!y)return"";let x=y.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\");return x=x.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),x=x.replace(/(?<!\*)\*([^*]+)\*(?!\*)/g,"<em>$1</em>"),x=x.replace(/^([A-Z])\)\s*\*\*(.*?)\*\*(.*)/gm,'<div class="mb-2"><span class="inline-flex items-center justify-center w-6 h-6 bg-indigo-100 text-indigo-600 text-sm font-bold rounded-full mr-2">$1</span><strong>$2</strong>$3</div>'),x=x.replace(/\n/g,"<br>"),x=x.replace(/(<br\s*\/?>\s*){2,}/g,'</p><p class="mt-2">'),x.includes("<p>")||(x=`<p>${x}</p>`),Rt.sanitize(x)};return(y,x)=>n.show?(c(),p("div",n0,[t("div",r0,[t("div",o0,[t("div",l0,[x[4]||(x[4]=t("div",{class:"w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0"},[t("svg",{class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15v1a1 1 0 001 1h12a1 1 0 001-1v-1a1 1 0 00-.293-.707L16 11.586V8a6 6 0 00-6-6zM8.05 17a2 2 0 103.9 0H8.05z"})])],-1)),t("div",null,[x[3]||(x[3]=t("h3",{class:"text-xl font-bold text-gray-900"},"AI 评审详情",-1)),f.value?(c(),p("p",a0," 评审模型: "+w(f.value),1)):T("",!0)])]),t("button",{onClick:x[0]||(x[0]=_=>y.$emit("close")),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[...x[5]||(x[5]=[t("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])]),t("div",i0,[d.value?(c(),p("div",u0,[t("div",d0,[t("p",c0,"🏆 最佳选择：版本 "+w(d.value.best_choice),1),t("p",p0,w(d.value.reason_for_choice),1)]),d.value.versions&&Array.isArray(d.value.versions)?(c(),p("div",f0,[(c(!0),p(re,null,ge(d.value.versions,_=>(c(),p("div",{key:_.version_index,class:"bg-gray-50 p-4 rounded-lg border border-gray-200"},[t("div",h0,[t("div",g0,[t("h5",m0,"版本 "+w(_.version_index)+" 评估",1),t("span",{class:Q(["px-3 py-1 rounded-full text-sm font-semibold",u(_.score)])},w(_.score)+" 分 ",3)]),t("div",v0,[o(_.version_index)?(c(),p("button",{key:0,onClick:k=>r(_.version_index),class:"px-3 py-1 text-xs bg-gray-100 text-gray-600 rounded-full hover:bg-gray-200 transition-colors"},w(s.value.has(_.version_index)?"收起内容":"查看内容"),9,b0)):T("",!0),_.cons&&_.cons.length>0?(c(),p("button",{key:1,onClick:k=>y.$emit("rewrite-version",_.version_index),disabled:n.rewriting,class:"px-3 py-1 text-xs bg-amber-100 text-amber-700 rounded-full hover:bg-amber-200 transition-colors disabled:opacity-50"}," 重写此版本 ",8,x0)):T("",!0)])]),s.value.has(_.version_index)&&o(_.version_index)?(c(),p("div",y0,[x[6]||(x[6]=t("p",{class:"text-xs text-gray-500 mb-2"},"生成内容:",-1)),t("div",w0,w(o(_.version_index)),1)])):T("",!0),t("p",_0,[i(_.version_index)?(c(),p("span",k0," 生成模型: "+w(i(_.version_index)),1)):T("",!0),i(_.version_index)&&a(_.version_index)?(c(),p("span",$0," · ")):T("",!0),a(_.version_index)?(c(),p("span",C0," 字数: "+w(a(_.version_index).toLocaleString()),1)):T("",!0)]),t("div",S0,[t("div",null,[x[7]||(x[7]=t("p",{class:"font-semibold text-gray-800"},"综合评价:",-1)),t("p",null,w(_.overall_review),1)]),t("div",null,[x[8]||(x[8]=t("p",{class:"font-semibold text-gray-800"},"优点:",-1)),t("ul",E0,[(c(!0),p(re,null,ge(_.pros,(k,O)=>(c(),p("li",{key:`pro-${O}`},w(k),1))),128))])]),t("div",null,[x[9]||(x[9]=t("p",{class:"font-semibold text-gray-800"},"缺点:",-1)),t("ul",T0,[(c(!0),p(re,null,ge(_.cons,(k,O)=>(c(),p("li",{key:`con-${O}`},[typeof k=="object"&&k!==null?(c(),p(re,{key:0},[t("span",A0,"["+w(k.location)+"]",1),Y(" "+w(k.issue)+" ",1),k.suggestion?(c(),p("span",M0,"→ "+w(k.suggestion),1)):T("",!0)],64)):(c(),p(re,{key:1},[Y(w(k),1)],64))]))),128))])])])]))),128))])):d.value.evaluation?(c(),p("div",L0,[(c(!0),p(re,null,ge(d.value.evaluation,(_,k)=>(c(),p("div",{key:k,class:"bg-gray-50 p-4 rounded-lg border border-gray-200"},[t("div",j0,[t("div",O0,[t("h5",z0,"版本 "+w(String(k).replace("version",""))+" 评估",1),_.score!==void 0?(c(),p("span",{key:0,class:Q(["px-3 py-1 rounded-full text-sm font-semibold",u(_.score)])},w(_.score)+" 分 ",3)):T("",!0)]),_.cons&&_.cons.length>0?(c(),p("button",{key:0,onClick:O=>y.$emit("rewrite-version",l(k)),disabled:n.rewriting,class:"px-3 py-1 text-xs bg-amber-100 text-amber-700 rounded-full hover:bg-amber-200 transition-colors disabled:opacity-50"}," 重写此版本 ",8,R0)):T("",!0)]),t("p",P0,[i(l(k))?(c(),p("span",N0," 生成模型: "+w(i(l(k))),1)):T("",!0),i(l(k))&&a(l(k))?(c(),p("span",V0," · ")):T("",!0),a(l(k))?(c(),p("span",B0," 字数: "+w(a(l(k)).toLocaleString()),1)):T("",!0)]),t("div",I0,[t("div",null,[x[10]||(x[10]=t("p",{class:"font-semibold text-gray-800"},"综合评价:",-1)),t("p",null,w(_.overall_review),1)]),t("div",null,[x[11]||(x[11]=t("p",{class:"font-semibold text-gray-800"},"优点:",-1)),t("ul",D0,[(c(!0),p(re,null,ge(_.pros,(O,R)=>(c(),p("li",{key:`pro-${R}`},w(O),1))),128))])]),t("div",null,[x[12]||(x[12]=t("p",{class:"font-semibold text-gray-800"},"缺点:",-1)),t("ul",H0,[(c(!0),p(re,null,ge(_.cons,(O,R)=>(c(),p("li",{key:`con-${R}`},[typeof O=="object"&&O!==null?(c(),p(re,{key:0},[t("span",U0,"["+w(O.location)+"]",1),Y(" "+w(O.issue)+" ",1),O.suggestion?(c(),p("span",F0,"→ "+w(O.suggestion),1)):T("",!0)],64)):(c(),p(re,{key:1},[Y(w(O),1)],64))]))),128))])])])]))),128))])):T("",!0)])):(c(),p("div",{key:1,class:"prose prose-sm max-w-none prose-headings:mt-2 prose-headings:mb-1 prose-p:my-1 prose-ul:my-1 prose-ol:my-1 prose-li:my-0 text-gray-800",innerHTML:m(n.evaluation)},null,8,q0))]),t("div",W0,[t("div",G0,[d.value&&g.value?(c(),p("button",{key:0,onClick:x[1]||(x[1]=_=>y.$emit("rewrite")),disabled:n.rewriting,class:"px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 text-sm"},[n.rewriting?(c(),p("svg",Z0,[...x[13]||(x[13]=[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"},null,-1)])])):T("",!0),Y(" "+w(n.rewriting?"重写中...":"全部重写"),1)],8,J0)):T("",!0)]),t("button",{onClick:x[2]||(x[2]=_=>y.$emit("close")),class:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," 关闭 ")])])])):T("",!0)}}),X0={class:"flex justify-between items-center mb-6"},K0={key:0,class:"space-y-6"},Q0={class:"mt-8 flex justify-end gap-4"},e1=["disabled"],t1=W({__name:"WDEditChapterModal",props:{show:{type:Boolean},chapter:{}},emits:["close","save"],setup(n,{emit:e}){const s=n,r=e,o=S(null);Se(()=>s.chapter,a=>{a?o.value={...a}:o.value=null},{deep:!0,immediate:!0});const l=L(()=>!s.chapter||!o.value?!1:s.chapter.title!==o.value.title||s.chapter.summary!==o.value.summary),i=()=>{o.value&&l.value&&r("save",o.value)};return(a,u)=>n.show?(c(),p("div",{key:0,class:"fixed inset-0 bg-black/30 z-50 flex justify-center items-center",onClick:u[4]||(u[4]=Ne(d=>a.$emit("close"),["self"]))},[t("div",{class:Q(["bg-white rounded-2xl shadow-xl w-full max-w-lg mx-4 p-8 transform transition-all duration-300 ease-out",n.show?"scale-100 opacity-100":"scale-95 opacity-0"])},[t("div",X0,[u[6]||(u[6]=t("h2",{class:"text-2xl font-bold text-gray-800"},"编辑章节大纲",-1)),t("button",{onClick:u[0]||(u[0]=d=>a.$emit("close")),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors"},[...u[5]||(u[5]=[t("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])]),o.value?(c(),p("div",K0,[t("div",null,[u[7]||(u[7]=t("label",{for:"chapter-title",class:"block text-sm font-medium text-gray-700 mb-2"},"章节标题",-1)),de(t("input",{type:"text",id:"chapter-title","onUpdate:modelValue":u[1]||(u[1]=d=>o.value.title=d),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"请输入章节标题"},null,512),[[ce,o.value.title]])]),t("div",null,[u[8]||(u[8]=t("label",{for:"chapter-summary",class:"block text-sm font-medium text-gray-700 mb-2"},"章节摘要",-1)),de(t("textarea",{id:"chapter-summary","onUpdate:modelValue":u[2]||(u[2]=d=>o.value.summary=d),rows:"5",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"请输入章节摘要"},null,512),[[ce,o.value.summary]])])])):T("",!0),t("div",Q0,[t("button",{onClick:u[3]||(u[3]=d=>a.$emit("close")),class:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"}," 取消 "),t("button",{onClick:i,class:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50",disabled:!l.value}," 保存更改 ",8,e1)])],2)])):T("",!0)}});function On(n){typeof queueMicrotask=="function"?queueMicrotask(n):Promise.resolve().then(n).catch(e=>setTimeout(()=>{throw e}))}function hs(){let n=[],e={addEventListener(s,r,o,l){return s.addEventListener(r,o,l),e.add(()=>s.removeEventListener(r,o,l))},requestAnimationFrame(...s){let r=requestAnimationFrame(...s);e.add(()=>cancelAnimationFrame(r))},nextFrame(...s){e.requestAnimationFrame(()=>{e.requestAnimationFrame(...s)})},setTimeout(...s){let r=setTimeout(...s);e.add(()=>clearTimeout(r))},microTask(...s){let r={current:!0};return On(()=>{r.current&&s[0]()}),e.add(()=>{r.current=!1})},style(s,r,o){let l=s.style.getPropertyValue(r);return Object.assign(s.style,{[r]:o}),this.add(()=>{Object.assign(s.style,{[r]:l})})},group(s){let r=hs();return s(r),this.add(()=>r.dispose())},add(s){return n.push(s),()=>{let r=n.indexOf(s);if(r>=0)for(let o of n.splice(r,1))o()}},dispose(){for(let s of n.splice(0))s()}};return e}var hr;let s1=Symbol("headlessui.useid"),n1=0;const Vs=(hr=ho)!=null?hr:function(){return nt(s1,()=>`${++n1}`)()};function Oe(n){var e;if(n==null||n.value==null)return null;let s=(e=n.value.$el)!=null?e:n.value;return s instanceof Node?s:null}function bt(n,e,...s){if(n in e){let o=e[n];return typeof o=="function"?o(...s):o}let r=new Error(`Tried to handle "${n}" but there is no handler defined. Only defined handlers are: ${Object.keys(e).map(o=>`"${o}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,bt),r}var r1=Object.defineProperty,o1=(n,e,s)=>e in n?r1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s,gr=(n,e,s)=>(o1(n,typeof e!="symbol"?e+"":e,s),s);let l1=class{constructor(){gr(this,"current",this.detect()),gr(this,"currentId",0)}set(e){this.current!==e&&(this.currentId=0,this.current=e)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return this.current==="server"}get isClient(){return this.current==="client"}detect(){return typeof window>"u"||typeof document>"u"?"server":"client"}},gs=new l1;function Ft(n){if(gs.isServer)return null;if(n instanceof Node)return n.ownerDocument;if(n!=null&&n.hasOwnProperty("value")){let e=Oe(n);if(e)return e.ownerDocument}return document}let fn=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(n=>`${n}:not([tabindex='-1'])`).join(",");var Ct=(n=>(n[n.First=1]="First",n[n.Previous=2]="Previous",n[n.Next=4]="Next",n[n.Last=8]="Last",n[n.WrapAround=16]="WrapAround",n[n.NoScroll=32]="NoScroll",n))(Ct||{}),Br=(n=>(n[n.Error=0]="Error",n[n.Overflow=1]="Overflow",n[n.Success=2]="Success",n[n.Underflow=3]="Underflow",n))(Br||{}),a1=(n=>(n[n.Previous=-1]="Previous",n[n.Next=1]="Next",n))(a1||{});function i1(n=document.body){return n==null?[]:Array.from(n.querySelectorAll(fn)).sort((e,s)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(s.tabIndex||Number.MAX_SAFE_INTEGER)))}var Ir=(n=>(n[n.Strict=0]="Strict",n[n.Loose=1]="Loose",n))(Ir||{});function u1(n,e=0){var s;return n===((s=Ft(n))==null?void 0:s.body)?!1:bt(e,{0(){return n.matches(fn)},1(){let r=n;for(;r!==null;){if(r.matches(fn))return!0;r=r.parentElement}return!1}})}var d1=(n=>(n[n.Keyboard=0]="Keyboard",n[n.Mouse=1]="Mouse",n))(d1||{});typeof window<"u"&&typeof document<"u"&&(document.addEventListener("keydown",n=>{n.metaKey||n.altKey||n.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",n=>{n.detail===1?delete document.documentElement.dataset.headlessuiFocusVisible:n.detail===0&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));function Ot(n){n?.focus({preventScroll:!0})}let c1=["textarea","input"].join(",");function p1(n){var e,s;return(s=(e=n?.matches)==null?void 0:e.call(n,c1))!=null?s:!1}function f1(n,e=s=>s){return n.slice().sort((s,r)=>{let o=e(s),l=e(r);if(o===null||l===null)return 0;let i=o.compareDocumentPosition(l);return i&Node.DOCUMENT_POSITION_FOLLOWING?-1:i&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function As(n,e,{sorted:s=!0,relativeTo:r=null,skipElements:o=[]}={}){var l;let i=(l=Array.isArray(n)?n.length>0?n[0].ownerDocument:document:n?.ownerDocument)!=null?l:document,a=Array.isArray(n)?s?f1(n):n:i1(n);o.length>0&&a.length>1&&(a=a.filter(x=>!o.includes(x))),r=r??i.activeElement;let u=(()=>{if(e&5)return 1;if(e&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),d=(()=>{if(e&1)return 0;if(e&2)return Math.max(0,a.indexOf(r))-1;if(e&4)return Math.max(0,a.indexOf(r))+1;if(e&8)return a.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),f=e&32?{preventScroll:!0}:{},g=0,m=a.length,y;do{if(g>=m||g+m<=0)return 0;let x=d+g;if(e&16)x=(x+m)%m;else{if(x<0)return 3;if(x>=m)return 1}y=a[x],y?.focus(f),g+=u}while(y!==i.activeElement);return e&6&&p1(y)&&y.select(),2}function Dr(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function h1(){return/Android/gi.test(window.navigator.userAgent)}function g1(){return Dr()||h1()}function $s(n,e,s){gs.isServer||dt(r=>{document.addEventListener(n,e,s),r(()=>document.removeEventListener(n,e,s))})}function Hr(n,e,s){gs.isServer||dt(r=>{window.addEventListener(n,e,s),r(()=>window.removeEventListener(n,e,s))})}function m1(n,e,s=L(()=>!0)){function r(l,i){if(!s.value||l.defaultPrevented)return;let a=i(l);if(a===null||!a.getRootNode().contains(a))return;let u=(function d(f){return typeof f=="function"?d(f()):Array.isArray(f)||f instanceof Set?f:[f]})(n);for(let d of u){if(d===null)continue;let f=d instanceof HTMLElement?d:Oe(d);if(f!=null&&f.contains(a)||l.composed&&l.composedPath().includes(f))return}return!u1(a,Ir.Loose)&&a.tabIndex!==-1&&l.preventDefault(),e(l,a)}let o=S(null);$s("pointerdown",l=>{var i,a;s.value&&(o.value=((a=(i=l.composedPath)==null?void 0:i.call(l))==null?void 0:a[0])||l.target)},!0),$s("mousedown",l=>{var i,a;s.value&&(o.value=((a=(i=l.composedPath)==null?void 0:i.call(l))==null?void 0:a[0])||l.target)},!0),$s("click",l=>{g1()||o.value&&(r(l,()=>o.value),o.value=null)},!0),$s("touchend",l=>r(l,()=>l.target instanceof HTMLElement?l.target:null),!0),Hr("blur",l=>r(l,()=>window.document.activeElement instanceof HTMLIFrameElement?window.document.activeElement:null),!0)}var Os=(n=>(n[n.None=0]="None",n[n.RenderStrategy=1]="RenderStrategy",n[n.Static=2]="Static",n))(Os||{}),St=(n=>(n[n.Unmount=0]="Unmount",n[n.Hidden=1]="Hidden",n))(St||{});function xt({visible:n=!0,features:e=0,ourProps:s,theirProps:r,...o}){var l;let i=Fr(r,s),a=Object.assign(o,{props:i});if(n||e&2&&i.static)return en(a);if(e&1){let u=(l=i.unmount)==null||l?0:1;return bt(u,{0(){return null},1(){return en({...o,props:{...i,hidden:!0,style:{display:"none"}}})}})}return en(a)}function en({props:n,attrs:e,slots:s,slot:r,name:o}){var l,i;let{as:a,...u}=qr(n,["unmount","static"]),d=(l=s.default)==null?void 0:l.call(s,r),f={};if(r){let g=!1,m=[];for(let[y,x]of Object.entries(r))typeof x=="boolean"&&(g=!0),x===!0&&m.push(y);g&&(f["data-headlessui-state"]=m.join(" "))}if(a==="template"){if(d=Ur(d??[]),Object.keys(u).length>0||Object.keys(e).length>0){let[g,...m]=d??[];if(!v1(g)||m.length>0)throw new Error(['Passing props on "template"!',"",`The current component <${o} /> is rendering a "template".`,"However we need to passthrough the following props:",Object.keys(u).concat(Object.keys(e)).map(_=>_.trim()).filter((_,k,O)=>O.indexOf(_)===k).sort((_,k)=>_.localeCompare(k)).map(_=>`  - ${_}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "template".',"Render a single element as the child so that we can forward the props onto that element."].map(_=>`  - ${_}`).join(`
`)].join(`
`));let y=Fr((i=g.props)!=null?i:{},u,f),x=go(g,y,!0);for(let _ in y)_.startsWith("on")&&(x.props||(x.props={}),x.props[_]=y[_]);return x}return Array.isArray(d)&&d.length===1?d[0]:d}return ne(a,Object.assign({},u,f),{default:()=>d})}function Ur(n){return n.flatMap(e=>e.type===re?Ur(e.children):[e])}function Fr(...n){if(n.length===0)return{};if(n.length===1)return n[0];let e={},s={};for(let r of n)for(let o in r)o.startsWith("on")&&typeof r[o]=="function"?(s[o]!=null||(s[o]=[]),s[o].push(r[o])):e[o]=r[o];if(e.disabled||e["aria-disabled"])return Object.assign(e,Object.fromEntries(Object.keys(s).map(r=>[r,void 0])));for(let r in s)Object.assign(e,{[r](o,...l){let i=s[r];for(let a of i){if(o instanceof Event&&o.defaultPrevented)return;a(o,...l)}}});return e}function qr(n,e=[]){let s=Object.assign({},n);for(let r of e)r in s&&delete s[r];return s}function v1(n){return n==null?!1:typeof n.type=="string"||typeof n.type=="object"||typeof n.type=="function"}var zs=(n=>(n[n.None=1]="None",n[n.Focusable=2]="Focusable",n[n.Hidden=4]="Hidden",n))(zs||{});let hn=W({name:"Hidden",props:{as:{type:[Object,String],default:"div"},features:{type:Number,default:1}},setup(n,{slots:e,attrs:s}){return()=>{var r;let{features:o,...l}=n,i={"aria-hidden":(o&2)===2?!0:(r=l["aria-hidden"])!=null?r:void 0,hidden:(o&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(o&4)===4&&(o&2)!==2&&{display:"none"}}};return xt({ourProps:i,theirProps:l,slot:{},attrs:s,slots:e,name:"Hidden"})}}}),Wr=Symbol("Context");var Je=(n=>(n[n.Open=1]="Open",n[n.Closed=2]="Closed",n[n.Closing=4]="Closing",n[n.Opening=8]="Opening",n))(Je||{});function b1(){return zn()!==null}function zn(){return nt(Wr,null)}function x1(n){vt(Wr,n)}var Gr=(n=>(n.Space=" ",n.Enter="Enter",n.Escape="Escape",n.Backspace="Backspace",n.Delete="Delete",n.ArrowLeft="ArrowLeft",n.ArrowUp="ArrowUp",n.ArrowRight="ArrowRight",n.ArrowDown="ArrowDown",n.Home="Home",n.End="End",n.PageUp="PageUp",n.PageDown="PageDown",n.Tab="Tab",n))(Gr||{});function y1(n){function e(){document.readyState!=="loading"&&(n(),document.removeEventListener("DOMContentLoaded",e))}typeof window<"u"&&typeof document<"u"&&(document.addEventListener("DOMContentLoaded",e),e())}let Lt=[];y1(()=>{function n(e){e.target instanceof HTMLElement&&e.target!==document.body&&Lt[0]!==e.target&&(Lt.unshift(e.target),Lt=Lt.filter(s=>s!=null&&s.isConnected),Lt.splice(10))}window.addEventListener("click",n,{capture:!0}),window.addEventListener("mousedown",n,{capture:!0}),window.addEventListener("focus",n,{capture:!0}),document.body.addEventListener("click",n,{capture:!0}),document.body.addEventListener("mousedown",n,{capture:!0}),document.body.addEventListener("focus",n,{capture:!0})});function Jr(n,e,s,r){gs.isServer||dt(o=>{n=n??window,n.addEventListener(e,s,r),o(()=>n.removeEventListener(e,s,r))})}var is=(n=>(n[n.Forwards=0]="Forwards",n[n.Backwards=1]="Backwards",n))(is||{});function w1(){let n=S(0);return Hr("keydown",e=>{e.key==="Tab"&&(n.value=e.shiftKey?1:0)}),n}function Zr(n){if(!n)return new Set;if(typeof n=="function")return new Set(n());let e=new Set;for(let s of n.value){let r=Oe(s);r instanceof HTMLElement&&e.add(r)}return e}var Yr=(n=>(n[n.None=1]="None",n[n.InitialFocus=2]="InitialFocus",n[n.TabLock=4]="TabLock",n[n.FocusLock=8]="FocusLock",n[n.RestoreFocus=16]="RestoreFocus",n[n.All=30]="All",n))(Yr||{});let rs=Object.assign(W({name:"FocusTrap",props:{as:{type:[Object,String],default:"div"},initialFocus:{type:Object,default:null},features:{type:Number,default:30},containers:{type:[Object,Function],default:S(new Set)}},inheritAttrs:!1,setup(n,{attrs:e,slots:s,expose:r}){let o=S(null);r({el:o,$el:o});let l=L(()=>Ft(o)),i=S(!1);Ee(()=>i.value=!0),st(()=>i.value=!1),k1({ownerDocument:l},L(()=>i.value&&!!(n.features&16)));let a=$1({ownerDocument:l,container:o,initialFocus:L(()=>n.initialFocus)},L(()=>i.value&&!!(n.features&2)));C1({ownerDocument:l,container:o,containers:n.containers,previousActiveElement:a},L(()=>i.value&&!!(n.features&8)));let u=w1();function d(y){let x=Oe(o);x&&(_=>_())(()=>{bt(u.value,{[is.Forwards]:()=>{As(x,Ct.First,{skipElements:[y.relatedTarget]})},[is.Backwards]:()=>{As(x,Ct.Last,{skipElements:[y.relatedTarget]})}})})}let f=S(!1);function g(y){y.key==="Tab"&&(f.value=!0,requestAnimationFrame(()=>{f.value=!1}))}function m(y){if(!i.value)return;let x=Zr(n.containers);Oe(o)instanceof HTMLElement&&x.add(Oe(o));let _=y.relatedTarget;_ instanceof HTMLElement&&_.dataset.headlessuiFocusGuard!=="true"&&(Xr(x,_)||(f.value?As(Oe(o),bt(u.value,{[is.Forwards]:()=>Ct.Next,[is.Backwards]:()=>Ct.Previous})|Ct.WrapAround,{relativeTo:y.target}):y.target instanceof HTMLElement&&Ot(y.target)))}return()=>{let y={},x={ref:o,onKeydown:g,onFocusout:m},{features:_,initialFocus:k,containers:O,...R}=n;return ne(re,[!!(_&4)&&ne(hn,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:d,features:zs.Focusable}),xt({ourProps:x,theirProps:{...e,...R},slot:y,attrs:e,slots:s,name:"FocusTrap"}),!!(_&4)&&ne(hn,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:d,features:zs.Focusable})])}}}),{features:Yr});function _1(n){let e=S(Lt.slice());return Se([n],([s],[r])=>{r===!0&&s===!1?On(()=>{e.value.splice(0)}):r===!1&&s===!0&&(e.value=Lt.slice())},{flush:"post"}),()=>{var s;return(s=e.value.find(r=>r!=null&&r.isConnected))!=null?s:null}}function k1({ownerDocument:n},e){let s=_1(e);Ee(()=>{dt(()=>{var r,o;e.value||((r=n.value)==null?void 0:r.activeElement)===((o=n.value)==null?void 0:o.body)&&Ot(s())},{flush:"post"})}),st(()=>{e.value&&Ot(s())})}function $1({ownerDocument:n,container:e,initialFocus:s},r){let o=S(null),l=S(!1);return Ee(()=>l.value=!0),st(()=>l.value=!1),Ee(()=>{Se([e,s,r],(i,a)=>{if(i.every((d,f)=>a?.[f]===d)||!r.value)return;let u=Oe(e);u&&On(()=>{var d,f;if(!l.value)return;let g=Oe(s),m=(d=n.value)==null?void 0:d.activeElement;if(g){if(g===m){o.value=m;return}}else if(u.contains(m)){o.value=m;return}g?Ot(g):As(u,Ct.First|Ct.NoScroll)===Br.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),o.value=(f=n.value)==null?void 0:f.activeElement})},{immediate:!0,flush:"post"})}),o}function C1({ownerDocument:n,container:e,containers:s,previousActiveElement:r},o){var l;Jr((l=n.value)==null?void 0:l.defaultView,"focus",i=>{if(!o.value)return;let a=Zr(s);Oe(e)instanceof HTMLElement&&a.add(Oe(e));let u=r.value;if(!u)return;let d=i.target;d&&d instanceof HTMLElement?Xr(a,d)?(r.value=d,Ot(d)):(i.preventDefault(),i.stopPropagation(),Ot(u)):Ot(r.value)},!0)}function Xr(n,e){for(let s of n)if(s.contains(e))return!0;return!1}function S1(n){let e=mo(n.getSnapshot());return st(n.subscribe(()=>{e.value=n.getSnapshot()})),e}function E1(n,e){let s=n(),r=new Set;return{getSnapshot(){return s},subscribe(o){return r.add(o),()=>r.delete(o)},dispatch(o,...l){let i=e[o].call(s,...l);i&&(s=i,r.forEach(a=>a()))}}}function T1(){let n;return{before({doc:e}){var s;let r=e.documentElement;n=((s=e.defaultView)!=null?s:window).innerWidth-r.clientWidth},after({doc:e,d:s}){let r=e.documentElement,o=r.clientWidth-r.offsetWidth,l=n-o;s.style(r,"paddingRight",`${l}px`)}}}function A1(){return Dr()?{before({doc:n,d:e,meta:s}){function r(o){return s.containers.flatMap(l=>l()).some(l=>l.contains(o))}e.microTask(()=>{var o;if(window.getComputedStyle(n.documentElement).scrollBehavior!=="auto"){let a=hs();a.style(n.documentElement,"scrollBehavior","auto"),e.add(()=>e.microTask(()=>a.dispose()))}let l=(o=window.scrollY)!=null?o:window.pageYOffset,i=null;e.addEventListener(n,"click",a=>{if(a.target instanceof HTMLElement)try{let u=a.target.closest("a");if(!u)return;let{hash:d}=new URL(u.href),f=n.querySelector(d);f&&!r(f)&&(i=f)}catch{}},!0),e.addEventListener(n,"touchstart",a=>{if(a.target instanceof HTMLElement)if(r(a.target)){let u=a.target;for(;u.parentElement&&r(u.parentElement);)u=u.parentElement;e.style(u,"overscrollBehavior","contain")}else e.style(a.target,"touchAction","none")}),e.addEventListener(n,"touchmove",a=>{if(a.target instanceof HTMLElement){if(a.target.tagName==="INPUT")return;if(r(a.target)){let u=a.target;for(;u.parentElement&&u.dataset.headlessuiPortal!==""&&!(u.scrollHeight>u.clientHeight||u.scrollWidth>u.clientWidth);)u=u.parentElement;u.dataset.headlessuiPortal===""&&a.preventDefault()}else a.preventDefault()}},{passive:!1}),e.add(()=>{var a;let u=(a=window.scrollY)!=null?a:window.pageYOffset;l!==u&&window.scrollTo(0,l),i&&i.isConnected&&(i.scrollIntoView({block:"nearest"}),i=null)})})}}:{}}function M1(){return{before({doc:n,d:e}){e.style(n.documentElement,"overflow","hidden")}}}function L1(n){let e={};for(let s of n)Object.assign(e,s(e));return e}let jt=E1(()=>new Map,{PUSH(n,e){var s;let r=(s=this.get(n))!=null?s:{doc:n,count:0,d:hs(),meta:new Set};return r.count++,r.meta.add(e),this.set(n,r),this},POP(n,e){let s=this.get(n);return s&&(s.count--,s.meta.delete(e)),this},SCROLL_PREVENT({doc:n,d:e,meta:s}){let r={doc:n,d:e,meta:L1(s)},o=[A1(),T1(),M1()];o.forEach(({before:l})=>l?.(r)),o.forEach(({after:l})=>l?.(r))},SCROLL_ALLOW({d:n}){n.dispose()},TEARDOWN({doc:n}){this.delete(n)}});jt.subscribe(()=>{let n=jt.getSnapshot(),e=new Map;for(let[s]of n)e.set(s,s.documentElement.style.overflow);for(let s of n.values()){let r=e.get(s.doc)==="hidden",o=s.count!==0;(o&&!r||!o&&r)&&jt.dispatch(s.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",s),s.count===0&&jt.dispatch("TEARDOWN",s)}});function j1(n,e,s){let r=S1(jt),o=L(()=>{let l=n.value?r.value.get(n.value):void 0;return l?l.count>0:!1});return Se([n,e],([l,i],[a],u)=>{if(!l||!i)return;jt.dispatch("PUSH",l,s);let d=!1;u(()=>{d||(jt.dispatch("POP",a??l,s),d=!0)})},{immediate:!0}),o}let tn=new Map,os=new Map;function mr(n,e=S(!0)){dt(s=>{var r;if(!e.value)return;let o=Oe(n);if(!o)return;s(function(){var i;if(!o)return;let a=(i=os.get(o))!=null?i:1;if(a===1?os.delete(o):os.set(o,a-1),a!==1)return;let u=tn.get(o);u&&(u["aria-hidden"]===null?o.removeAttribute("aria-hidden"):o.setAttribute("aria-hidden",u["aria-hidden"]),o.inert=u.inert,tn.delete(o))});let l=(r=os.get(o))!=null?r:0;os.set(o,l+1),l===0&&(tn.set(o,{"aria-hidden":o.getAttribute("aria-hidden"),inert:o.inert}),o.setAttribute("aria-hidden","true"),o.inert=!0)})}function O1({defaultContainers:n=[],portals:e,mainTreeNodeRef:s}={}){let r=S(null),o=Ft(r);function l(){var i,a,u;let d=[];for(let f of n)f!==null&&(f instanceof HTMLElement?d.push(f):"value"in f&&f.value instanceof HTMLElement&&d.push(f.value));if(e!=null&&e.value)for(let f of e.value)d.push(f);for(let f of(i=o?.querySelectorAll("html > *, body > *"))!=null?i:[])f!==document.body&&f!==document.head&&f instanceof HTMLElement&&f.id!=="headlessui-portal-root"&&(f.contains(Oe(r))||f.contains((u=(a=Oe(r))==null?void 0:a.getRootNode())==null?void 0:u.host)||d.some(g=>f.contains(g))||d.push(f));return d}return{resolveContainers:l,contains(i){return l().some(a=>a.contains(i))},mainTreeNodeRef:r,MainTreeNode(){return s!=null?null:ne(hn,{features:zs.Hidden,ref:r})}}}let Kr=Symbol("ForcePortalRootContext");function z1(){return nt(Kr,!1)}let vr=W({name:"ForcePortalRoot",props:{as:{type:[Object,String],default:"template"},force:{type:Boolean,default:!1}},setup(n,{slots:e,attrs:s}){return vt(Kr,n.force),()=>{let{force:r,...o}=n;return xt({theirProps:o,ourProps:{},slot:{},slots:e,attrs:s,name:"ForcePortalRoot"})}}}),Qr=Symbol("StackContext");var gn=(n=>(n[n.Add=0]="Add",n[n.Remove=1]="Remove",n))(gn||{});function R1(){return nt(Qr,()=>{})}function P1({type:n,enabled:e,element:s,onUpdate:r}){let o=R1();function l(...i){r?.(...i),o(...i)}Ee(()=>{Se(e,(i,a)=>{i?l(0,n,s):a===!0&&l(1,n,s)},{immediate:!0,flush:"sync"})}),st(()=>{e.value&&l(1,n,s)}),vt(Qr,l)}let N1=Symbol("DescriptionContext");function V1({slot:n=S({}),name:e="Description",props:s={}}={}){let r=S([]);function o(l){return r.value.push(l),()=>{let i=r.value.indexOf(l);i!==-1&&r.value.splice(i,1)}}return vt(N1,{register:o,slot:n,name:e,props:s}),L(()=>r.value.length>0?r.value.join(" "):void 0)}function B1(n){let e=Ft(n);if(!e){if(n===null)return null;throw new Error(`[Headless UI]: Cannot find ownerDocument for contextElement: ${n}`)}let s=e.getElementById("headlessui-portal-root");if(s)return s;let r=e.createElement("div");return r.setAttribute("id","headlessui-portal-root"),e.body.appendChild(r)}const mn=new WeakMap;function I1(n){var e;return(e=mn.get(n))!=null?e:0}function br(n,e){let s=e(I1(n));return s<=0?mn.delete(n):mn.set(n,s),s}let D1=W({name:"Portal",props:{as:{type:[Object,String],default:"div"}},setup(n,{slots:e,attrs:s}){let r=S(null),o=L(()=>Ft(r)),l=z1(),i=nt(eo,null),a=S(l===!0||i==null?B1(r.value):i.resolveTarget());a.value&&br(a.value,m=>m+1);let u=S(!1);Ee(()=>{u.value=!0}),dt(()=>{l||i!=null&&(a.value=i.resolveTarget())});let d=nt(vn,null),f=!1,g=vo();return Se(r,()=>{if(f||!d)return;let m=Oe(r);m&&(st(d.register(m),g),f=!0)}),st(()=>{var m,y;let x=(m=o.value)==null?void 0:m.getElementById("headlessui-portal-root");!x||a.value!==x||br(a.value,_=>_-1)||a.value.children.length>0||(y=a.value.parentElement)==null||y.removeChild(a.value)}),()=>{if(!u.value||a.value===null)return null;let m={ref:r,"data-headlessui-portal":""};return ne(wn,{to:a.value},xt({ourProps:m,theirProps:n,slot:{},attrs:s,slots:e,name:"Portal"}))}}}),vn=Symbol("PortalParentContext");function H1(){let n=nt(vn,null),e=S([]);function s(l){return e.value.push(l),n&&n.register(l),()=>r(l)}function r(l){let i=e.value.indexOf(l);i!==-1&&e.value.splice(i,1),n&&n.unregister(l)}let o={register:s,unregister:r,portals:e};return[e,W({name:"PortalWrapper",setup(l,{slots:i}){return vt(vn,o),()=>{var a;return(a=i.default)==null?void 0:a.call(i)}}})]}let eo=Symbol("PortalGroupContext"),U1=W({name:"PortalGroup",props:{as:{type:[Object,String],default:"template"},target:{type:Object,default:null}},setup(n,{attrs:e,slots:s}){let r=ls({resolveTarget(){return n.target}});return vt(eo,r),()=>{let{target:o,...l}=n;return xt({theirProps:l,ourProps:{},slot:{},attrs:e,slots:s,name:"PortalGroup"})}}});var F1=(n=>(n[n.Open=0]="Open",n[n.Closed=1]="Closed",n))(F1||{});let bn=Symbol("DialogContext");function Rn(n){let e=nt(bn,null);if(e===null){let s=new Error(`<${n} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(s,Rn),s}return e}let Cs="DC8F892D-2EBD-447C-A4C8-A03058436FF4",q1=W({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:Cs},initialFocus:{type:Object,default:null},id:{type:String,default:null},role:{type:String,default:"dialog"}},emits:{close:n=>!0},setup(n,{emit:e,attrs:s,slots:r,expose:o}){var l,i;let a=(l=n.id)!=null?l:`headlessui-dialog-${Vs()}`,u=S(!1);Ee(()=>{u.value=!0});let d=!1,f=L(()=>n.role==="dialog"||n.role==="alertdialog"?n.role:(d||(d=!0,console.warn(`Invalid role [${f}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog")),g=S(0),m=zn(),y=L(()=>n.open===Cs&&m!==null?(m.value&Je.Open)===Je.Open:n.open),x=S(null),_=L(()=>Ft(x));if(o({el:x,$el:x}),!(n.open!==Cs||m!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof y.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${y.value===Cs?void 0:n.open}`);let k=L(()=>u.value&&y.value?0:1),O=L(()=>k.value===0),R=L(()=>g.value>1),P=nt(bn,null)!==null,[D,ee]=H1(),{resolveContainers:te,mainTreeNodeRef:E,MainTreeNode:C}=O1({portals:D,defaultContainers:[L(()=>{var V;return(V=$e.panelRef.value)!=null?V:x.value})]}),H=L(()=>R.value?"parent":"leaf"),ve=L(()=>m!==null?(m.value&Je.Closing)===Je.Closing:!1),$=L(()=>P||ve.value?!1:O.value),h=L(()=>{var V,oe,K;return(K=Array.from((oe=(V=_.value)==null?void 0:V.querySelectorAll("body > *"))!=null?oe:[]).find(fe=>fe.id==="headlessui-portal-root"?!1:fe.contains(Oe(E))&&fe instanceof HTMLElement))!=null?K:null});mr(h,$);let v=L(()=>R.value?!0:O.value),B=L(()=>{var V,oe,K;return(K=Array.from((oe=(V=_.value)==null?void 0:V.querySelectorAll("[data-headlessui-portal]"))!=null?oe:[]).find(fe=>fe.contains(Oe(E))&&fe instanceof HTMLElement))!=null?K:null});mr(B,v),P1({type:"Dialog",enabled:L(()=>k.value===0),element:x,onUpdate:(V,oe)=>{if(oe==="Dialog")return bt(V,{[gn.Add]:()=>g.value+=1,[gn.Remove]:()=>g.value-=1})}});let U=V1({name:"DialogDescription",slot:L(()=>({open:y.value}))}),se=S(null),$e={titleId:se,panelRef:S(null),dialogState:k,setTitleId(V){se.value!==V&&(se.value=V)},close(){e("close",!1)}};vt(bn,$e);let N=L(()=>!(!O.value||R.value));m1(te,(V,oe)=>{V.preventDefault(),$e.close(),tt(()=>oe?.focus())},N);let j=L(()=>!(R.value||k.value!==0));Jr((i=_.value)==null?void 0:i.defaultView,"keydown",V=>{j.value&&(V.defaultPrevented||V.key===Gr.Escape&&(V.preventDefault(),V.stopPropagation(),$e.close()))});let G=L(()=>!(ve.value||k.value!==0||P));return j1(_,G,V=>{var oe;return{containers:[...(oe=V.containers)!=null?oe:[],te]}}),dt(V=>{if(k.value!==0)return;let oe=Oe(x);if(!oe)return;let K=new ResizeObserver(fe=>{for(let le of fe){let Te=le.target.getBoundingClientRect();Te.x===0&&Te.y===0&&Te.width===0&&Te.height===0&&$e.close()}});K.observe(oe),V(()=>K.disconnect())}),()=>{let{open:V,initialFocus:oe,...K}=n,fe={...s,ref:x,id:a,role:f.value,"aria-modal":k.value===0?!0:void 0,"aria-labelledby":se.value,"aria-describedby":U.value},le={open:k.value===0};return ne(vr,{force:!0},()=>[ne(D1,()=>ne(U1,{target:x.value},()=>ne(vr,{force:!1},()=>ne(rs,{initialFocus:oe,containers:te,features:O.value?bt(H.value,{parent:rs.features.RestoreFocus,leaf:rs.features.All&~rs.features.FocusLock}):rs.features.None},()=>ne(ee,{},()=>xt({ourProps:fe,theirProps:{...K,...s},slot:le,attrs:s,slots:r,visible:k.value===0,features:Os.RenderStrategy|Os.Static,name:"Dialog"})))))),ne(C)])}}}),W1=W({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:null}},setup(n,{attrs:e,slots:s,expose:r}){var o;let l=(o=n.id)!=null?o:`headlessui-dialog-panel-${Vs()}`,i=Rn("DialogPanel");r({el:i.panelRef,$el:i.panelRef});function a(u){u.stopPropagation()}return()=>{let{...u}=n,d={id:l,ref:i.panelRef,onClick:a};return xt({ourProps:d,theirProps:u,slot:{open:i.dialogState.value===0},attrs:e,slots:s,name:"DialogPanel"})}}}),G1=W({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"},id:{type:String,default:null}},setup(n,{attrs:e,slots:s}){var r;let o=(r=n.id)!=null?r:`headlessui-dialog-title-${Vs()}`,l=Rn("DialogTitle");return Ee(()=>{l.setTitleId(o),st(()=>l.setTitleId(null))}),()=>{let{...i}=n;return xt({ourProps:{id:o},theirProps:i,slot:{open:l.dialogState.value===0},attrs:e,slots:s,name:"DialogTitle"})}}});function J1(n){let e={called:!1};return(...s)=>{if(!e.called)return e.called=!0,n(...s)}}function sn(n,...e){n&&e.length>0&&n.classList.add(...e)}function Ss(n,...e){n&&e.length>0&&n.classList.remove(...e)}var xn=(n=>(n.Finished="finished",n.Cancelled="cancelled",n))(xn||{});function Z1(n,e){let s=hs();if(!n)return s.dispose;let{transitionDuration:r,transitionDelay:o}=getComputedStyle(n),[l,i]=[r,o].map(a=>{let[u=0]=a.split(",").filter(Boolean).map(d=>d.includes("ms")?parseFloat(d):parseFloat(d)*1e3).sort((d,f)=>f-d);return u});return l!==0?s.setTimeout(()=>e("finished"),l+i):e("finished"),s.add(()=>e("cancelled")),s.dispose}function xr(n,e,s,r,o,l){let i=hs(),a=l!==void 0?J1(l):()=>{};return Ss(n,...o),sn(n,...e,...s),i.nextFrame(()=>{Ss(n,...s),sn(n,...r),i.add(Z1(n,u=>(Ss(n,...r,...e),sn(n,...o),a(u))))}),i.add(()=>Ss(n,...e,...s,...r,...o)),i.add(()=>a("cancelled")),i.dispose}function Mt(n=""){return n.split(/\s+/).filter(e=>e.length>1)}let Pn=Symbol("TransitionContext");var Y1=(n=>(n.Visible="visible",n.Hidden="hidden",n))(Y1||{});function X1(){return nt(Pn,null)!==null}function K1(){let n=nt(Pn,null);if(n===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return n}function Q1(){let n=nt(Nn,null);if(n===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return n}let Nn=Symbol("NestingContext");function Bs(n){return"children"in n?Bs(n.children):n.value.filter(({state:e})=>e==="visible").length>0}function to(n){let e=S([]),s=S(!1);Ee(()=>s.value=!0),st(()=>s.value=!1);function r(l,i=St.Hidden){let a=e.value.findIndex(({id:u})=>u===l);a!==-1&&(bt(i,{[St.Unmount](){e.value.splice(a,1)},[St.Hidden](){e.value[a].state="hidden"}}),!Bs(e)&&s.value&&n?.())}function o(l){let i=e.value.find(({id:a})=>a===l);return i?i.state!=="visible"&&(i.state="visible"):e.value.push({id:l,state:"visible"}),()=>r(l,St.Unmount)}return{children:e,register:o,unregister:r}}let so=Os.RenderStrategy,yn=W({props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(n,{emit:e,attrs:s,slots:r,expose:o}){let l=S(0);function i(){l.value|=Je.Opening,e("beforeEnter")}function a(){l.value&=~Je.Opening,e("afterEnter")}function u(){l.value|=Je.Closing,e("beforeLeave")}function d(){l.value&=~Je.Closing,e("afterLeave")}if(!X1()&&b1())return()=>ne(no,{...n,onBeforeEnter:i,onAfterEnter:a,onBeforeLeave:u,onAfterLeave:d},r);let f=S(null),g=L(()=>n.unmount?St.Unmount:St.Hidden);o({el:f,$el:f});let{show:m,appear:y}=K1(),{register:x,unregister:_}=Q1(),k=S(m.value?"visible":"hidden"),O={value:!0},R=Vs(),P={value:!1},D=to(()=>{!P.value&&k.value!=="hidden"&&(k.value="hidden",_(R),d())});Ee(()=>{let v=x(R);st(v)}),dt(()=>{if(g.value===St.Hidden&&R){if(m.value&&k.value!=="visible"){k.value="visible";return}bt(k.value,{hidden:()=>_(R),visible:()=>x(R)})}});let ee=Mt(n.enter),te=Mt(n.enterFrom),E=Mt(n.enterTo),C=Mt(n.entered),H=Mt(n.leave),ve=Mt(n.leaveFrom),$=Mt(n.leaveTo);Ee(()=>{dt(()=>{if(k.value==="visible"){let v=Oe(f);if(v instanceof Comment&&v.data==="")throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")}})});function h(v){let B=O.value&&!y.value,U=Oe(f);!U||!(U instanceof HTMLElement)||B||(P.value=!0,m.value&&i(),m.value||u(),v(m.value?xr(U,ee,te,E,C,se=>{P.value=!1,se===xn.Finished&&a()}):xr(U,H,ve,$,C,se=>{P.value=!1,se===xn.Finished&&(Bs(D)||(k.value="hidden",_(R),d()))})))}return Ee(()=>{Se([m],(v,B,U)=>{h(U),O.value=!1},{immediate:!0})}),vt(Nn,D),x1(L(()=>bt(k.value,{visible:Je.Open,hidden:Je.Closed})|l.value)),()=>{let{appear:v,show:B,enter:U,enterFrom:se,enterTo:$e,entered:N,leave:j,leaveFrom:G,leaveTo:V,...oe}=n,K={ref:f},fe={...oe,...y.value&&m.value&&gs.isServer?{class:Q([s.class,oe.class,...ee,...te])}:{}};return xt({theirProps:fe,ourProps:K,slot:{},slots:r,attrs:s,features:so,visible:k.value==="visible",name:"TransitionChild"})}}}),ep=yn,no=W({inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(n,{emit:e,attrs:s,slots:r}){let o=zn(),l=L(()=>n.show===null&&o!==null?(o.value&Je.Open)===Je.Open:n.show);dt(()=>{if(![!0,!1].includes(l.value))throw new Error('A <Transition /> is used but it is missing a `:show="true | false"` prop.')});let i=S(l.value?"visible":"hidden"),a=to(()=>{i.value="hidden"}),u=S(!0),d={show:l,appear:L(()=>n.appear||!u.value)};return Ee(()=>{dt(()=>{u.value=!1,l.value?i.value="visible":Bs(a)||(i.value="hidden")})}),vt(Nn,a),vt(Pn,d),()=>{let f=qr(n,["show","appear","unmount","onBeforeEnter","onBeforeLeave","onAfterEnter","onAfterLeave"]),g={unmount:n.unmount};return xt({ourProps:{...g,as:"template"},theirProps:{},slot:{},slots:{...r,default:()=>[ne(ep,{onBeforeEnter:()=>e("beforeEnter"),onAfterEnter:()=>e("afterEnter"),onBeforeLeave:()=>e("beforeLeave"),onAfterLeave:()=>e("afterLeave"),...s,...g,...f},r.default)]},attrs:{},features:so,visible:i.value==="visible",name:"Transition"})}}});const tp={class:"fixed inset-0 z-10 overflow-y-auto"},sp={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},np={class:"bg-white px-5 pt-6 pb-5 sm:px-6 sm:pt-6 sm:pb-5"},rp={class:"flex flex-col gap-4 sm:flex-row sm:items-start"},op={class:"text-center sm:flex-1 sm:text-left"},lp={class:"mt-6"},ap={class:"mt-5 flex flex-wrap justify-center gap-3"},ip=["onClick"],up={class:"bg-gray-50 px-6 py-4 sm:flex sm:flex-row-reverse sm:px-8"},dp=W({__name:"WDGenerateOutlineModal",props:{show:{type:Boolean}},emits:["close","generate"],setup(n,{emit:e}){const s=e,r=S(5),o=i=>{r.value=i},l=()=>{r.value>0&&(s("generate",r.value),s("close"))};return(i,a)=>(c(),je(we(no),{as:"template",show:n.show},{default:Re(()=>[xe(we(q1),{as:"div",class:"relative z-50",onClose:a[2]||(a[2]=u=>i.$emit("close"))},{default:Re(()=>[xe(we(yn),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:Re(()=>[...a[3]||(a[3]=[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)])]),_:1}),t("div",tp,[t("div",sp,[xe(we(yn),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:Re(()=>[xe(we(W1),{class:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-6 sm:w-full sm:max-w-lg"},{default:Re(()=>[t("div",np,[t("div",rp,[a[6]||(a[6]=t("div",{class:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-indigo-100 sm:mx-0 sm:h-12 sm:w-12"},[t("svg",{class:"h-6 w-6 text-indigo-600",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v12m6-6H6"})])],-1)),t("div",op,[xe(we(G1),{as:"h3",class:"text-xl font-semibold leading-7 text-gray-900"},{default:Re(()=>[...a[4]||(a[4]=[Y("生成后续大纲",-1)])]),_:1}),a[5]||(a[5]=t("div",{class:"mt-2"},[t("p",{class:"text-base text-gray-500"},"请输入或选择要生成的后续章节数量。")],-1))])]),t("div",lp,[a[7]||(a[7]=t("label",{for:"numChapters",class:"block text-base font-medium text-gray-700"},"生成数量",-1)),de(t("input",{type:"number",name:"numChapters",id:"numChapters","onUpdate:modelValue":a[0]||(a[0]=u=>r.value=u),class:"mt-2 block w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-lg shadow-sm focus:border-indigo-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500",min:"1",max:"20"},null,512),[[ce,r.value,void 0,{number:!0}]]),t("div",ap,[(c(),p(re,null,ge([1,2,5,10],u=>t("button",{key:u,onClick:d=>o(u),class:Q(["px-5 py-2 text-base rounded-full transition-colors duration-150",r.value===u?"bg-indigo-600 text-white shadow-md":"bg-gray-200 text-gray-700 hover:bg-gray-300"])},w(u)+" 章 ",11,ip)),64))])])]),t("div",up,[t("button",{type:"button",class:"inline-flex w-full justify-center rounded-lg border border-transparent bg-indigo-600 px-5 py-3 text-base font-semibold text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:ml-3 sm:w-auto",onClick:l},"生成"),t("button",{type:"button",class:"mt-3 inline-flex w-full justify-center rounded-lg border border-gray-300 bg-white px-5 py-3 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto",onClick:a[1]||(a[1]=u=>i.$emit("close"))},"取消")])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}}),cp={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},pp={class:"bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden flex flex-col"},fp={class:"flex items-center justify-between p-6 border-b border-gray-200"},hp={class:"text-lg font-bold text-gray-900"},gp={class:"p-6 space-y-6"},mp={class:"grid grid-cols-2 gap-3"},vp={key:0,class:"grid grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg"},bp=W({__name:"WDRewriteOptionModal",props:{visible:{type:Boolean},chapterNumber:{},defaultNotes:{}},emits:["update:visible","confirm"],setup(n,{emit:e}){const s=n,r=e,o=S("smart"),l=S(""),i=S(75),a=S(2);Se(()=>s.visible,f=>{f&&(l.value=s.defaultNotes||"",o.value=s.defaultNotes?"smart":"normal")});const u=()=>r("update:visible",!1),d=()=>{r("confirm",{mode:o.value,writingNotes:l.value,scoreThreshold:i.value,maxAttempts:a.value}),u()};return(f,g)=>n.visible?(c(),p("div",cp,[t("div",pp,[t("div",fp,[t("h3",hp,"重写第 "+w(n.chapterNumber)+" 章",1),t("button",{onClick:u,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...g[5]||(g[5]=[t("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])]),t("div",gp,[t("div",null,[g[8]||(g[8]=t("label",{class:"text-sm font-medium text-gray-700 mb-2 block"},"重写模式",-1)),t("div",mp,[t("button",{onClick:g[0]||(g[0]=m=>o.value="normal"),class:Q(["px-4 py-3 rounded-lg border text-sm font-medium transition-all",o.value==="normal"?"border-indigo-600 bg-indigo-50 text-indigo-700":"border-gray-200 hover:border-gray-300 text-gray-600"])},[...g[6]||(g[6]=[Y(" 🚀 普通生成 ",-1),t("span",{class:"block text-xs font-normal mt-1 opacity-75"},"快速生成新版本",-1)])],2),t("button",{onClick:g[1]||(g[1]=m=>o.value="smart"),class:Q(["px-4 py-3 rounded-lg border text-sm font-medium transition-all",o.value==="smart"?"border-purple-600 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300 text-gray-600"])},[...g[7]||(g[7]=[Y(" 🧠 智能重写 ",-1),t("span",{class:"block text-xs font-normal mt-1 opacity-75"},"生成+评审+自动优化",-1)])],2)])]),o.value==="smart"?(c(),p("div",vp,[t("div",null,[g[9]||(g[9]=t("label",{class:"text-xs font-medium text-gray-500 mb-1 block"},"最低评分要求",-1)),de(t("input",{"onUpdate:modelValue":g[2]||(g[2]=m=>i.value=m),type:"number",min:"1",max:"100",class:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded focus:ring-purple-500 focus:border-purple-500"},null,512),[[ce,i.value,void 0,{number:!0}]])]),t("div",null,[g[10]||(g[10]=t("label",{class:"text-xs font-medium text-gray-500 mb-1 block"},"最大尝试次数",-1)),de(t("input",{"onUpdate:modelValue":g[3]||(g[3]=m=>a.value=m),type:"number",min:"1",max:"5",class:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded focus:ring-purple-500 focus:border-purple-500"},null,512),[[ce,a.value,void 0,{number:!0}]])])])):T("",!0),t("div",null,[g[11]||(g[11]=t("label",{class:"text-sm font-medium text-gray-700 mb-2 block"},"写作指导 (Optional)",-1)),de(t("textarea",{"onUpdate:modelValue":g[4]||(g[4]=m=>l.value=m),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-indigo-500 focus:border-indigo-500 resize-none",placeholder:"输入具体的修改意见，例如：增加环境描写，让对话更紧凑..."},null,512),[[ce,l.value]])])]),t("div",{class:"p-6 border-t border-gray-200 flex justify-end gap-3 bg-gray-50"},[t("button",{onClick:u,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50"},"取消"),t("button",{onClick:d,class:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 shadow-sm"},"开始重写")])])])):T("",!0)}}),xp={class:"h-screen flex flex-col bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50"},yp={class:"flex-1 w-full px-4 sm:px-6 lg:px-8 py-6 overflow-hidden"},wp={key:0,class:"h-full flex justify-center items-center"},_p={key:1,class:"text-center py-20"},kp={class:"bg-red-50 border border-red-200 rounded-xl p-8 max-w-md mx-auto"},$p={class:"text-red-700 mb-4"},Cp={key:2,class:"h-full flex gap-6"},Sp={class:"flex-1 min-w-0"},Ep={key:0,class:"fixed bottom-6 right-6 z-50 w-80 max-w-[90vw] rounded-xl border border-indigo-100 bg-white/95 shadow-lg backdrop-blur px-4 py-3"},Tp={class:"flex items-center justify-between"},Ap={class:"mt-1 text-sm text-gray-600"},Mp={key:0,class:"mt-2"},Lp={class:"flex justify-between text-xs text-gray-500 mb-1"},jp={class:"w-full bg-gray-200 rounded-full h-1.5"},Op=W({__name:"WritingDesk",props:{id:{}},setup(n){const e=n,s=Et(),r=fs(),o=S(null),l=S(null),i=S(0),a=S(null),u=S(!1),d=S(!1),f=S(0),g=S(!1),m=S(!1),y=S(!1),x=S(null),_=S(!1),k=S(!1),O=S(!1),R=S(!1),P=S(null),D=S(""),ee=S(void 0),te=S(!1),E=S({message:"",chapter:null,totalChapters:0,completedChapters:0}),C=L(()=>r.currentProject),H=L(()=>!C.value||o.value===null?null:C.value.chapters.find(M=>M.chapter_number===o.value)||null),ve=L(()=>{if(O.value)return!0;if(!H.value)return!1;const M=H.value.generation_status;return M==="waiting_for_confirm"||M==="evaluating"||M==="evaluation_failed"||M==="selecting"}),$=L(()=>H.value?.generation_status==="evaluating"?H.value.chapter_number:null),h=L(()=>H.value?.generation_status==="selecting");L(()=>!C.value?.blueprint?.chapter_outline||o.value===null?null:C.value.blueprint.chapter_outline.find(M=>M.chapter_number===o.value)||null);const v=L(()=>{if(!C.value?.blueprint?.chapter_outline)return 0;const M=C.value.blueprint.chapter_outline.length,A=C.value.chapters.filter(I=>I.content).length;return Math.round(A/M*100)}),B=L(()=>C.value?.blueprint?.chapter_outline?.length||0),U=L(()=>C.value?.chapters?.filter(M=>M.content)?.length||0),se=M=>{if(!H.value?.content||!j.value?.[M]?.content)return!1;const A=$e(H.value.content),I=$e(j.value[M].content);return A===I},$e=M=>{if(!M)return"";try{const I=JSON.parse(M);I&&typeof I=="object"&&I.content&&(M=I.content)}catch{}let A=M.replace(/^"|"$/g,"");return A=A.replace(/\\n/g,`
`),A=A.replace(/\\"/g,'"'),A=A.replace(/\\t/g,"	"),A=A.replace(/\\\\/g,"\\"),A},N=M=>{if(!C.value?.blueprint?.chapter_outline)return!1;const A=C.value.blueprint.chapter_outline.sort((ie,he)=>ie.chapter_number-he.chapter_number);for(const ie of A){if(ie.chapter_number>=M)break;const he=C.value?.chapters.find(Ce=>Ce.chapter_number===ie.chapter_number);if(!he||he.generation_status!=="successful")return!1}const I=C.value?.chapters.find(ie=>ie.chapter_number===M);return I&&I.generation_status==="successful",!0},j=L(()=>l.value?.versions?l.value.versions:H.value?.versions&&Array.isArray(H.value.versions)?H.value.versions.map(A=>{if(typeof A=="object"&&A!==null)return{content:A.content||"",provider:A.provider||void 0,style:"标准"};if(typeof A=="string")try{const I=JSON.parse(A);return{content:I.content||A,provider:I.provider||void 0,style:"标准"}}catch{return{content:A,style:"标准"}}return{content:"",style:"标准"}}):[]),G=()=>{s.push("/workspace")},V=()=>{C.value&&s.push(`/detail/${C.value.id}`)},oe=()=>{u.value=!u.value},K=()=>{u.value=!1},fe=async()=>{try{await r.loadProject(e.id)}catch(M){console.error("加载项目失败:",M)}},le=async()=>{if(o.value!==null)try{await r.loadChapter(o.value)}catch{}},Te=M=>{f.value=M,d.value=!0},Ze=()=>{d.value=!1},Ye=()=>{O.value=!1,l.value=null,i.value=0},F=()=>{O.value=!0},J=M=>{o.value=M,l.value=null,i.value=0,O.value=!1,K()},ue=async(M,A)=>{if(!N(M)){const I=C.value?.blueprint?.chapter_outline?.sort((he,Ce)=>he.chapter_number-Ce.chapter_number)||[];let ie=0;for(const he of I){if(he.chapter_number>=M)break;const Ce=C.value?.chapters.find(Ae=>Ae.chapter_number===he.chapter_number);if(!Ce||Ce.generation_status!=="successful"){ie=he.chapter_number;break}}X.showError(`请先完成第 ${ie} 章`,"生成受限");return}try{if(a.value=M,o.value=M,C.value?.chapters){const I=C.value.chapters.find(ie=>ie.chapter_number===M);if(I)I.generation_status="generating";else{const ie=C.value.blueprint?.chapter_outline?.find(he=>he.chapter_number===M);C.value.chapters.push({chapter_number:M,title:ie?.title||"加载中...",summary:ie?.summary||"",content:"",versions:[],evaluation:null,generation_status:"generating"})}}await r.generateChapter(M,A),await r.loadProject(e.id,!0),l.value=null,i.value=0}catch(I){if(console.error("生成章节失败:",I),C.value?.chapters){const ie=C.value.chapters.find(he=>he.chapter_number===M);ie&&(ie.generation_status="failed")}X.showError(`生成章节失败: ${I instanceof Error?I.message:"未知错误"}`,"生成失败")}finally{a.value=null}},ot=async M=>{if(!(o.value===null||!j.value?.[M]?.content))try{if(C.value?.chapters){const A=C.value.chapters.find(I=>I.chapter_number===o.value);A&&(A.generation_status="selecting")}i.value=M,await r.selectChapterVersion(o.value,M),l.value=null,X.showSuccess("版本已确认","操作成功")}catch(A){if(console.error("选择章节版本失败:",A),C.value?.chapters){const I=C.value.chapters.find(ie=>ie.chapter_number===o.value);I&&(I.generation_status="waiting_for_confirm")}X.showError(`选择章节版本失败: ${A instanceof Error?A.message:"未知错误"}`,"选择失败")}},Pe=async()=>{i.value=f.value,await ot(f.value),Ze()},We=async()=>{await ot(i.value)},Fe=M=>{x.value=M,y.value=!0},qt=async M=>{try{await r.updateChapterOutline(M),X.showSuccess("章节大纲已更新","保存成功")}catch(A){console.error("更新章节大纲失败:",A),X.showError(`更新章节大纲失败: ${A instanceof Error?A.message:"未知错误"}`,"保存失败")}finally{y.value=!1}},Wt=async()=>{if(o.value!==null)try{if(C.value?.chapters){const M=C.value.chapters.find(A=>A.chapter_number===o.value);M&&(M.generation_status="evaluating")}X.showInfo("AI正在评审章节内容，请稍候...","评审中"),await r.evaluateChapter(o.value),g.value=!0,X.showSuccess("章节评审结果已生成，请查看详情","评审成功")}catch(M){if(console.error("评审章节失败:",M),C.value?.chapters){const A=C.value.chapters.find(I=>I.chapter_number===o.value);A&&(A.generation_status="successful")}X.showError(`评审章节失败: ${M instanceof Error?M.message:"未知错误"}`,"评审失败")}},kt=async()=>{if(o.value!==null)try{await r.cancelEvaluation(o.value),X.showSuccess("已取消评审","操作成功")}catch(M){console.error("取消评审失败:",M),X.showError(`取消评审失败: ${M instanceof Error?M.message:"未知错误"}`)}},yt=(M,A="",I)=>{P.value=M,D.value=A,ee.value=I,R.value=!0},Vt=async M=>{if(P.value===null)return;const A=P.value;if(M.mode==="normal"){await ue(A,M.writingNotes||void 0);return}m.value=!0;try{K(),r.updateChapterStatus(A,"generating"),X.showInfo("正在进行智能重写...","重写中");const I=await ke.generateWithReview(e.id,A,{writing_notes:M.writingNotes,score_threshold:M.scoreThreshold,max_attempts:M.maxAttempts,auto_select_best:!0,rewrite_provider:ee.value});await r.loadProject(e.id,!0),I.success?X.showSuccess(`重写完成！最终评分: ${I.final_score||"-"}，尝试次数: ${I.attempts_used}`,"重写成功"):X.showWarning(`重写完成但未达到目标分数。最终评分: ${I.final_score||"-"}`,"重写完成")}catch(I){console.error("智能重写失败:",I),X.showError(`重写失败: ${I instanceof Error?I.message:"未知错误"}`,"重写失败"),r.updateChapterStatus(A,"successful")}finally{m.value=!1}},vs=()=>{if(o.value===null)return;g.value=!1;let M="";const A=H.value;if(A?.evaluation)try{const I=JSON.parse(A.evaluation),ie=[];I.versions&&Array.isArray(I.versions)&&I.versions.forEach(he=>{he.cons&&he.cons.forEach(Ce=>ie.push(typeof Ce=="string"?Ce:Ce.issue))}),ie.length>0&&(M=`请解决以下问题：
- ${ie.slice(0,5).join(`
- `)}`)}catch{}yt(o.value,M)},bs=M=>{if(o.value===null)return;const A=H.value;if(!A?.evaluation)return;let I="",ie;const he=j.value;he&&he.length>=M&&(ie=he[M-1]?.provider);try{const Ce=JSON.parse(A.evaluation);if(Ce.versions&&Array.isArray(Ce.versions)){const Ae=Ce.versions.find(Ge=>Ge.version_index===M);if(Ae?.cons&&Ae.cons.length>0){const Ge=Ae.cons.map(Ke=>{const Qe=[];return Ke.location&&Qe.push(`位置：${Ke.location}`),Ke.issue&&Qe.push(`问题：${Ke.issue}`),Ke.suggestion&&Qe.push(`建议：${Ke.suggestion}`),Qe.length>0?`- ${Qe.join(" | ")}`:null}).filter(Boolean);Ge.length>0&&(I=`请避免以下问题：
${Ge.join(`
`)}`)}}}catch(Ce){console.error("解析评审结果失败:",Ce)}g.value=!1,yt(o.value,I,ie)},Is=async M=>{const A=Array.isArray(M)?M:[M],I=A.length>1?`您确定要删除选中的 ${A.length} 个章节吗？这个操作无法撤销。`:`您确定要删除第 ${A[0]} 章吗？这个操作无法撤销。`;if(await X.showConfirm(I,"删除确认"))try{await r.deleteChapter(A),X.showSuccess("章节已删除","操作成功"),o.value&&A.includes(o.value)&&(o.value=null)}catch(he){console.error("删除章节失败:",he),X.showError(`删除章节失败: ${he instanceof Error?he.message:"未知错误"}`,"删除失败")}},Gt=async()=>{k.value=!0},Tt=async M=>{if(C.value)try{await r.editChapterContent(C.value.id,M.chapterNumber,M.content),X.showSuccess("章节内容已更新","保存成功")}catch(A){console.error("编辑章节内容失败:",A),X.showError(`编辑章节内容失败: ${A instanceof Error?A.message:"未知错误"}`,"保存失败")}},$t=async M=>{if(C.value){_.value=!0;try{const A=(C.value.blueprint?.chapter_outline?.length||0)+1;await r.generateChapterOutline(A,M),X.showSuccess("新的章节大纲已生成","操作成功")}catch(A){console.error("生成大纲失败:",A),X.showError(`生成大纲失败: ${A instanceof Error?A.message:"未知错误"}`,"生成失败")}finally{_.value=!1}}},Xe=async()=>{if(!(!C.value||!te.value))try{E.value.message="正在停止...",await ke.stopAutoCreate(C.value.id)}catch(M){const A=M instanceof Error?M.message:"停止失败";X.showError(A,"停止连续创作失败")}},Jt=async()=>{if(!(!C.value||te.value)){te.value=!0,E.value={message:"准备开始连续创作...",chapter:null,totalChapters:0,completedChapters:0};try{const M=await ke.autoCreateChapters(C.value.id);if(!M.body)throw new Error("未收到响应流");const A=M.body.getReader(),I=new TextDecoder("utf-8");let ie="";for(;;){const{done:he,value:Ce}=await A.read();if(he)break;ie+=I.decode(Ce,{stream:!0});let Ae=ie.indexOf(`

`);for(;Ae!==-1;){const Ge=ie.slice(0,Ae);ie=ie.slice(Ae+2);const Ke=Ge.split(`
`);let Qe="message";const Zt=[];for(const et of Ke)et.startsWith("event:")?Qe=et.slice(6).trim():et.startsWith("data:")&&Zt.push(et.slice(5).trim());if(Zt.length>0){const et=Zt.join(`
`);let be=et;try{be=JSON.parse(et)}catch{}switch(Qe){case"start":E.value={...E.value,totalChapters:be.total_chapters??0,message:`开始连续创作：第${be.start_chapter}章 - 第${be.end_chapter}章`};break;case"progress":if(E.value={...E.value,chapter:be.chapter??null,message:be.message||"连续创作处理中..."},be&&typeof be=="object"){const Yt=typeof be.chapter=="number"?be.chapter:Number(be.chapter),xs={generating:"generating",evaluating:"evaluating",selecting:"selecting",ingesting:"ingesting"}[be.stage];Number.isFinite(Yt)&&Yt>0&&xs&&r.updateChapterStatus(Yt,xs)}break;case"chapter_done":E.value={...E.value,chapter:be.chapter??null,completedChapters:E.value.completedChapters+1,message:`第${be.chapter}章完成 (评分: ${be.score??"-"})`},r.updateChapterData(Number(be.chapter),be.chapter_data);break;case"chapter_error":E.value={...E.value,chapter:be.chapter??null,message:`第${be.chapter}章失败：${be.message||"未知错误"}`};break;case"complete":E.value={...E.value,completedChapters:be.chapters_created??E.value.completedChapters,message:be.message||"连续创作完成"},await r.loadProject(e.id,!0),X.showSuccess(E.value.message,"连续创作完成");break;case"error":E.value={...E.value,message:be.message||"连续创作流程异常中断"},X.showError(E.value.message,"连续创作异常");break;case"stopped":E.value={...E.value,completedChapters:be.chapters_created??E.value.completedChapters,message:be.message||"已停止连续创作"},await r.loadProject(e.id,!0),X.showInfo(E.value.message,"连续创作已停止");break}}Ae=ie.indexOf(`

`)}}}catch(M){const A=M instanceof Error?M.message:"连续创作失败";E.value={...E.value,message:A},X.showError(A,"连续创作失败")}finally{te.value=!1}}};return Ee(()=>{fe()}),(M,A)=>(c(),p("div",xp,[xe(nu,{project:C.value,progress:v.value,"completed-chapters":U.value,"total-chapters":B.value,onGoBack:G,onViewProjectDetail:V,onToggleSidebar:oe},null,8,["project","progress","completed-chapters","total-chapters"]),t("div",yp,[we(r).isLoading?(c(),p("div",wp,[...A[9]||(A[9]=[t("div",{class:"text-center"},[t("div",{class:"w-12 h-12 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-4"}),t("p",{class:"text-gray-600"},"正在加载项目数据...")],-1)])])):we(r).error?(c(),p("div",_p,[t("div",kp,[A[10]||(A[10]=t("svg",{class:"w-12 h-12 text-red-400 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),A[11]||(A[11]=t("h3",{class:"text-lg font-semibold text-red-900 mb-2"},"加载失败",-1)),t("p",$p,w(we(r).error),1),t("button",{onClick:fe,class:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"}," 重新加载 ")])])):C.value?(c(),p("div",Cp,[xe(ed,{project:C.value,"sidebar-open":u.value,"selected-chapter-number":o.value,"generating-chapter":a.value,"evaluating-chapter":$.value,"is-generating-outline":_.value,onCloseSidebar:K,onSelectChapter:J,onGenerateChapter:A[0]||(A[0]=I=>yt(I)),onEditChapter:Fe,onDeleteChapter:Is,onGenerateOutline:Gt,onAutoCreate:Jt},null,8,["project","sidebar-open","selected-chapter-number","generating-chapter","evaluating-chapter","is-generating-outline"]),t("div",Sp,[xe(Uc,{project:C.value,"selected-chapter-number":o.value,"generating-chapter":a.value,"evaluating-chapter":$.value,"show-version-selector":ve.value,"chapter-generation-result":l.value,"selected-version-index":i.value,"available-versions":j.value,"is-selecting-version":h.value,onRegenerateChapter:A[1]||(A[1]=()=>o.value&&yt(o.value)),onEvaluateChapter:Wt,onHideVersionSelector:Ye,"onUpdate:selectedVersionIndex":A[2]||(A[2]=I=>i.value=I),onShowVersionDetail:Te,onConfirmVersionSelection:We,onGenerateChapter:ue,onShowEvaluationDetail:A[3]||(A[3]=I=>g.value=!0),onFetchChapterStatus:le,onEditChapter:Tt,onShowVersionSelector:F,onCancelEvaluation:kt},null,8,["project","selected-chapter-number","generating-chapter","evaluating-chapter","show-version-selector","chapter-generation-result","selected-version-index","available-versions","is-selecting-version"])])])):T("",!0)]),xe(s0,{show:d.value,"detail-version-index":f.value,version:j.value[f.value]||null,"is-current":se(f.value),onClose:Ze,onSelectVersion:Pe},null,8,["show","detail-version-index","version","is-current"]),xe(Y0,{show:g.value,evaluation:H.value?.evaluation||null,versions:H.value?.versions||null,rewriting:m.value,onClose:A[4]||(A[4]=I=>g.value=!1),onRewrite:vs,onRewriteVersion:bs},null,8,["show","evaluation","versions","rewriting"]),xe(t1,{show:y.value,chapter:x.value,onClose:A[5]||(A[5]=I=>y.value=!1),onSave:qt},null,8,["show","chapter"]),xe(dp,{show:k.value,onClose:A[6]||(A[6]=I=>k.value=!1),onGenerate:$t},null,8,["show"]),xe(bp,{visible:R.value,"onUpdate:visible":A[7]||(A[7]=I=>R.value=I),"chapter-number":P.value||0,"default-notes":D.value,onConfirm:Vt},null,8,["visible","chapter-number","default-notes"]),te.value||E.value.message?(c(),p("div",Ep,[t("div",Tp,[A[13]||(A[13]=t("div",{class:"text-sm font-medium text-gray-700"},"连续创作",-1)),te.value?(c(),p("button",{key:0,onClick:Xe,class:"px-3 py-1 text-xs font-medium bg-red-500 text-white rounded hover:bg-red-600 transition-colors"}," 停止 ")):(c(),p("button",{key:1,onClick:A[8]||(A[8]=I=>E.value.message=""),class:"text-gray-400 hover:text-gray-600"},[...A[12]||(A[12]=[t("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])]))]),t("div",Ap,w(E.value.message||"连续创作处理中..."),1),E.value.totalChapters?(c(),p("div",Mp,[t("div",Lp,[A[14]||(A[14]=t("span",null,"进度",-1)),t("span",null,w(E.value.completedChapters)+" / "+w(E.value.totalChapters),1)]),t("div",jp,[t("div",{class:"bg-indigo-600 h-1.5 rounded-full transition-all duration-300",style:Ht({width:`${E.value.completedChapters/E.value.totalChapters*100}%`})},null,4)])])):T("",!0)])):T("",!0)]))}}),zp=Pt(Op,[["__scopeId","data-v-73c83f96"]]),Rp={class:"space-y-4 max-h-96 overflow-y-auto p-1"},Pp={class:"flex items-center mb-2"},Np={class:"font-bold text-indigo-600 mr-2"},Vp=["onUpdate:modelValue"],Bp=["onClick"],Ip=["onUpdate:modelValue"],Dp=W({__name:"ChapterOutlineEditor",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(n,{emit:e}){const s=n,r=e,o=S([]);let l=!1;Se(()=>s.modelValue,a=>{l=!0,o.value=JSON.parse(JSON.stringify(a||[])),tt(()=>{l=!1})},{immediate:!0}),Se(o,a=>{l||r("update:modelValue",JSON.parse(JSON.stringify(a)))},{deep:!0});const i=a=>{o.value.splice(a,1),o.value.forEach((u,d)=>{u.chapter_number=d+1})};return(a,u)=>(c(),p("div",Rp,[(c(!0),p(re,null,ge(o.value,(d,f)=>(c(),p("div",{key:f,class:"p-4 border border-gray-200 rounded-lg bg-gray-50"},[t("div",Pp,[t("span",Np,"第 "+w(d.chapter_number)+" 章",1),de(t("input",{type:"text","onUpdate:modelValue":g=>d.title=g,class:"flex-grow p-1 border-b-2 border-gray-300 focus:border-indigo-500 outline-none transition",placeholder:"章节标题"},null,8,Vp),[[ce,d.title]]),t("button",{onClick:g=>i(f),class:"ml-2 text-red-400 hover:text-red-600 transition-colors p-1"},[...u[0]||(u[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z","clip-rule":"evenodd"})],-1)])],8,Bp)]),de(t("textarea",{"onUpdate:modelValue":g=>d.summary=g,class:"w-full h-24 p-2 mt-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 transition text-sm",placeholder:"章节摘要"},null,8,Ip),[[ce,d.summary]])]))),128))]))}}),Hp={class:"space-y-4 max-h-96 overflow-y-auto p-1"},Up=["onClick"],Fp={class:"mb-2"},qp=["onUpdate:modelValue"],Wp=["onUpdate:modelValue"],Gp=W({__name:"KeyLocationsEditor",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(n,{emit:e}){const s=n,r=e,o=S([]);let l=!1;Se(()=>s.modelValue,u=>{l=!0,o.value=JSON.parse(JSON.stringify(u||[])),tt(()=>{l=!1})},{immediate:!0}),Se(o,u=>{l||r("update:modelValue",JSON.parse(JSON.stringify(u)))},{deep:!0});const i=()=>{o.value.push({name:"",description:""})},a=u=>{o.value.splice(u,1)};return(u,d)=>(c(),p("div",Hp,[(c(!0),p(re,null,ge(o.value,(f,g)=>(c(),p("div",{key:g,class:"p-4 border border-gray-200 rounded-lg bg-gray-50 relative"},[t("button",{onClick:m=>a(g),class:"absolute top-2 right-2 text-red-400 hover:text-red-600 transition-colors p-1"},[...d[0]||(d[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z","clip-rule":"evenodd"})],-1)])],8,Up),t("div",Fp,[d[1]||(d[1]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"地点名称",-1)),de(t("input",{type:"text","onUpdate:modelValue":m=>f.name=m,class:"w-full p-1 border-b-2 border-gray-300 focus:border-indigo-500 outline-none transition bg-transparent",placeholder:"例如：林远生前的公寓"},null,8,qp),[[ce,f.name]])]),t("div",null,[d[2]||(d[2]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"描述",-1)),de(t("textarea",{"onUpdate:modelValue":m=>f.description=m,class:"w-full h-20 p-2 mt-1 border border-gray-300 rounded-md focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 transition text-sm",placeholder:"关于这个地点的详细描述..."},null,8,Wp),[[ce,f.description]])])]))),128)),t("button",{onClick:i,class:"w-full mt-4 px-4 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-md hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," + 添加新地点 ")]))}}),Jp={class:"space-y-4 max-h-96 overflow-y-auto p-1"},Zp=["onClick"],Yp={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Xp=["onUpdate:modelValue"],Kp=["onUpdate:modelValue"],Qp=["onUpdate:modelValue"],ef=["onUpdate:modelValue"],tf=["onUpdate:modelValue"],sf=["onUpdate:modelValue"],nf=W({__name:"CharactersEditor",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(n,{emit:e}){const s=n,r=e,o=S([]);let l=!1;Se(()=>s.modelValue,u=>{l=!0,o.value=JSON.parse(JSON.stringify(u||[])),tt(()=>{l=!1})},{immediate:!0}),Se(o,u=>{l||r("update:modelValue",JSON.parse(JSON.stringify(u)))},{deep:!0});const i=()=>{o.value.push({name:"",identity:"",personality:"",goals:"",abilities:"",relationship_to_protagonist:""})},a=u=>{o.value.splice(u,1)};return(u,d)=>(c(),p("div",Jp,[(c(!0),p(re,null,ge(o.value,(f,g)=>(c(),p("div",{key:g,class:"p-4 border border-gray-200 rounded-lg bg-gray-50 relative"},[t("button",{onClick:m=>a(g),class:"absolute top-2 right-2 text-red-400 hover:text-red-600 transition-colors p-1"},[...d[0]||(d[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z","clip-rule":"evenodd"})],-1)])],8,Zp),t("div",Yp,[t("div",null,[d[1]||(d[1]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"姓名",-1)),de(t("input",{type:"text","onUpdate:modelValue":m=>f.name=m,class:"w-full p-1 border-b-2 border-gray-300 focus:border-indigo-500 outline-none transition bg-transparent"},null,8,Xp),[[ce,f.name]])]),t("div",null,[d[2]||(d[2]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"身份",-1)),de(t("input",{type:"text","onUpdate:modelValue":m=>f.identity=m,class:"w-full p-1 border-b-2 border-gray-300 focus:border-indigo-500 outline-none transition bg-transparent"},null,8,Kp),[[ce,f.identity]])]),t("div",null,[d[3]||(d[3]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"性格",-1)),de(t("input",{type:"text","onUpdate:modelValue":m=>f.personality=m,class:"w-full p-1 border-b-2 border-gray-300 focus:border-indigo-500 outline-none transition bg-transparent"},null,8,Qp),[[ce,f.personality]])]),t("div",null,[d[4]||(d[4]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"目标",-1)),de(t("input",{type:"text","onUpdate:modelValue":m=>f.goals=m,class:"w-full p-1 border-b-2 border-gray-300 focus:border-indigo-500 outline-none transition bg-transparent"},null,8,ef),[[ce,f.goals]])]),t("div",null,[d[5]||(d[5]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"能力",-1)),de(t("input",{type:"text","onUpdate:modelValue":m=>f.abilities=m,class:"w-full p-1 border-b-2 border-gray-300 focus:border-indigo-500 outline-none transition bg-transparent"},null,8,tf),[[ce,f.abilities]])]),t("div",null,[d[6]||(d[6]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"与主角关系",-1)),de(t("input",{type:"text","onUpdate:modelValue":m=>f.relationship_to_protagonist=m,class:"w-full p-1 border-b-2 border-gray-300 focus:border-indigo-500 outline-none transition bg-transparent"},null,8,sf),[[ce,f.relationship_to_protagonist]])])])]))),128)),t("button",{onClick:i,class:"w-full mt-4 px-4 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-md hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," + 添加新角色 ")]))}}),rf={class:"space-y-4 max-h-96 overflow-y-auto p-1"},of=["onClick"],lf={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-2"},af=["onUpdate:modelValue"],uf=["onUpdate:modelValue"],df=["onUpdate:modelValue"],cf=W({__name:"RelationshipsEditor",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(n,{emit:e}){const s=n,r=e,o=S([]);let l=!1;Se(()=>s.modelValue,u=>{l=!0,o.value=JSON.parse(JSON.stringify(u||[])),tt(()=>{l=!1})},{immediate:!0}),Se(o,u=>{l||r("update:modelValue",JSON.parse(JSON.stringify(u)))},{deep:!0});const i=()=>{o.value.push({character_from:"",character_to:"",description:""})},a=u=>{o.value.splice(u,1)};return(u,d)=>(c(),p("div",rf,[(c(!0),p(re,null,ge(o.value,(f,g)=>(c(),p("div",{key:g,class:"p-4 border border-gray-200 rounded-lg bg-gray-50 relative"},[t("button",{onClick:m=>a(g),class:"absolute top-2 right-2 text-red-400 hover:text-red-600 transition-colors p-1"},[...d[0]||(d[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z","clip-rule":"evenodd"})],-1)])],8,of),t("div",lf,[t("div",null,[d[1]||(d[1]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"从",-1)),de(t("input",{type:"text","onUpdate:modelValue":m=>f.character_from=m,class:"w-full p-1 border-b-2 border-gray-300 focus:border-indigo-500 outline-none transition bg-transparent",placeholder:"例如：林远"},null,8,af),[[ce,f.character_from]])]),t("div",null,[d[2]||(d[2]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"到",-1)),de(t("input",{type:"text","onUpdate:modelValue":m=>f.character_to=m,class:"w-full p-1 border-b-2 border-gray-300 focus:border-indigo-500 outline-none transition bg-transparent",placeholder:"例如：苏晴"},null,8,uf),[[ce,f.character_to]])])]),t("div",null,[d[3]||(d[3]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"关系描述",-1)),de(t("textarea",{"onUpdate:modelValue":m=>f.description=m,class:"w-full h-20 p-2 mt-1 border border-gray-300 rounded-md focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 transition text-sm",placeholder:"关于这段关系的详细描述..."},null,8,df),[[ce,f.description]])])]))),128)),t("button",{onClick:i,class:"w-full mt-4 px-4 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-md hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," + 添加新关系 ")]))}}),pf={class:"space-y-4 max-h-96 overflow-y-auto p-1"},ff=["onClick"],hf={class:"mb-2"},gf=["onUpdate:modelValue"],mf=["onUpdate:modelValue"],vf=W({__name:"FactionsEditor",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(n,{emit:e}){const s=n,r=e,o=S([]);let l=!1;Se(()=>s.modelValue,u=>{l=!0,o.value=JSON.parse(JSON.stringify(u||[])),tt(()=>{l=!1})},{immediate:!0}),Se(o,u=>{l||r("update:modelValue",JSON.parse(JSON.stringify(u)))},{deep:!0});const i=()=>{o.value.push({name:"",description:""})},a=u=>{o.value.splice(u,1)};return(u,d)=>(c(),p("div",pf,[(c(!0),p(re,null,ge(o.value,(f,g)=>(c(),p("div",{key:g,class:"p-4 border border-gray-200 rounded-lg bg-gray-50 relative"},[t("button",{onClick:m=>a(g),class:"absolute top-2 right-2 text-red-400 hover:text-red-600 transition-colors p-1"},[...d[0]||(d[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z","clip-rule":"evenodd"})],-1)])],8,ff),t("div",hf,[d[1]||(d[1]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"阵营名称",-1)),de(t("input",{type:"text","onUpdate:modelValue":m=>f.name=m,class:"w-full p-1 border-b-2 border-gray-300 focus:border-indigo-500 outline-none transition bg-transparent",placeholder:"例如：幽灵侦探林远"},null,8,gf),[[ce,f.name]])]),t("div",null,[d[2]||(d[2]=t("label",{class:"block text-sm font-medium text-gray-600 mb-1"},"描述",-1)),de(t("textarea",{"onUpdate:modelValue":m=>f.description=m,class:"w-full h-20 p-2 mt-1 border border-gray-300 rounded-md focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 transition text-sm",placeholder:"关于这个阵营的详细描述..."},null,8,mf),[[ce,f.description]])])]))),128)),t("button",{onClick:i,class:"w-full mt-4 px-4 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-md hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," + 添加新阵营 ")]))}}),bf={class:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4"},xf={class:"p-6 border-b border-gray-200"},yf={class:"text-xl font-semibold text-gray-800"},wf={class:"p-6"},_f={class:"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-end space-x-3"},kf=W({__name:"BlueprintEditModal",props:{show:Boolean,title:String,content:{type:[String,Object,Array],default:""},field:String},emits:["close","save"],setup(n,{emit:e}){const s=n,r=e,o=S("");Se(()=>s.show,i=>{if(i)try{o.value=JSON.parse(JSON.stringify(s.content||""))}catch{o.value=s.content||""}},{immediate:!0});const l=()=>{r("save",{field:s.field,content:o.value})};return(i,a)=>n.show?(c(),p("div",{key:0,class:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex justify-center items-center",onClick:a[7]||(a[7]=Ne(u=>i.$emit("close"),["self"]))},[t("div",bf,[t("div",xf,[t("h3",yf,"编辑 "+w(n.title),1)]),t("div",wf,[s.field==="chapter_outline"?(c(),je(Dp,{key:0,modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=u=>o.value=u)},null,8,["modelValue"])):s.field==="world_setting.key_locations"?(c(),je(Gp,{key:1,modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=u=>o.value=u)},null,8,["modelValue"])):s.field==="characters"?(c(),je(nf,{key:2,modelValue:o.value,"onUpdate:modelValue":a[2]||(a[2]=u=>o.value=u)},null,8,["modelValue"])):s.field==="relationships"?(c(),je(cf,{key:3,modelValue:o.value,"onUpdate:modelValue":a[3]||(a[3]=u=>o.value=u)},null,8,["modelValue"])):s.field==="world_setting.factions"?(c(),je(vf,{key:4,modelValue:o.value,"onUpdate:modelValue":a[4]||(a[4]=u=>o.value=u)},null,8,["modelValue"])):de((c(),p("textarea",{key:5,"onUpdate:modelValue":a[5]||(a[5]=u=>o.value=u),class:"w-full h-64 p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out",placeholder:"请输入内容..."},null,512)),[[ce,o.value]])]),t("div",_f,[t("button",{onClick:a[6]||(a[6]=u=>i.$emit("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," 取消 "),t("button",{onClick:l,class:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," 保存 ")])])])):T("",!0)}}),$f={class:"space-y-6"},Cf={class:"bg-white/95 rounded-2xl shadow-sm border border-slate-200 p-6"},Sf={class:"flex items-start justify-between gap-4 mb-3"},Ef={class:"text-slate-800 text-lg leading-relaxed min-h-[2.5rem]"},Tf={class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4"},Af={class:"bg-white/95 rounded-2xl shadow-sm border border-slate-200 p-4"},Mf={class:"text-base font-medium text-slate-800 min-h-[1.5rem]"},Lf={class:"bg-white/95 rounded-2xl shadow-sm border border-slate-200 p-4"},jf={class:"text-base font-medium text-slate-800 min-h-[1.5rem]"},Of={class:"bg-white/95 rounded-2xl shadow-sm border border-slate-200 p-4"},zf={class:"text-base font-medium text-slate-800 min-h-[1.5rem]"},Rf={class:"bg-white/95 rounded-2xl shadow-sm border border-slate-200 p-4"},Pf={class:"text-base font-medium text-slate-800 min-h-[1.5rem]"},Nf={class:"bg-white/95 rounded-2xl shadow-sm border border-slate-200 p-6"},Vf={class:"flex items-start justify-between gap-4 mb-4"},Bf={class:"prose prose-sm max-w-none text-slate-600 leading-7 whitespace-pre-line"},If=W({name:"OverviewSection"}),Df=W({...If,props:{data:{},editable:{type:Boolean}},emits:["edit"],setup(n,{emit:e}){const s=n,r=e,o=(l,i,a)=>{s.editable&&r("edit",{field:l,title:i,value:a})};return(l,i)=>(c(),p("div",$f,[t("div",Cf,[t("div",Sf,[i[3]||(i[3]=t("div",null,[t("h3",{class:"text-sm font-semibold text-indigo-600 uppercase tracking-wide"},"核心摘要"),t("p",{class:"text-gray-500 text-xs"},"快速了解项目的定位与调性")],-1)),n.editable?(c(),p("button",{key:0,type:"button",class:"text-gray-400 hover:text-indigo-600 transition-colors",onClick:i[0]||(i[0]=a=>o("one_sentence_summary","核心摘要",n.data?.one_sentence_summary))},[...i[2]||(i[2]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),t("path",{"fill-rule":"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z","clip-rule":"evenodd"})],-1)])])):T("",!0)]),t("p",Ef,w(n.data?.one_sentence_summary||"暂无"),1)]),t("div",Tf,[t("div",Af,[i[4]||(i[4]=t("h4",{class:"text-xs font-semibold text-slate-500 uppercase tracking-wide mb-2"},"目标受众",-1)),t("p",Mf,w(n.data?.target_audience||"暂无"),1)]),t("div",Lf,[i[5]||(i[5]=t("h4",{class:"text-xs font-semibold text-slate-500 uppercase tracking-wide mb-2"},"类型",-1)),t("p",jf,w(n.data?.genre||"暂无"),1)]),t("div",Of,[i[6]||(i[6]=t("h4",{class:"text-xs font-semibold text-slate-500 uppercase tracking-wide mb-2"},"风格",-1)),t("p",zf,w(n.data?.style||"暂无"),1)]),t("div",Rf,[i[7]||(i[7]=t("h4",{class:"text-xs font-semibold text-slate-500 uppercase tracking-wide mb-2"},"基调",-1)),t("p",Pf,w(n.data?.tone||"暂无"),1)])]),t("div",Nf,[t("div",Vf,[i[9]||(i[9]=t("h3",{class:"text-lg font-semibold text-slate-900"},"完整剧情梗概",-1)),n.editable?(c(),p("button",{key:0,type:"button",class:"text-gray-400 hover:text-indigo-600 transition-colors",onClick:i[1]||(i[1]=a=>o("full_synopsis","完整剧情梗概",n.data?.full_synopsis))},[...i[8]||(i[8]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),t("path",{"fill-rule":"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z","clip-rule":"evenodd"})],-1)])])):T("",!0)]),t("div",Bf,[t("p",null,w(n.data?.full_synopsis||"暂无"),1)])])]))}}),Hf={class:"space-y-6"},Uf={class:"bg-white/95 rounded-2xl shadow-sm border border-slate-200 p-6"},Ff={class:"flex items-start justify-between gap-4 mb-4"},qf={class:"text-slate-600 leading-7 whitespace-pre-line"},Wf={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Gf={class:"bg-white/95 rounded-2xl shadow-sm border border-slate-200 p-6"},Jf={class:"flex items-center justify-between mb-4"},Zf={class:"space-y-4 text-sm text-slate-600"},Yf={class:"block text-slate-800 mb-1"},Xf={class:"text-xs text-slate-500 leading-5"},Kf={key:0,class:"text-slate-400 text-sm"},Qf={class:"bg-white/95 rounded-2xl shadow-sm border border-slate-200 p-6"},eh={class:"flex items-center justify-between mb-4"},th={class:"space-y-4 text-sm text-slate-600"},sh={class:"block text-slate-800 mb-1"},nh={class:"text-xs text-slate-500 leading-5"},rh={key:0,class:"text-slate-400 text-sm"},oh=W({name:"WorldSettingSection"}),lh=W({...oh,props:{data:{},editable:{type:Boolean}},emits:["edit"],setup(n,{emit:e}){const s=n,r=e,o=L(()=>s.data?.world_setting||{}),l=d=>d?Array.isArray(d)?d.map(f=>{if(typeof f=="string"){const[g,...m]=f.split("：");return{title:g||f,description:m.join("：")||"暂无描述"}}return{title:f?.name||"未命名",description:f?.description||f?.details||"暂无描述"}}):[]:[],i=L(()=>l(o.value?.key_locations)),a=L(()=>l(o.value?.factions)),u=(d,f,g)=>{s.editable&&r("edit",{field:d,title:f,value:g})};return(d,f)=>(c(),p("div",Hf,[t("div",Uf,[t("div",Ff,[f[4]||(f[4]=t("h3",{class:"text-lg font-semibold text-slate-900"},"核心规则",-1)),n.editable?(c(),p("button",{key:0,type:"button",class:"text-gray-400 hover:text-indigo-600 transition-colors",onClick:f[0]||(f[0]=g=>u("world_setting.core_rules","核心规则",o.value.core_rules))},[...f[3]||(f[3]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),t("path",{"fill-rule":"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z","clip-rule":"evenodd"})],-1)])])):T("",!0)]),t("p",qf,w(o.value.core_rules||"暂无"),1)]),t("div",Wf,[t("div",Gf,[t("div",Jf,[f[6]||(f[6]=mt('<div class="flex items-center text-slate-900 font-semibold"><svg class="mr-2 text-indigo-500" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18"></path><path d="M6 18H4a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h2v7Z"></path><path d="M18 18h2a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2h-2v7Z"></path></svg><span>关键地点</span></div>',1)),n.editable?(c(),p("button",{key:0,type:"button",class:"text-gray-400 hover:text-indigo-600 transition-colors",onClick:f[1]||(f[1]=g=>u("world_setting.key_locations","关键地点",o.value.key_locations))},[...f[5]||(f[5]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),t("path",{"fill-rule":"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z","clip-rule":"evenodd"})],-1)])])):T("",!0)]),t("ul",Zf,[(c(!0),p(re,null,ge(i.value,(g,m)=>(c(),p("li",{key:m,class:"bg-slate-50 border border-slate-100 rounded-xl p-4"},[t("strong",Yf,w(g.title),1),t("span",Xf,w(g.description),1)]))),128)),i.value.length?T("",!0):(c(),p("li",Kf,"暂无数据"))])]),t("div",Qf,[t("div",eh,[f[8]||(f[8]=mt('<div class="flex items-center text-slate-900 font-semibold"><svg class="mr-2 text-indigo-500" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg><span>主要阵营</span></div>',1)),n.editable?(c(),p("button",{key:0,type:"button",class:"text-gray-400 hover:text-indigo-600 transition-colors",onClick:f[2]||(f[2]=g=>u("world_setting.factions","主要阵营",o.value.factions))},[...f[7]||(f[7]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),t("path",{"fill-rule":"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z","clip-rule":"evenodd"})],-1)])])):T("",!0)]),t("ul",th,[(c(!0),p(re,null,ge(a.value,(g,m)=>(c(),p("li",{key:m,class:"bg-slate-50 border border-slate-100 rounded-xl p-4"},[t("strong",sh,w(g.title),1),t("span",nh,w(g.description),1)]))),128)),a.value.length?T("",!0):(c(),p("li",rh,"暂无数据"))])])])]))}}),ah={class:"space-y-6"},ih={class:"flex items-center justify-between"},uh={class:"grid grid-cols-1 xl:grid-cols-2 gap-6"},dh={class:"p-6"},ch={class:"flex flex-col sm:flex-row sm:items-center gap-4 mb-4"},ph={class:"w-16 h-16 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 text-lg font-semibold"},fh={class:"text-xl font-bold text-slate-900"},hh={key:0,class:"text-sm text-indigo-500 font-medium"},gh={class:"space-y-3 text-sm text-slate-600"},mh={key:0},vh={class:"leading-6"},bh={key:1},xh={class:"leading-6"},yh={key:2},wh={class:"leading-6"},_h={key:3},kh={class:"leading-6"},$h={key:0,class:"bg-white/95 rounded-2xl border border-dashed border-slate-300 p-10 text-center text-slate-400"},Ch=W({name:"CharactersSection"}),Sh=W({...Ch,props:{data:{},editable:{type:Boolean}},emits:["edit"],setup(n,{emit:e}){const s=n,r=e,o=L(()=>s.data?.characters||[]),l=(i,a,u)=>{s.editable&&r("edit",{field:i,title:a,value:u})};return(i,a)=>(c(),p("div",ah,[t("div",ih,[a[2]||(a[2]=t("div",null,[t("h2",{class:"text-2xl font-bold text-slate-900"},"主要角色"),t("p",{class:"text-sm text-slate-500"},"了解故事中核心人物的目标与个性")],-1)),n.editable?(c(),p("button",{key:0,type:"button",class:"text-gray-400 hover:text-indigo-600 transition-colors",onClick:a[0]||(a[0]=u=>l("characters","主要角色",n.data?.characters))},[...a[1]||(a[1]=[t("svg",{class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),t("path",{"fill-rule":"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z","clip-rule":"evenodd"})],-1)])])):T("",!0)]),t("div",uh,[(c(!0),p(re,null,ge(o.value,(u,d)=>(c(),p("article",{key:d,class:"bg-white/95 rounded-2xl border border-slate-200 shadow-sm hover:shadow-lg transition-all duration-300"},[t("div",dh,[t("div",ch,[t("div",ph,w(u.name?.slice(0,1)||"角"),1),t("div",null,[t("h3",fh,w(u.name||"未命名角色"),1),u.identity?(c(),p("p",hh,w(u.identity),1)):T("",!0)])]),t("dl",gh,[u.personality?(c(),p("div",mh,[a[3]||(a[3]=t("dt",{class:"font-semibold text-slate-800 mb-1"},"性格",-1)),t("dd",vh,w(u.personality),1)])):T("",!0),u.goals?(c(),p("div",bh,[a[4]||(a[4]=t("dt",{class:"font-semibold text-slate-800 mb-1"},"目标",-1)),t("dd",xh,w(u.goals),1)])):T("",!0),u.abilities?(c(),p("div",yh,[a[5]||(a[5]=t("dt",{class:"font-semibold text-slate-800 mb-1"},"能力",-1)),t("dd",wh,w(u.abilities),1)])):T("",!0),u.relationship_to_protagonist?(c(),p("div",_h,[a[6]||(a[6]=t("dt",{class:"font-semibold text-slate-800 mb-1"},"与主角的关系",-1)),t("dd",kh,w(u.relationship_to_protagonist),1)])):T("",!0)])])]))),128)),o.value.length?T("",!0):(c(),p("div",$h," 暂无角色信息 "))])]))}}),Eh={class:"space-y-6"},Th={class:"flex items-center justify-between"},Ah={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Mh={class:"flex items-center justify-between"},Lh={class:"flex items-center space-x-3"},jh={class:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-semibold"},Oh={class:"font-semibold text-slate-900 truncate"},zh={class:"flex items-center space-x-3"},Rh={class:"font-semibold text-slate-900 truncate"},Ph={class:"w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 font-semibold"},Nh={class:"mt-4 bg-slate-50 border border-slate-100 rounded-xl p-4 text-center"},Vh={class:"text-sm font-semibold text-slate-700"},Bh={class:"text-xs text-slate-500 leading-5 mt-1"},Ih={key:0,class:"bg-white/95 rounded-2xl border border-dashed border-slate-300 p-10 text-center text-slate-400"},Dh=W({name:"RelationshipsSection"}),Hh=W({...Dh,props:{data:{},editable:{type:Boolean}},emits:["edit"],setup(n,{emit:e}){const s=n,r=e,o=L(()=>s.data?.relationships||[]),l=(i,a,u)=>{s.editable&&r("edit",{field:i,title:a,value:u})};return(i,a)=>(c(),p("div",Eh,[t("div",Th,[a[2]||(a[2]=t("div",null,[t("h2",{class:"text-2xl font-bold text-slate-900"},"人物关系"),t("p",{class:"text-sm text-slate-500"},"角色之间的纽带与冲突")],-1)),n.editable?(c(),p("button",{key:0,type:"button",class:"text-gray-400 hover:text-indigo-600 transition-colors",onClick:a[0]||(a[0]=u=>l("relationships","人物关系",n.data?.relationships))},[...a[1]||(a[1]=[t("svg",{class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),t("path",{"fill-rule":"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z","clip-rule":"evenodd"})],-1)])])):T("",!0)]),t("div",Ah,[(c(!0),p(re,null,ge(o.value,(u,d)=>(c(),p("div",{key:d,class:"bg-white/95 rounded-2xl border border-slate-200 shadow-sm p-6"},[t("div",Mh,[t("div",Lh,[t("div",jh,w(u.character_from?.slice(0,1)||"角"),1),t("span",Oh,w(u.character_from||"未知角色"),1)]),a[3]||(a[3]=t("svg",{class:"text-slate-400",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M5 12h14"}),t("path",{d:"m12 5 7 7-7 7"})],-1)),t("div",zh,[t("span",Rh,w(u.character_to||"未知角色"),1),t("div",Ph,w(u.character_to?.slice(0,1)||"角"),1)])]),t("div",Nh,[t("p",Vh,w(u.relationship_type||"关系"),1),t("p",Bh,w(u.description||"暂无描述"),1)])]))),128)),o.value.length?T("",!0):(c(),p("div",Ih," 暂无人际关系信息 "))])]))}}),Uh={class:"space-y-6"},Fh={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},qh={key:0,class:"flex items-center gap-2"},Wh={class:"relative border-l border-slate-200 ml-3 space-y-8"},Gh={class:"absolute -left-3 mt-1 flex h-6 w-6 items-center justify-center rounded-full bg-indigo-500 text-white text-xs font-semibold"},Jh={class:"bg-white/95 rounded-2xl border border-slate-200 shadow-sm p-5"},Zh={class:"flex items-center justify-between gap-4"},Yh={class:"text-lg font-semibold text-slate-900"},Xh={class:"text-xs text-slate-400"},Kh={class:"mt-3 text-sm text-slate-600 leading-6 whitespace-pre-line"},Qh={key:0,class:"ml-6 text-slate-400 text-sm"},eg=W({name:"ChapterOutlineSection"}),tg=W({...eg,props:{outline:{},editable:{type:Boolean}},emits:["edit","add"],setup(n,{emit:e}){const s=n,r=e,o=(l,i,a)=>{s.editable&&r("edit",{field:l,title:i,value:a})};return(l,i)=>(c(),p("div",Uh,[t("div",Fh,[i[4]||(i[4]=t("div",null,[t("h2",{class:"text-2xl font-bold text-slate-900"},"章节大纲"),t("p",{class:"text-sm text-slate-500"},"故事结构与章节节奏一目了然")],-1)),n.editable?(c(),p("div",qh,[t("button",{type:"button",class:"flex items-center gap-1 px-3 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 hover:bg-indigo-100 rounded-lg",onClick:i[0]||(i[0]=a=>l.$emit("add"))},[...i[2]||(i[2]=[t("svg",{class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule":"evenodd"})],-1),Y(" 新增章节 ",-1)])]),t("button",{type:"button",class:"flex items-center gap-1 px-3 py-2 text-sm text-gray-500 hover:text-indigo-600 transition-colors",onClick:i[1]||(i[1]=a=>o("chapter_outline","章节大纲",n.outline))},[...i[3]||(i[3]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),t("path",{"fill-rule":"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z","clip-rule":"evenodd"})],-1),Y(" 编辑大纲 ",-1)])])])):T("",!0)]),t("ol",Wh,[(c(!0),p(re,null,ge(n.outline,a=>(c(),p("li",{key:a.chapter_number,class:"ml-6"},[t("span",Gh,w(a.chapter_number),1),t("div",Jh,[t("div",Zh,[t("h3",Yh,w(a.title||`第${a.chapter_number}章`),1),t("span",Xh,"#"+w(a.chapter_number),1)]),t("p",Kh,w(a.summary||"暂无摘要"),1)])]))),128)),n.outline.length?T("",!0):(c(),p("li",Qh,"暂无章节大纲"))])]))}}),sg={class:"flex flex-col h-full min-h-0 overflow-hidden relative"},ng={class:"flex flex-row flex-1 h-full lg:min-h-0 overflow-hidden"},rg={class:"px-5 py-4 border-b border-slate-200 flex items-center justify-between"},og={class:"flex items-center gap-2"},lg={class:"text-xs text-slate-500"},ag=["disabled"],ig={key:0,class:"w-3 h-3 animate-spin",fill:"none",viewBox:"0 0 24 24"},ug={key:1,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},dg={class:"flex-1 h-full overflow-y-auto divide-y divide-slate-200 overscroll-contain"},cg=["onClick"],pg={class:"flex items-center justify-between gap-3"},fg={class:"flex items-center gap-3 min-w-0"},hg={class:"inline-flex items-center justify-center w-6 h-6 text-xs font-semibold text-slate-500 bg-slate-100 rounded-full"},gg={class:"truncate"},mg={key:0,class:"text-xs text-slate-400"},vg={key:1,class:"text-xs text-slate-400"},bg={key:0,class:"mt-1 text-xs text-slate-500 truncate"},xg={class:"flex-1 flex flex-col bg-white h-full min-h-0 max-h-full overflow-hidden relative"},yg={key:1,class:"h-full flex items-center justify-center"},wg={key:2,class:"h-full flex items-center justify-center"},_g={class:"text-center"},kg={class:"text-sm text-slate-600"},$g={class:"px-6 py-4 border-b border-slate-200 bg-slate-50/50"},Cg={class:"flex items-start justify-between gap-4 mb-3"},Sg={class:"flex-1"},Eg={class:"text-xl font-bold text-slate-900"},Tg={class:"flex items-center gap-3 mt-1.5"},Ag={class:"text-sm text-slate-500"},Mg={class:"text-sm text-slate-500"},Lg={class:"flex items-center gap-2"},jg=["disabled"],Og={class:"flex gap-1"},zg=["onClick"],Rg={class:"flex-1 h-full overflow-y-auto min-h-0 overscroll-contain"},Pg={class:"px-2 py-3"},Ng={class:"max-w-full space-y-4"},Vg={key:0,class:"grid gap-4"},Bg={key:0,class:"bg-blue-50 border border-blue-100 rounded-xl p-4"},Ig={class:"text-sm text-blue-800 leading-relaxed"},Dg={key:1,class:"bg-green-50 border border-green-100 rounded-xl p-4"},Hg=["innerHTML"],Ug={class:"prose prose-slate max-w-none p-4 sm:p-6 rounded-xl bg-[var(--paper-card)]"},Fg={class:"text-base text-slate-900 leading-8 whitespace-pre-wrap font-serif"},qg={class:"px-2 py-3"},Wg={class:"max-w-full"},Gg={key:0,class:"space-y-4"},Jg=["onClick"],Zg={class:"flex items-center justify-between mb-3"},Yg={class:"text-sm font-semibold text-slate-900 flex items-center gap-2"},Xg={class:"w-6 h-6 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center text-xs font-bold"},Kg={class:"flex items-center gap-3"},Qg={class:"text-xs text-slate-500"},em={class:"text-sm text-slate-700 leading-7 whitespace-pre-wrap line-clamp-4"},tm={key:1,class:"text-center py-12 text-slate-400"},sm={class:"px-2 py-3"},nm={class:"max-w-full"},rm={key:0,class:"space-y-4"},om={key:0,class:"bg-gradient-to-br from-indigo-50 to-purple-50 border border-indigo-200 rounded-xl p-4"},lm={class:"flex items-start gap-4"},am={class:"flex-1"},im={class:"flex items-center gap-2 mb-3"},um={class:"px-3 py-1 bg-indigo-500 text-white text-sm font-bold rounded-full"},dm={key:0,class:"text-sm text-indigo-900 leading-relaxed"},cm={key:1,class:"space-y-4"},pm={class:"px-5 py-3 bg-slate-50 border-b border-slate-200 flex items-center justify-between"},fm={class:"font-bold text-slate-900 flex items-center gap-2"},hm={class:"w-6 h-6 bg-slate-700 text-white rounded-full flex items-center justify-center text-xs"},gm={key:0,class:"px-2.5 py-1 bg-indigo-100 text-indigo-700 text-xs font-semibold rounded-full"},mm={class:"p-4 space-y-3"},vm={key:0,class:"bg-green-50 border border-green-100 rounded-lg p-3"},bm={class:"space-y-1.5"},xm={key:1,class:"bg-red-50 border border-red-100 rounded-lg p-3"},ym={class:"space-y-1.5"},wm={key:2,class:"bg-blue-50 border border-blue-100 rounded-lg p-3"},_m={class:"text-xs text-blue-800 leading-relaxed"},km={key:2,class:"space-y-4"},$m={key:0,class:"bg-gradient-to-br from-indigo-50 to-blue-50 border border-indigo-200 rounded-xl p-4"},Cm={class:"flex items-center gap-3 mb-4"},Sm={class:"text-xs text-indigo-700"},Em={key:1,class:"grid grid-cols-2 md:grid-cols-3 gap-4"},Tm={class:"flex items-center justify-between mb-2"},Am={class:"text-xs font-medium text-slate-600"},Mm={class:"w-full bg-slate-100 rounded-full h-2"},Lm={key:2,class:"bg-slate-50 border border-slate-200 rounded-xl p-4"},jm={class:"text-sm text-slate-700 leading-relaxed whitespace-pre-wrap"},Om={key:1,class:"text-center py-12"},zm={key:4,class:"h-full flex items-center justify-center text-slate-400"},Rm={class:"flex items-center justify-between px-6 py-4 border-b border-slate-200 bg-slate-50"},Pm={class:"flex items-center gap-3"},Nm={class:"w-8 h-8 bg-indigo-500 text-white rounded-full flex items-center justify-center text-sm font-bold"},Vm={class:"text-lg font-bold text-slate-900"},Bm={class:"text-xs text-slate-500"},Im={class:"overflow-y-auto p-6 max-h-[calc(85vh-5rem)]"},Dm={class:"prose prose-slate max-w-none"},Hm={class:"text-base text-slate-900 leading-8 whitespace-pre-wrap font-serif"},Um=W({name:"ChaptersSection"}),Fm=W({...Um,props:{chapters:{},isAdmin:{type:Boolean},novelTitle:{}},setup(n,{expose:e}){const s=n,o=_n().params.id,l=S(null),i=S(!1),a=S(null),u=S("content"),d=S(!1),f=S({show:!1,content:"",index:0}),g=new Map,m=L(()=>s.chapters||[]),y=[{key:"content",label:"正文",badge:!1},{key:"versions",label:"版本",badge:!0},{key:"evaluation",label:"评审",badge:!1}],x=N=>N?N.replace(/\s/g,"").length:0,_=N=>({not_generated:"未生成",generating:"生成中",evaluating:"评审中",selecting:"选择中",failed:"生成失败",evaluation_failed:"评审失败",waiting_for_confirm:"待确认",successful:"已完成"})[N]||N,k=N=>({not_generated:"bg-slate-100 text-slate-600",generating:"bg-blue-100 text-blue-700",evaluating:"bg-purple-100 text-purple-700",selecting:"bg-yellow-100 text-yellow-700",failed:"bg-red-100 text-red-700",evaluation_failed:"bg-orange-100 text-orange-700",waiting_for_confirm:"bg-amber-100 text-amber-700",successful:"bg-green-100 text-green-700"})[N]||"bg-slate-100 text-slate-600",O=N=>l.value&&N==="versions"&&l.value.versions?.length||0,R=N=>N.replace(/[\\/:*?"<>|]/g,"_"),P=()=>{const N=l.value;if(!N)return;const j=N.title?.trim()||`第${N.chapter_number}章`,G=R(j)||`chapter-${N.chapter_number}`,V=N.content??"",oe=new Blob([V],{type:"text/plain;charset=utf-8"}),K=URL.createObjectURL(oe),fe=document.createElement("a");fe.href=K,fe.download=`${G}.txt`,document.body.appendChild(fe),fe.click(),document.body.removeChild(fe),URL.revokeObjectURL(K)},D=S(!1),ee=async()=>{if(m.value.length!==0){D.value=!0;try{const N=[],j=s.novelTitle||"小说";for(const le of m.value){let Te="";if(g.has(le.chapter_number))Te=g.get(le.chapter_number)?.content??"";else try{const F=s.isAdmin?await pn.getNovelChapter(o,le.chapter_number):await ke.getChapter(o,le.chapter_number);Te=F.content??"",g.set(le.chapter_number,F)}catch{Te=""}const Ze=le.title?.trim(),Ye=Ze?`第${le.chapter_number}章 ${Ze}`:`第${le.chapter_number}章`;Te&&N.push(`${"=".repeat(40)}
${Ye}
${"=".repeat(40)}

${Te}

`)}if(N.length===0)return;const G=`《${j}》

`+N.join(""),V=R(j),oe=new Blob([G],{type:"text/plain;charset=utf-8"}),K=URL.createObjectURL(oe),fe=document.createElement("a");fe.href=K,fe.download=`${V}_全文.txt`,document.body.appendChild(fe),fe.click(),document.body.removeChild(fe),URL.revokeObjectURL(K)}finally{D.value=!1}}},te=(N,j)=>{f.value={show:!0,content:N,index:j}},E=()=>{f.value.show=!1},C=L(()=>{if(!l.value?.evaluation)return null;try{return JSON.parse(l.value.evaluation)}catch{return{feedback:l.value.evaluation}}}),H=N=>{const j=typeof N=="number"?N.toString():N;return{plot:"情节",character:"人物",writing:"文笔",logic:"逻辑",emotion:"情感",creativity:"创意",coherence:"连贯性",engagement:"吸引力"}[j]||j},ve=N=>N>=8?"text-green-600":N>=6?"text-blue-600":N>=4?"text-amber-600":"text-red-600",$=N=>N>=8?"bg-green-500":N>=6?"bg-blue-500":N>=4?"bg-amber-500":"bg-red-500",h=N=>{const G=(typeof N=="number"?N.toString():N).match(/\d+/);return G?parseInt(G[0]):0},v=N=>`版本 ${h(N)}`,B=(N,j)=>j?h(N)===j:!1,U=N=>{if(!N)return"";try{return Rt.sanitize(pe.parse(N,{breaks:!0}))}catch(j){return console.error("Markdown 渲染失败:",j),Rt.sanitize(N)}},se=async N=>{if(g.has(N)){l.value=g.get(N);return}i.value=!0,a.value=null;try{const j=s.isAdmin?await pn.getNovelChapter(o,N):await ke.getChapter(o,N);g.set(N,j),l.value=j}catch(j){a.value=j instanceof Error?j.message:"加载失败",console.error("加载章节详情失败:",j)}finally{i.value=!1}};Se(m,async N=>{if(N.length===0){l.value=null;return}!l.value&&N.length>0&&await se(N[0].chapter_number)},{immediate:!0});const $e=async N=>{u.value="content",await se(N),d.value=!1};return L(()=>s.isAdmin??!1),e({focusChapter:async N=>{m.value.find(G=>G.chapter_number===N)&&await se(N)}}),(N,j)=>(c(),p("div",sg,[t("div",ng,[d.value?(c(),p("div",{key:0,class:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:j[0]||(j[0]=G=>d.value=!1)})):T("",!0),t("aside",{class:Q(["fixed lg:static inset-y-0 left-0 z-50 w-72 lg:w-72 bg-white lg:bg-slate-50/70 border-r border-slate-200 flex flex-col h-full min-h-0 max-h-full overflow-hidden transition-transform duration-300 lg:translate-x-0 shadow-2xl lg:shadow-none",d.value?"translate-x-0":"-translate-x-full"])},[t("div",rg,[t("div",og,[j[3]||(j[3]=t("h3",{class:"text-base font-semibold text-slate-900"},"章节",-1)),t("span",lg,w(m.value.length)+" 篇",1)]),t("button",{class:Q(["inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded border transition-colors duration-200",m.value.length>0&&!D.value?"border-emerald-200 text-emerald-600 hover:bg-emerald-50":"border-slate-200 text-slate-400 cursor-not-allowed"]),disabled:m.value.length===0||D.value,onClick:ee,title:"导出全部章节为单个TXT文件"},[D.value?(c(),p("svg",ig,[...j[4]||(j[4]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(c(),p("svg",ug,[...j[5]||(j[5]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])])),Y(" "+w(D.value?"导出中...":"全部导出"),1)],10,ag)]),t("ul",dg,[(c(!0),p(re,null,ge(m.value,(G,V)=>(c(),p("li",{key:G.chapter_number},[t("button",{class:Q(["w-full text-left px-5 py-3 transition-colors duration-200",l.value?.chapter_number===G.chapter_number?"bg-indigo-50 text-indigo-600 font-semibold":"hover:bg-slate-50 lg:hover:bg-white text-slate-700"]),onClick:oe=>$e(G.chapter_number)},[t("div",pg,[t("div",fg,[t("span",hg,w(V+1),1),t("span",gg,w(G.title||`第${G.chapter_number}章`),1)]),we(g).has(G.chapter_number)?(c(),p("span",mg,w(x(we(g).get(G.chapter_number)?.content))+" 字 ",1)):(c(),p("span",vg,"-"))]),G.summary?(c(),p("p",bg,w(G.summary),1)):T("",!0)],10,cg)]))),128))])],2),t("section",xg,[d.value?T("",!0):(c(),p("button",{key:0,onClick:j[1]||(j[1]=G=>d.value=!0),class:"lg:hidden fixed bottom-6 left-6 z-30 w-14 h-14 bg-indigo-600 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-indigo-700 transition-colors"},[...j[6]||(j[6]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)])])),i.value?(c(),p("div",yg,[...j[7]||(j[7]=[t("div",{class:"text-center"},[t("div",{class:"w-10 h-10 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-3"}),t("p",{class:"text-sm text-slate-500"},"加载中...")],-1)])])):a.value?(c(),p("div",wg,[t("div",_g,[j[8]||(j[8]=t("div",{class:"w-12 h-12 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-3"},[t("svg",{class:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("p",kg,w(a.value),1)])])):l.value?(c(),p(re,{key:3},[t("header",$g,[t("div",Cg,[t("div",Sg,[t("h4",Eg,w(l.value.title||`第${l.value.chapter_number}章`),1),t("div",Tg,[t("span",Ag,"第 "+w(l.value.chapter_number)+" 章",1),j[9]||(j[9]=t("span",{class:"text-sm text-slate-400"},"·",-1)),t("span",Mg,w(x(l.value.content))+" 字",1)])]),t("div",Lg,[t("button",{class:Q(["inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium rounded-lg border transition-colors duration-200",l.value?.content?"border-indigo-200 text-indigo-600 hover:bg-indigo-50":"border-slate-200 text-slate-400 cursor-not-allowed"]),disabled:!l.value?.content,onClick:P},[...j[10]||(j[10]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v16h16V4m-4 4l-4-4-4 4m4-4v12"})],-1),Y(" 导出TXT ",-1)])],10,jg),l.value.generation_status?(c(),p("span",{key:0,class:Q(["px-3 py-1 text-xs font-medium rounded-full",k(l.value.generation_status)])},w(_(l.value.generation_status)),3)):T("",!0)])]),t("div",Og,[(c(),p(re,null,ge(y,G=>t("button",{key:G.key,onClick:V=>u.value=G.key,class:Q(["px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200",u.value===G.key?"bg-white text-indigo-600 shadow-sm":"text-slate-600 hover:text-slate-900 hover:bg-white/50"])},[Y(w(G.label)+" ",1),G.badge&&O(G.key)?(c(),p("span",{key:0,class:Q(["ml-1.5 px-1.5 py-0.5 text-xs rounded-full",u.value===G.key?"bg-indigo-100 text-indigo-600":"bg-slate-200 text-slate-600"])},w(O(G.key)),3)):T("",!0)],10,zg)),64))])]),t("article",Rg,[de(t("div",Pg,[t("div",Ng,[l.value.summary||l.value.real_summary?(c(),p("div",Vg,[l.value.summary?(c(),p("div",Bg,[j[11]||(j[11]=t("h5",{class:"text-xs font-semibold text-blue-900 mb-2 flex items-center gap-1.5"},[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),Y(" 计划大纲 ")],-1)),t("p",Ig,w(l.value.summary),1)])):T("",!0),l.value.real_summary?(c(),p("div",Dg,[j[12]||(j[12]=t("h5",{class:"text-xs font-semibold text-green-900 mb-2 flex items-center gap-1.5"},[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})]),Y(" 实际内容概要 ")],-1)),t("div",{class:"prose prose-sm prose-green max-w-none text-green-800",innerHTML:U(l.value.real_summary)},null,8,Hg)])):T("",!0)])):T("",!0),t("div",Ug,[t("div",Fg,w(l.value.content||"暂无内容"),1)])])],512),[[Fs,u.value==="content"]]),de(t("div",qg,[t("div",Wg,[l.value.versions&&l.value.versions.length>0?(c(),p("div",Gg,[(c(!0),p(re,null,ge(l.value.versions,(G,V)=>(c(),p("div",{key:V,class:"border border-slate-200 rounded-xl p-5 hover:border-indigo-300 hover:shadow-md transition-all duration-200 group cursor-pointer",onClick:oe=>te(G.content,V)},[t("div",Zg,[t("h5",Yg,[t("span",Xg,w(V+1),1),Y(" 版本 "+w(V+1),1)]),t("div",Kg,[t("span",Qg,w(x(G.content))+" 字",1),j[13]||(j[13]=t("span",{class:"text-xs font-medium text-indigo-600 opacity-0 group-hover:opacity-100 transition-opacity"}," 点击查看全文 → ",-1))])]),t("div",em,w(G),1)],8,Jg))),128))])):(c(),p("div",tm," 暂无版本记录 "))])],512),[[Fs,u.value==="versions"]]),de(t("div",sm,[t("div",nm,[C.value?(c(),p("div",rm,[C.value.best_choice?(c(),p("div",om,[t("div",lm,[j[15]||(j[15]=t("div",{class:"w-12 h-12 bg-indigo-500 rounded-xl flex items-center justify-center flex-shrink-0"},[t("svg",{class:"w-7 h-7 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})])],-1)),t("div",am,[j[14]||(j[14]=t("h5",{class:"text-lg font-bold text-indigo-900 mb-2"},"最佳版本选择",-1)),t("div",im,[t("span",um," 版本 "+w(C.value.best_choice),1)]),C.value.reason_for_choice?(c(),p("p",dm,w(C.value.reason_for_choice),1)):T("",!0)])])])):T("",!0),C.value.evaluation?(c(),p("div",cm,[(c(!0),p(re,null,ge(C.value.evaluation,(G,V)=>(c(),p("div",{key:V,class:Q(["border border-slate-200 rounded-xl overflow-hidden",B(V,C.value.best_choice)?"ring-2 ring-indigo-400":""])},[t("div",pm,[t("h6",fm,[t("span",hm,w(h(V)),1),Y(" "+w(v(V)),1)]),B(V,C.value.best_choice)?(c(),p("span",gm," 最佳 ")):T("",!0)]),t("div",mm,[G.pros&&G.pros.length>0?(c(),p("div",vm,[j[17]||(j[17]=t("h6",{class:"text-xs font-bold text-green-900 mb-2 flex items-center gap-1.5"},[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),Y(" 优点 ")],-1)),t("ul",bm,[(c(!0),p(re,null,ge(G.pros,(oe,K)=>(c(),p("li",{key:K,class:"flex items-start gap-2 text-xs text-green-800 leading-relaxed"},[j[16]||(j[16]=t("span",{class:"w-1 h-1 bg-green-500 rounded-full mt-1.5 flex-shrink-0"},null,-1)),t("span",null,w(oe),1)]))),128))])])):T("",!0),G.cons&&G.cons.length>0?(c(),p("div",xm,[j[19]||(j[19]=t("h6",{class:"text-xs font-bold text-red-900 mb-2 flex items-center gap-1.5"},[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})]),Y(" 缺点 ")],-1)),t("ul",ym,[(c(!0),p(re,null,ge(G.cons,(oe,K)=>(c(),p("li",{key:K,class:"flex items-start gap-2 text-xs text-red-800 leading-relaxed"},[j[18]||(j[18]=t("span",{class:"w-1 h-1 bg-red-500 rounded-full mt-1.5 flex-shrink-0"},null,-1)),t("span",null,w(oe),1)]))),128))])])):T("",!0),G.overall_review?(c(),p("div",wm,[j[20]||(j[20]=t("h6",{class:"text-xs font-bold text-blue-900 mb-2"},"总体评价",-1)),t("p",_m,w(G.overall_review),1)])):T("",!0)])],2))),128))])):C.value.decision||C.value.feedback?(c(),p("div",km,[C.value.decision?(c(),p("div",$m,[t("div",Cm,[j[22]||(j[22]=t("div",{class:"w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center"},[t("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",null,[j[21]||(j[21]=t("h5",{class:"text-sm font-bold text-indigo-900"},"评审决策",-1)),t("p",Sm,w(C.value.decision),1)])])])):T("",!0),C.value.scores?(c(),p("div",Em,[(c(!0),p(re,null,ge(C.value.scores,(G,V)=>(c(),p("div",{key:V,class:"bg-white border border-slate-200 rounded-xl p-4 hover:shadow-md transition-shadow"},[t("div",Tm,[t("span",Am,w(H(V)),1),t("span",{class:Q(["text-lg font-bold",ve(G)])},w(G),3)]),t("div",Mm,[t("div",{class:Q(["h-2 rounded-full transition-all duration-300",$(G)]),style:Ht({width:`${G/10*100}%`})},null,6)])]))),128))])):T("",!0),C.value.feedback?(c(),p("div",Lm,[j[23]||(j[23]=t("h5",{class:"text-sm font-bold text-slate-900 mb-3"},"详细反馈",-1)),t("p",jm,w(C.value.feedback),1)])):T("",!0)])):T("",!0)])):(c(),p("div",Om,[...j[24]||(j[24]=[t("div",{class:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-3"},[t("svg",{class:"w-8 h-8 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1),t("p",{class:"text-slate-400"},"暂无评审意见",-1)])]))])],512),[[Fs,u.value==="evaluation"]])])],64)):(c(),p("div",zm,[...j[25]||(j[25]=[t("div",{class:"text-center"},[t("svg",{class:"w-16 h-16 mx-auto mb-3 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})]),t("p",{class:"text-sm"},"请选择章节查看详细内容")],-1)])]))])]),xe(cs,{"enter-active-class":"transition-all duration-300","leave-active-class":"transition-all duration-300","enter-from-class":"opacity-0","leave-to-class":"opacity-0"},{default:Re(()=>[f.value.show?(c(),p("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:E},[t("div",{class:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[85vh] overflow-hidden",onClick:j[2]||(j[2]=Ne(()=>{},["stop"]))},[t("div",Rm,[t("div",Pm,[t("span",Nm,w(f.value.index+1),1),t("div",null,[t("h3",Vm,"版本 "+w(f.value.index+1),1),t("p",Bm,w(x(f.value.content))+" 字",1)])]),t("button",{onClick:E,class:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-slate-200 transition-colors"},[...j[26]||(j[26]=[t("svg",{class:"w-5 h-5 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Im,[t("div",Dm,[t("div",Hm,w(f.value.content),1)])])])])):T("",!0)]),_:1})]))}}),qm=Pt(Fm,[["__scopeId","data-v-e6aed719"]]),Wm={class:"h-screen flex flex-col overflow-hidden bg-gradient-to-br from-slate-50 via-blue-50/30 to-indigo-50/40"},Gm={class:"sticky top-0 z-40 bg-white/90 backdrop-blur-lg border-b border-slate-200/60 shadow-sm"},Jm={class:"max-w-[1800px] mx-auto px-4 sm:px-6 lg:px-8 py-4"},Zm={class:"flex items-center justify-between"},Ym={class:"flex items-center gap-3 flex-1 min-w-0"},Xm={class:"flex-1 min-w-0"},Km={class:"text-xl sm:text-2xl lg:text-3xl font-bold text-slate-900 truncate"},Qm={key:0,class:"text-xs sm:text-sm text-slate-500 mt-0.5"},ev={class:"flex items-center gap-2 flex-shrink-0"},tv={class:"flex max-w-[1800px] mx-auto w-full flex-1 min-h-0 overflow-hidden"},sv={class:"hidden lg:flex items-center justify-between px-6 py-5 border-b border-slate-200/60"},nv={class:"flex items-center gap-2"},rv={class:"text-sm font-semibold text-slate-700 uppercase tracking-wide"},ov={class:"px-4 py-6 space-y-1.5 overflow-y-auto h-[calc(100%-5rem)] lg:h-[calc(100%-5rem)]"},lv=["onClick"],av={class:"text-left flex-1"},iv={class:"block font-semibold"},uv={class:"text-xs font-normal opacity-70"},dv={class:"flex-1 lg:ml-72 min-h-0 flex flex-col h-full"},cv={class:"flex-1 min-h-0 h-full px-4 sm:px-6 lg:px-8 xl:px-12 py-6 sm:py-8 flex flex-col overflow-hidden box-border"},pv={class:"flex-1 flex flex-col min-h-0 h-full"},fv={key:0,class:"flex flex-col items-center justify-center py-20 sm:py-28"},hv={key:1,class:"flex flex-col items-center justify-center py-20 sm:py-28 space-y-4"},gv={class:"text-slate-600 text-center"},mv={key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4"},vv={class:"space-y-5"},bv=W({__name:"NovelDetailShell",props:{isAdmin:{type:Boolean,default:!1}},setup(n){const e=n,s=_n(),r=Et(),o=fs(),l=s.params.id,i=S(typeof window<"u"?window.innerWidth>=1024:!0),a=[{key:"overview",label:"项目概览",description:"定位与整体梗概"},{key:"world_setting",label:"世界设定",description:"规则、地点与阵营"},{key:"characters",label:"主要角色",description:"人物性格与目标"},{key:"relationships",label:"人物关系",description:"角色之间的联系"},{key:"chapter_outline",label:"章节大纲",description:e.isAdmin?"故事章节规划":"故事结构规划"},{key:"chapters",label:"章节内容",description:e.isAdmin?"生成章节与正文":"生成状态与摘要"}],u={overview:Df,world_setting:lh,characters:Sh,relationships:Hh,chapter_outline:tg,chapters:qm},d=F=>({overview:()=>ne("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},[ne("rect",{x:3,y:3,width:18,height:18,rx:2}),ne("line",{x1:3,y1:9,x2:21,y2:9}),ne("line",{x1:9,y1:21,x2:9,y2:9})]),world_setting:()=>ne("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},[ne("circle",{cx:12,cy:12,r:10}),ne("path",{d:"M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"})]),characters:()=>ne("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},[ne("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),ne("circle",{cx:9,cy:7,r:4}),ne("path",{d:"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"})]),relationships:()=>ne("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},[ne("path",{d:"M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2"}),ne("circle",{cx:9,cy:7,r:4}),ne("path",{d:"M22 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"})]),chapter_outline:()=>ne("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},[ne("line",{x1:8,y1:6,x2:21,y2:6}),ne("line",{x1:8,y1:12,x2:21,y2:12}),ne("line",{x1:8,y1:18,x2:21,y2:18}),ne("line",{x1:3,y1:6,x2:3.01,y2:6}),ne("line",{x1:3,y1:12,x2:3.01,y2:12}),ne("line",{x1:3,y1:18,x2:3.01,y2:18})]),chapters:()=>ne("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2},[ne("path",{d:"M4 19.5A2.5 2.5 0 016.5 17H20"}),ne("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"})])})[F],f=ls({}),g=ls({overview:!1,world_setting:!1,characters:!1,relationships:!1,chapter_outline:!1,chapters:!1}),m=ls({overview:null,world_setting:null,characters:null,relationships:null,chapter_outline:null,chapters:null}),y=ls({title:"加载中...",updated_at:null}),x=S("overview"),_=S(!1),k=S(""),O=S(""),R=S(""),P=S(!1),D=S(""),ee=S(""),te=S(""),E=L(()=>e.isAdmin?null:o.currentProject),C=L(()=>{const F=y.title||"加载中...";return F.startsWith("《")&&F.endsWith("》")?F:`《${F}》`}),H=L(()=>["chapters"].includes(x.value)?"flex-1 min-h-0 h-full flex flex-col overflow-hidden":"overflow-y-auto"),ve=L(()=>["chapters"].includes(x.value)?"overflow-hidden":"overflow-visible"),$=async()=>{e.isAdmin||!l||E.value||await o.loadProject(l)},h=()=>{i.value=!i.value},v=()=>{typeof window>"u"||(i.value=window.innerWidth>=1024)},B=async(F,J=!1)=>{if(l&&!(!J&&f[F])){g[F]=!0,m[F]=null;try{const ue=e.isAdmin?await pn.getNovelSection(l,F):await ke.getSection(l,F);f[F]=ue.data,F==="overview"&&(y.title=ue.data?.title||y.title,y.updated_at=ue.data?.updated_at||null)}catch(ue){console.error("加载模块失败:",ue),m[F]=ue instanceof Error?ue.message:"加载失败"}finally{g[F]=!1}}},U=(F,J=!1)=>{B(F,J)},se=F=>{x.value=F,typeof window<"u"&&window.innerWidth<1024&&(i.value=!1),B(F)},$e=()=>r.push(e.isAdmin?"/admin":"/workspace"),N=async()=>{await $();const F=E.value;if(!F)return;const J=F.title==="未命名灵感"?`/inspiration?project_id=${F.id}`:`/novel/${F.id}`;r.push(J)},j=L(()=>u[x.value]),G=L(()=>g[x.value]),V=L(()=>m[x.value]),oe=L(()=>{const F=f[x.value],J=!e.isAdmin;switch(x.value){case"overview":return{data:F||null,editable:J};case"world_setting":return{data:F||null,editable:J};case"characters":return{data:F||null,editable:J};case"relationships":return{data:F||null,editable:J};case"chapter_outline":return{outline:F?.chapter_outline||[],editable:J};case"chapters":return{chapters:F?.chapters||[],isAdmin:e.isAdmin,novelTitle:y.title};default:return{}}}),K=F=>{e.isAdmin||(R.value=F.field,k.value=F.title,O.value=F.value,_.value=!0)},fe=F=>F.startsWith("world_setting")?"world_setting":F.startsWith("characters")?"characters":F.startsWith("relationships")?"relationships":F.startsWith("chapter_outline")?"chapter_outline":"overview",le=async F=>{if(e.isAdmin)return;await $();const J=E.value;if(!J)return;const{field:ue,content:ot}=F,Pe={};if(ue.includes(".")){const[We,Fe]=ue.split(".");Pe[We]={...J.blueprint?.[We],[Fe]:ot}}else Pe[ue]=ot;try{const We=await ke.updateBlueprint(J.id,Pe);o.setCurrentProject(We);const Fe=fe(ue);await B(Fe,!0),Fe!=="overview"&&await B("overview",!0),_.value=!1}catch(We){console.error("保存变更失败:",We)}},Te=async()=>{if(e.isAdmin)return;await $();const F=f.chapter_outline?.chapter_outline||E.value?.blueprint?.chapter_outline||[],J=F.length>0?Math.max(...F.map(ue=>ue.chapter_number))+1:1;D.value=`新章节 ${J}`,ee.value="",P.value=!0},Ze=()=>{P.value=!1},Ye=async()=>{if(e.isAdmin)return;await $();const F=E.value;if(!F)return;if(!D.value.trim()){X.showWarning("章节标题不能为空","操作提示");return}const J=F.blueprint?.chapter_outline||[],ue=J.length>0?Math.max(...J.map(Pe=>Pe.chapter_number))+1:1,ot=[...J,{chapter_number:ue,title:D.value,summary:ee.value}];try{const Pe=await ke.updateBlueprint(F.id,{chapter_outline:ot});o.setCurrentProject(Pe),await B("chapter_outline",!0),P.value=!1}catch(Pe){console.error("新增章节失败:",Pe)}};return Ee(async()=>{typeof window<"u"&&window.addEventListener("resize",v),typeof document<"u"&&(te.value=document.body.style.overflow,document.body.style.overflow="hidden"),await B("overview",!0),B("world_setting")}),bo(()=>{typeof window<"u"&&window.removeEventListener("resize",v),typeof document<"u"&&(document.body.style.overflow=te.value||"")}),(F,J)=>(c(),p("div",Wm,[t("header",Gm,[t("div",Jm,[t("div",Zm,[t("div",Ym,[t("button",{class:"lg:hidden flex-shrink-0 p-2 text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all duration-200",onClick:h,"aria-label":"Toggle sidebar"},[...J[5]||(J[5]=[t("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 6h16M4 12h16M4 18h16"})],-1)])]),t("div",Xm,[t("h1",Km,w(C.value),1),y.updated_at?(c(),p("p",Qm," 最近更新："+w(y.updated_at),1)):T("",!0)])]),t("div",ev,[t("button",{class:"px-3 py-2 sm:px-4 text-sm font-medium text-slate-700 bg-white hover:bg-slate-50 border border-slate-200 rounded-lg transition-all duration-200 hover:shadow-md",onClick:$e},[...J[6]||(J[6]=[t("span",{class:"hidden sm:inline"},"返回列表",-1),t("span",{class:"sm:hidden"},"返回",-1)])]),n.isAdmin?T("",!0):(c(),p("button",{key:0,class:"px-3 py-2 sm:px-4 text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg",onClick:N},[...J[7]||(J[7]=[t("span",{class:"hidden sm:inline"},"开始创作",-1),t("span",{class:"sm:hidden"},"创作",-1)])]))])])])]),t("div",tv,[t("aside",{class:Q(["fixed left-0 top-[73px] bottom-0 z-30 w-72 bg-white/95 backdrop-blur-lg border-r border-slate-200/60 shadow-2xl transform transition-transform duration-300 ease-out lg:translate-x-0",i.value?"translate-x-0":"-translate-x-full"])},[t("div",sv,[t("div",nv,[J[8]||(J[8]=t("div",{class:"w-2 h-2 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500"},null,-1)),t("span",rv,w(n.isAdmin?"内容视图":"蓝图导航"),1)])]),t("nav",ov,[(c(),p(re,null,ge(a,ue=>t("button",{key:ue.key,type:"button",onClick:ot=>se(ue.key),class:Q(["w-full group flex items-center gap-3 rounded-xl px-4 py-3.5 text-sm font-medium transition-all duration-200",x.value===ue.key?"bg-gradient-to-r from-indigo-50 to-indigo-100/80 text-indigo-700 shadow-sm ring-1 ring-indigo-200/50":"text-slate-600 hover:bg-slate-50 hover:text-slate-900"])},[t("span",{class:Q(["flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg transition-all duration-200",x.value===ue.key?"bg-gradient-to-br from-indigo-500 to-indigo-600 text-white shadow-md":"bg-slate-100 text-slate-500 group-hover:bg-slate-200"])},[(c(),je(rn(d(ue.key)),{class:"w-5 h-5"}))],2),t("span",av,[t("span",iv,w(ue.label),1),t("span",uv,w(ue.description),1)])],10,lv)),64))])],2),xe(cs,{"enter-active-class":"transition-opacity duration-300","leave-active-class":"transition-opacity duration-300","enter-from-class":"opacity-0","leave-to-class":"opacity-0"},{default:Re(()=>[i.value?(c(),p("div",{key:0,class:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-20 lg:hidden",onClick:h})):T("",!0)]),_:1}),t("div",dv,[t("div",cv,[t("div",pv,[t("div",{class:Q(["flex-1 h-full bg-white/95 backdrop-blur-sm rounded-2xl border border-slate-200/60 shadow-xl p-6 sm:p-8 lg:p-10 min-h-[20rem] transition-shadow duration-300 hover:shadow-2xl flex flex-col box-border",ve.value])},[G.value?(c(),p("div",fv,[...J[9]||(J[9]=[t("div",{class:"relative"},[t("div",{class:"w-12 h-12 border-4 border-indigo-100 rounded-full"}),t("div",{class:"absolute top-0 left-0 w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"})],-1),t("p",{class:"mt-4 text-sm text-slate-500"},"加载中...",-1)])])):V.value?(c(),p("div",hv,[J[10]||(J[10]=t("div",{class:"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center"},[t("svg",{class:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("p",gv,w(V.value),1),t("button",{class:"px-6 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 rounded-lg shadow-md hover:shadow-lg transition-all duration-200",onClick:J[0]||(J[0]=ue=>U(x.value,!0))}," 重试 ")])):(c(),je(rn(j.value),wr({key:2},oe.value,{class:H.value,onEdit:K,onAdd:Te}),null,16,["class"]))],2)])])])]),n.isAdmin?T("",!0):(c(),je(kf,{key:0,show:_.value,title:k.value,content:O.value,field:R.value,onClose:J[1]||(J[1]=ue=>_.value=!1),onSave:le},null,8,["show","title","content","field"])),xe(cs,{"enter-active-class":"transition-all duration-300","leave-active-class":"transition-all duration-300","enter-from-class":"opacity-0 scale-95","leave-to-class":"opacity-0 scale-95"},{default:Re(()=>[P.value&&!n.isAdmin?(c(),p("div",mv,[t("div",{class:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm",onClick:Ze}),t("div",{class:"relative bg-white rounded-2xl shadow-2xl border border-slate-200 p-6 sm:p-8 w-full max-w-lg transform transition-all",onClick:J[4]||(J[4]=Ne(()=>{},["stop"]))},[J[13]||(J[13]=t("h3",{class:"text-xl font-bold text-slate-900 mb-6"},"新增章节大纲",-1)),t("div",vv,[t("div",null,[J[11]||(J[11]=t("label",{for:"new-chapter-title",class:"block text-sm font-semibold text-slate-700 mb-2"}," 章节标题 ",-1)),de(t("input",{id:"new-chapter-title","onUpdate:modelValue":J[2]||(J[2]=ue=>D.value=ue),type:"text",class:"block w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200",placeholder:"例如：意外的相遇"},null,512),[[ce,D.value]])]),t("div",null,[J[12]||(J[12]=t("label",{for:"new-chapter-summary",class:"block text-sm font-semibold text-slate-700 mb-2"}," 章节摘要 ",-1)),de(t("textarea",{id:"new-chapter-summary","onUpdate:modelValue":J[3]||(J[3]=ue=>ee.value=ue),rows:"4",class:"block w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 resize-none",placeholder:"简要描述本章发生的主要事件"},null,512),[[ce,ee.value]])])]),t("div",{class:"mt-8 flex justify-end gap-3"},[t("button",{type:"button",class:"px-5 py-2.5 text-sm font-medium text-slate-600 bg-white hover:bg-slate-50 border border-slate-200 rounded-lg transition-all duration-200",onClick:Ze}," 取消 "),t("button",{type:"button",class:"px-5 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 rounded-lg shadow-md hover:shadow-lg transition-all duration-200",onClick:Ye}," 保存 ")])])])):T("",!0)]),_:1})]))}}),xv=Pt(bv,[["__scopeId","data-v-fb3840af"]]),yv=W({__name:"NovelDetail",setup(n){return(e,s)=>(c(),je(xv,{"is-admin":!1}))}}),wv=W({__name:"TypewriterEffect",props:{text:{type:String,required:!0}},setup(n){const s=n.text,r=S("");let o=0;return Ee(()=>{const l=setInterval(()=>{o<s.length?(r.value+=s.charAt(o),o++):clearInterval(l)},150)}),(l,i)=>(c(),p("h1",{class:"typewriter text-4xl md:text-5xl font-extrabold text-center text-gray-800 tracking-wider",style:Ht({"--char-count":we(s).length})},w(r.value),5))}}),ro=Pt(wv,[["__scopeId","data-v-0c91fedd"]]),_v={class:"flex flex-col items-center justify-center min-h-screen p-4"},kv={class:"mb-12"},$v={class:"w-full max-w-sm p-8 space-y-8 bg-white/70 backdrop-blur-xl rounded-2xl shadow-xl"},Cv={class:"space-y-4"},Sv={key:0,class:"text-sm font-medium text-center text-red-500"},Ev=["disabled"],Tv={key:0},Av={key:1},Mv={key:0},Lv={key:1,class:"mt-8 text-sm text-center text-gray-500"},jv=W({__name:"Login",setup(n){const e=S(""),s=S(""),r=S(""),o=S(!1),l=Et(),i=ct(),a=L(()=>i.allowRegistration),u=L(()=>i.enableLinuxdoLogin);Ee(()=>{i.fetchAuthOptions().catch(f=>{console.error("初始化认证配置失败",f)})});const d=async()=>{r.value="",o.value=!0;try{const f=await i.login(e.value,s.value);i.user?.is_admin&&(i.mustChangePassword||f)?l.push({name:"admin",query:{tab:"password"}}):l.push("/")}catch(f){r.value="登录失败，请检查您的用户名和密码。",console.error(f)}finally{o.value=!1}};return(f,g)=>{const m=Rs("router-link");return c(),p("div",_v,[t("div",kv,[xe(ro,{text:"拯 救 小 说 家"})]),t("div",$v,[g[7]||(g[7]=t("div",null,[t("h2",{class:"text-2xl font-bold text-center text-gray-800"}," 欢迎回来 "),t("p",{class:"mt-2 text-sm text-center text-gray-500"}," 登录以继续您的创作之旅 ")],-1)),t("form",{onSubmit:Ne(d,["prevent"]),class:"mt-8 space-y-6"},[t("div",Cv,[t("div",null,[g[2]||(g[2]=t("label",{for:"username",class:"sr-only"},"用户名",-1)),de(t("input",{"onUpdate:modelValue":g[0]||(g[0]=y=>e.value=y),id:"username",name:"username",type:"text",required:"",class:"w-full px-4 py-3 text-gray-700 bg-gray-100 border-2 border-gray-200 rounded-lg focus:outline-none focus:bg-white focus:border-blue-500 transition-all duration-300",placeholder:"用户名"},null,512),[[ce,e.value]])]),t("div",null,[g[3]||(g[3]=t("label",{for:"password",class:"sr-only"},"密码",-1)),de(t("input",{"onUpdate:modelValue":g[1]||(g[1]=y=>s.value=y),id:"password",name:"password",type:"password",required:"",class:"w-full px-4 py-3 text-gray-700 bg-gray-100 border-2 border-gray-200 rounded-lg focus:outline-none focus:bg-white focus:border-blue-500 transition-all duration-300",placeholder:"密码"},null,512),[[ce,s.value]])])]),r.value?(c(),p("div",Sv,w(r.value),1)):T("",!0),t("div",null,[t("button",{type:"submit",disabled:o.value,class:"w-full px-4 py-3 text-sm font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-60 transition-all duration-300"},[o.value?(c(),p("span",Tv,"正在登录...")):(c(),p("span",Av,"登录"))],8,Ev)])],32),g[8]||(g[8]=t("div",{class:"relative flex items-center justify-center my-6"},[t("div",{class:"w-full border-t border-gray-200"}),t("span",{class:"absolute px-3 text-sm text-gray-400 bg-white"},"或")],-1)),u.value?(c(),p("div",Mv,[...g[4]||(g[4]=[t("a",{href:"/api/auth/linuxdo/login",class:"flex items-center justify-center w-full px-4 py-3 text-sm font-bold text-gray-700 bg-white border-2 border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-4 focus:ring-gray-200 transition-all duration-300"},[t("svg",{class:"w-5 h-5 mr-2","aria-hidden":"true",focusable:"false","data-prefix":"fab","data-icon":"linux",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 496 512"},[t("path",{fill:"currentColor",d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.5 0-200-89.5-200-200S137.5 56 248 56s200 89.5 200 200-89.5 200-200 200z"})]),Y(" 使用 Linux DO 登录 ")],-1)])])):T("",!0),a.value?(c(),p("p",Lv,[g[6]||(g[6]=Y(" 还没有账户？ ",-1)),xe(m,{to:"/register",class:"font-medium text-blue-600 hover:underline"},{default:Re(()=>[...g[5]||(g[5]=[Y(" 立即注册 ",-1)])]),_:1})])):T("",!0)])])}}}),Ov={class:"flex flex-col items-center justify-center min-h-screen p-4"},zv={class:"mb-12"},Rv={key:0,class:"w-full max-w-md p-8 space-y-8 bg-white/70 backdrop-blur-xl rounded-2xl shadow-xl"},Pv={class:"space-y-4"},Nv={class:"flex space-x-2 items-center"},Vv=["disabled"],Bv={key:0},Iv={key:1},Dv={key:0,class:"text-sm font-medium text-center text-red-500"},Hv={key:1,class:"text-sm font-medium text-center text-green-500"},Uv={class:"mt-8 text-sm text-center text-gray-500"},Fv={key:1,class:"w-full max-w-md p-8 space-y-6 text-center bg-white/70 backdrop-blur-xl rounded-2xl shadow-xl"},qv=W({__name:"Register",setup(n){const e=S(""),s=S(""),r=S(""),o=S(""),l=S(0),i=S(!1),a=S(""),u=S(""),d=Et(),f=ct(),g=L(()=>f.allowRegistration);Ee(async()=>{try{await f.fetchAuthOptions()}catch(_){console.error("加载认证开关失败",_)}g.value||(u.value="",a.value="当前已关闭注册，请稍后再试。")});const m=()=>{if(o.value.length<8)return"密码必须至少8个字符";const _=e.value,k=/[\u4e00-\u9fa5]/.test(_),O=/^\d+$/.test(_),R=/^[a-zA-Z0-9]+$/.test(_);return O?"用户名不能是纯数字":k&&_.length<=1?"户名长度必须大于2个汉字":R&&!k&&_.length<=6?"用户名长度必须大于6个字母或数字":null},y=async()=>{if(a.value="",u.value="",!g.value){a.value="当前已关闭注册，请联系管理员。";return}if(!s.value){a.value="请输入邮箱";return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.value)){a.value="邮箱格式不正确";return}i.value=!0;try{const k=await fetch(`/api/auth/send-code?email=${encodeURIComponent(s.value)}`,{method:"POST"});if(!k.ok){const R=await k.json();throw new Error(R.detail||"发送验证码失败")}u.value="验证码已发送，请查收邮箱",l.value=60;const O=setInterval(()=>{l.value--,l.value<=0&&clearInterval(O)},1e3)}catch(k){a.value=k.message}finally{i.value=!1}},x=async()=>{a.value="",u.value="";const _=m();if(_){a.value=_;return}if(!g.value){a.value="当前已关闭注册，请联系管理员。";return}try{const k=await fetch("/api/auth/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.value,email:s.value,password:o.value,verification_code:r.value})});if(!k.ok){const O=await k.json();throw new Error(O.detail||"注册失败")}u.value="注册成功！正在跳转到登录页面...",setTimeout(()=>{d.push("/login")},2e3)}catch(k){a.value=k.message||"注册失败，请稍后再试。",console.error(k)}};return(_,k)=>{const O=Rs("router-link");return c(),p("div",Ov,[t("div",zv,[xe(ro,{text:"拯救小说家"})]),g.value?(c(),p("div",Rv,[k[10]||(k[10]=t("div",null,[t("h2",{class:"text-2xl font-bold text-center text-gray-800"}," 加入我们 "),t("p",{class:"mt-2 text-sm text-center text-gray-500"}," 开启您的创作新篇章 ")],-1)),t("form",{onSubmit:Ne(x,["prevent"]),class:"mt-8 space-y-6"},[t("div",Pv,[t("div",null,[k[4]||(k[4]=t("label",{for:"username",class:"sr-only"},"用户名",-1)),de(t("input",{"onUpdate:modelValue":k[0]||(k[0]=R=>e.value=R),id:"username",name:"username",type:"text",required:"",class:"w-full px-4 py-3 text-gray-700 bg-gray-100 border-2 border-gray-200 rounded-lg focus:outline-none focus:bg-white focus:border-blue-500 transition-all duration-300",placeholder:"用户名"},null,512),[[ce,e.value]])]),t("div",null,[k[5]||(k[5]=t("label",{for:"email",class:"sr-only"},"邮箱",-1)),de(t("input",{"onUpdate:modelValue":k[1]||(k[1]=R=>s.value=R),id:"email",name:"email",type:"email",required:"",class:"w-full px-4 py-3 text-gray-700 bg-gray-100 border-2 border-gray-200 rounded-lg focus:outline-none focus:bg-white focus:border-blue-500 transition-all duration-300",placeholder:"邮箱"},null,512),[[ce,s.value]])]),t("div",Nv,[de(t("input",{"onUpdate:modelValue":k[2]||(k[2]=R=>r.value=R),id:"verificationCode",name:"verificationCode",type:"text",required:"",class:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 border-2 border-gray-200 rounded-lg focus:outline-none focus:bg-white focus:border-blue-500 transition-all duration-300",placeholder:"验证码"},null,512),[[ce,r.value]]),t("button",{type:"button",onClick:y,disabled:l.value>0||i.value,class:"px-4 py-3 text-sm font-bold text-white bg-green-600 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 disabled:opacity-60 transition-all duration-300"},[i.value?(c(),p("span",Bv,"发送中...")):(c(),p("span",Iv,w(l.value>0?l.value+"秒后重试":"发送验证码"),1))],8,Vv)]),t("div",null,[k[6]||(k[6]=t("label",{for:"password",class:"sr-only"},"密码",-1)),de(t("input",{"onUpdate:modelValue":k[3]||(k[3]=R=>o.value=R),id:"password",name:"password",type:"password",required:"",class:"w-full px-4 py-3 text-gray-700 bg-gray-100 border-2 border-gray-200 rounded-lg focus:outline-none focus:bg-white focus:border-blue-500 transition-all duration-300",placeholder:"密码"},null,512),[[ce,o.value]])])]),a.value?(c(),p("div",Dv,w(a.value),1)):T("",!0),u.value?(c(),p("div",Hv,w(u.value),1)):T("",!0),k[7]||(k[7]=t("div",null,[t("button",{type:"submit",class:"w-full px-4 py-3 text-sm font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-60 transition-all duration-300"}," 注册 ")],-1))],32),t("p",Uv,[k[9]||(k[9]=Y(" 已有账户？ ",-1)),xe(O,{to:"/login",class:"font-medium text-blue-600 hover:underline"},{default:Re(()=>[...k[8]||(k[8]=[Y(" 立即登录 ",-1)])]),_:1})])])):(c(),p("div",Fv,[k[12]||(k[12]=t("h2",{class:"text-xl font-bold text-gray-800"},"暂未开放注册",-1)),k[13]||(k[13]=t("p",{class:"text-sm text-gray-500"},"请联系管理员或稍后再试。",-1)),xe(O,{to:"/login",class:"inline-block px-4 py-2 text-sm font-medium text-blue-600 hover:underline"},{default:Re(()=>[...k[11]||(k[11]=[Y(" 返回登录 ",-1)])]),_:1})]))])}}}),ms=xo({history:yo("/"),routes:[{path:"/",name:"workspace-entry",component:ga,meta:{requiresAuth:!0}},{path:"/workspace",name:"novel-workspace",component:Ya,meta:{requiresAuth:!0}},{path:"/inspiration",name:"inspiration-mode",component:Wi,meta:{requiresAuth:!0}},{path:"/detail/:id",name:"novel-detail",component:yv,props:!0,meta:{requiresAuth:!0}},{path:"/novel/:id",name:"writing-desk",component:zp,props:!0,meta:{requiresAuth:!0}},{path:"/login",name:"login",component:jv},{path:"/register",name:"register",component:qv},{path:"/admin",name:"admin",component:()=>qs(()=>import("./AdminView-ulMQGjif.js"),__vite__mapDeps([0,1,2,3])),meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/admin/novel/:id",name:"admin-novel-detail",component:()=>qs(()=>import("./AdminNovelDetail-DplJptjy.js"),__vite__mapDeps([4,1])),props:!0,meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/settings",name:"settings",component:()=>qs(()=>import("./SettingsView-CjQnEflb.js"),__vite__mapDeps([5,1])),meta:{requiresAuth:!0}}]});ms.beforeEach(async(n,e,s)=>{const r=ct();r.token&&!r.user&&await r.fetchUser();const o=n.matched.some(d=>d.meta.requiresAuth),l=n.matched.some(d=>d.meta.requiresAdmin),i=r.isAuthenticated,a=r.user?.is_admin,u=r.user?.is_admin&&r.mustChangePassword;o&&!i?s("/login"):l&&!a?s("/"):i&&u&&(n.name!=="admin"||n.query.tab!=="password")?s({name:"admin",query:{tab:"password"}}):s()});const Vn=wo(Io),Wv=_o();Vn.use(Wv);Vn.use(ms);const Gv=new URLSearchParams(window.location.search),nn=Gv.get("token");if(nn){const n=ct();n.token=nn,localStorage.setItem("token",nn),window.history.replaceState({},document.title,"/"),n.fetchUser()}Vn.mount("#app");export{pn as A,xv as N,qs as _,Pt as a,Yv as b,X as g,ct as u};
